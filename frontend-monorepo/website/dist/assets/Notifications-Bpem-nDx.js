import{aa as T,j as d,f as s,n as p,bp as j,ac as A,ai as B,s as S,i as C,r as P,z,o as D,c as $,b as w,A as R,b6 as F,u as H,e as u,g as i,h as m,l as a,k as h,p as V,t as b,_ as L,F as M,x as W,av as X,bn as q,bx as G}from"./index-BIerRe8o.js";import"@headlessui/vue";import{_ as I}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cdx-1Hlv.js";import{T as J}from"./TabButtons-DGauTnEB.js";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";import"@vueuse/core";import"@tiptap/core";import"@tiptap/extension-code-block";import"@tiptap/extension-heading";import"@tiptap/suggestion";import"@tiptap/extension-link";const K={props:["to"],computed:{attributes(){return{...this.$attrs,target:this.isExternal?"_blank":null,to:this.isExternal?void 0:this.to,href:this.isExternal?this.to:void 0}},isExternal(){return this.to.startsWith("http")}}};function O(x,v,n,f,o,l){return s(),d(B(l.isExternal?"a":"router-link"),A(l.attributes,{class:"cursor-pointer text-blue-500 hover:text-blue-600"}),{default:p(()=>[j(x.$slots,"default")]),_:3},16)}const Q=T(K,[["render",O]]),Y={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Z={class:"flex items-center space-x-2"},ee={class:"w-3/4 mx-auto px-5 pt-6 divide-y"},te={class:"flex items-center"},ae=["innerHTML"],se={class:"flex items-center space-x-2"},ie={key:1,class:"text-ink-gray-5"},we={__name:"Notifications",setup(x){const{brand:v}=S(),n=C("$user"),f=C("$socket"),o=P("Unread"),l=z();D(()=>{n.data||l.push({name:"Courses"}),f.on("publish_lms_notifications",t=>{r.reload()})});const y=w(()=>o.value==="Unread"?r.data:_.data),r=$({doctype:"Notification Log",url:"lms.lms.api.get_notifications",filters:{for_user:n.data?.name,read:0},auto:!0,cache:"Unread Notifications"}),_=$({doctype:"Notification Log",url:"lms.lms.api.get_notifications",filters:{for_user:n.data?.name,read:1},auto:!0,cache:"Read Notifications"}),U=R({url:"lms.lms.api.mark_as_read",makeParams(t){return{name:t.name}},onSuccess(t){r.reload(),_.reload()}}),g=R({url:"lms.lms.api.mark_all_as_read",onSuccess(t){r.reload(),_.reload()}}),N=(t,c)=>{U.submit({name:c})};F(()=>{f.off("publish_lms_notifications")});const E=w(()=>[{label:"Notifications",route:{name:"Notifications"}}]);return H(()=>({title:"Notifications",icon:v.favicon})),(t,c)=>(s(),u(M,null,[i("header",Y,[m(a(I),{items:E.value},null,8,["items"]),i("div",Z,[o.value==="Unread"&&a(r).data?.length>0?(s(),d(a(L),{key:0,onClick:a(g).submit,loading:a(g).loading},{default:p(()=>[V(b(t.__("Mark all as read")),1)]),_:1},8,["onClick","loading"])):h("",!0),m(a(J),{class:"inline-block",buttons:[{label:"Unread",active:!0},{label:"Read"}],modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=e=>o.value=e)},null,8,["modelValue"])])]),i("div",ee,[y.value?.length?(s(!0),u(M,{key:0},W(y.value,e=>(s(),u("div",{key:e.name,class:"flex items-center py-2 justify-between"},[i("div",te,[m(a(X),{image:e.user_image,label:e.full_name,class:"mr-2"},null,8,["image","label"]),i("div",{class:"notification text-ink-gray-7",innerHTML:e.subject},null,8,ae)]),i("div",se,[e.link?(s(),d(a(Q),{key:0,to:e.link,onClick:k=>N(k,e.name),class:"text-ink-gray-5 font-medium text-sm hover:text-ink-gray-7"},{default:p(()=>[V(b(t.__("View")),1)]),_:2},1032,["to","onClick"])):h("",!0),e.read?h("",!0):(s(),d(a(L),{key:1,variant:"ghost",onClick:G(k=>N(k,e.name),["stop"])},{icon:p(()=>[m(a(q),{class:"h-4 w-4 text-ink-gray-7 stroke-1.5"})]),_:2},1032,["onClick"]))])]))),128)):(s(),u("div",ie,b(t.__("Nothing to see here.")),1))])],64))}};export{we as default};
