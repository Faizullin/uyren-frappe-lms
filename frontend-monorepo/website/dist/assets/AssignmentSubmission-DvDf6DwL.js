import"@headlessui/vue";import{r as k,z as J,i as $,o as U,V as Z,A as L,a5 as ee,H as N,w as I,a as se,b as x,e as m,k as g,l as t,f as r,g as n,t as o,C as T,j as h,h as v,n as w,p as D,B as R,_ as M,bk as te,bl as ae,bm as ne,bn as oe,q as P,aG as V,s as ie,u as re,F as le}from"./index-BIerRe8o.js";import{_ as ue}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cdx-1Hlv.js";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";import"@vueuse/core";import"@tiptap/core";import"@tiptap/extension-code-block";import"@tiptap/extension-heading";import"@tiptap/suggestion";import"@tiptap/extension-link";const me={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},de={key:0},ce={key:1},fe={class:"text-sm text-ink-gray-7 font-medium mb-2"},pe=["innerHTML"],be={class:"flex flex-col"},ge={class:"p-5"},ve={class:"flex items-center justify-between mb-4"},_e={class:"font-semibold text-ink-gray-9"},ye={class:"flex items-center space-x-2"},he={key:0,class:"bg-surface-blue-2 text-ink-blue-2 p-3 rounded-md leading-5 text-sm mb-4"},we={key:1},ke={class:"text-xs text-ink-gray-5 mt-1 mb-2"},xe={key:1},Se={class:"flex text-ink-gray-7"},Ne={class:"border self-start rounded-md p-2 mr-2"},De=["href"],Le={class:"text-sm leading-5"},Fe={class:"text-sm text-ink-gray-5 mt-1"},Ae={key:2},Ce={class:"text-xs text-ink-gray-5 mb-1"},Ie={key:3},Te={class:"text-sm mb-2 text-ink-gray-7"},Re={key:4,class:"mt-8 p-3 bg-surface-blue-2 rounded-md"},Me={class:"text-sm text-ink-gray-5 font-medium mb-2"},Pe=["innerHTML"],Ve={key:5,class:"mt-8 space-y-4"},$e={class:"font-semibold mb-2 text-ink-gray-9"},Ue={class:"text-sm text-ink-gray-5 mb-1"},Ge={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"},showTitle:{type:Boolean,default:!0}},setup(b){const l=k(null),d=k(null),y=k(null),c=J(),u=$("$user"),f=k(!1),p=b;U(()=>{window.addEventListener("keydown",F)});const F=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(A(),e.preventDefault())};Z(()=>{window.removeEventListener("keydown",F)});const _=L({url:"frappe.client.get",params:{doctype:"LMS Assignment",name:p.assignmentID},auto:!0,onSuccess(e){p.submissionName!="new"&&s.reload()}}),G=L({url:"frappe.client.insert",makeParams(e){let a={doctype:"LMS Assignment Submission",assignment:p.assignmentID,member:u.data?.name};return S()?a.assignment_attachment=l.value.file_url:a.answer=d.value,{doc:a}}}),B=L({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.value=e}}),s=ee({doctype:"LMS Assignment Submission",name:p.submissionName,onError(e){N.error(e.messages?.[0]||e)},auto:!1,cache:[u.data?.name,p.assignmentID]});I(s,()=>{s.doc&&(s.doc.assignment_attachment&&B.reload({image:s.doc.assignment_attachment}),s.doc.answer&&(d.value=s.doc.answer),s.doc.comments&&(y.value=s.doc.comments),s.isDirty||S()&&!l.value||!S()&&!d.value?f.value=!0:f.value=!1)}),I(l,()=>{p.submissionName=="new"&&l.value&&(f.value=!0)});const A=()=>{if(p.submissionName!="new"){let e=s.doc&&s.doc.owner!=u.data?.name?u.data?.name:null;s.setValue.submit({...s.doc,assignment_attachment:l.value?.file_url,evaluator:e,comments:y.value,answer:d.value},{onSuccess(a){N.success(__("Changes saved successfully"))}})}else E()},E=()=>{G.submit({},{onSuccess(e){N.success(__("Assignment submitted successfully")),c.currentRoute.value.name=="AssignmentSubmission"?c.push({name:"AssignmentSubmission",params:{assignmentID:p.assignmentID,submissionName:e.name},query:{fromLesson:c.currentRoute.value.query.fromLesson}}):(q(),c.go()),s.name=e.name,s.reload()},onError(e){N.error(e.messages?.[0]||e)}})},j=e=>{f.value=!0,l.value=e},q=()=>{if(c.currentRoute.value.name=="Lesson"){let e=c.currentRoute.value.params.courseName,a=c.currentRoute.value.params.chapterNumber,i=c.currentRoute.value.params.lessonNumber;se("lms.lms.api.mark_lesson_progress",{course:e,chapter_number:a,lesson_number:i})}},z=()=>{const e=_.data?.type;if(e=="Image")return["image/*"];if(e=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e=="PDF")return[".pdf"]},H=e=>{let a=_.data?.type,i=e.name.split(".").pop().toLowerCase();if(a=="Image"&&!["jpg","jpeg","png"].includes(i))return"Only image file is allowed.";if(a=="Document"&&!["doc","docx","xml"].includes(i))return"Only document file is allowed.";if(a=="PDF"&&!["pdf"].includes(i))return"Only PDF file is allowed."},O=()=>{f.value=!0,l.value=null},K=x(()=>(u.data?.is_moderator||u.data?.is_evaluator||u.data?.is_instructor)&&p.submissionName!="new"&&c.currentRoute.value.name=="AssignmentSubmission"),C=x(()=>!s.doc||s.doc?.owner==u.data?.name&&s.doc?.status=="Not Graded"),Q=x(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),W=x(()=>s.doc?s.doc.status=="Pass"?"green":s.doc.status=="Not Graded"?"blue":"red":"orange"),S=()=>["PDF","Image","Document"].includes(_.data?.type);return(e,a)=>t(_).data?(r(),m("div",{key:0,class:T(["grid grid-cols-2 h-full",{"border rounded-lg overflow-auto":!b.showTitle}])},[n("div",{class:T(["border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]",{"h-full":!b.showTitle}])},[b.showTitle?(r(),m("div",me,[b.submissionName==="new"?(r(),m("div",de,o(e.__("Submission by"))+" "+o(t(u).data?.full_name),1)):(r(),m("div",ce,o(e.__("Submission by"))+" "+o(t(s).doc?.member_name),1))])):g("",!0),n("div",fe,o(e.__("Question"))+": ",1),n("div",{innerHTML:t(_).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,pe)],2),n("div",be,[n("div",ge,[n("div",ve,[n("div",_e,o(e.__("Submission")),1),n("div",ye,[f.value?(r(),h(t(R),{key:0,theme:"orange"},{default:w(()=>[D(o(e.__("Not Saved")),1)]),_:1})):t(s).doc?.status?(r(),h(t(R),{key:1,theme:W.value,size:"lg"},{default:w(()=>[D(o(t(s).doc?.status),1)]),_:1},8,["theme"])):g("",!0),v(t(M),{variant:"solid",onClick:a[0]||(a[0]=i=>A())},{default:w(()=>[D(o(e.__("Save")),1)]),_:1})])]),b.submissionName!="new"&&!["Pass","Fail"].includes(t(s).doc?.status)&&t(s).doc?.owner==t(u).data?.name?(r(),m("div",he,o(e.__("You've successfully submitted the assignment."))+" "+o(e.__("Once the moderator grades your submission, you'll find the details here."))+" "+o(e.__("Feel free to make edits to your submission if needed.")),1)):g("",!0),S()?(r(),m("div",we,[n("div",ke,o(e.__("Add your assignment as {0}").format(t(_).data.type)),1),l.value?(r(),m("div",xe,[n("div",Se,[n("div",Ne,[v(t(ae),{class:"h-5 w-5 stroke-1.5"})]),n("a",{href:l.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[n("span",Le,o(l.value.file_name),1),n("span",Fe,o(t(ne)(l.value.file_size)),1)],8,De),C.value?(r(),h(t(oe),{key:0,onClick:a[2]||(a[2]=i=>O()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):g("",!0)])])):(r(),h(t(te),{key:0,fileTypes:z(),validateFile:H,onSuccess:a[1]||(a[1]=i=>j(i))},{default:w(({uploading:i,progress:X,openFileSelector:Y})=>[v(t(M),{onClick:Y,loading:i},{default:w(()=>[D(o(i?e.__("Uploading {0}%").format(X):e.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):t(_).data.type=="URL"?(r(),m("div",Ae,[n("div",Ce,o(e.__("Enter a URL")),1),v(t(P),{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=i=>d.value=i),type:"text",readonly:!C.value},null,8,["modelValue","readonly"])])):(r(),m("div",Ie,[n("div",Te,o(e.__("Write your answer here")),1),v(t(V),{content:d.value,onChange:a[4]||(a[4]=i=>d.value=i),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),t(u).data?.name==t(s).doc?.owner&&t(s).doc?.comments?(r(),m("div",Re,[n("div",Me,o(e.__("Comments by Evaluator"))+": ",1),n("div",{class:"leading-5 text-ink-gray-9",innerHTML:t(s).doc.comments},null,8,Pe)])):g("",!0),K.value?(r(),m("div",Ve,[n("div",$e,o(e.__("Grading")),1),t(s).doc?(r(),h(t(P),{key:0,modelValue:t(s).doc.status,"onUpdate:modelValue":a[5]||(a[5]=i=>t(s).doc.status=i),label:e.__("Grade"),type:"select",options:Q.value},null,8,["modelValue","label","options"])):g("",!0),n("div",null,[n("div",Ue,o(e.__("Comments")),1),v(t(V),{content:y.value,onChange:a[6]||(a[6]=i=>{y.value=i,f.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):g("",!0)])])],2)):g("",!0)}},Be={key:0,class:"flex justify-between sticky top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ee={class:"overflow-hidden h-[calc(100vh-3.2rem)]"},ls={__name:"AssignmentSubmission",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(b){const l=$("$user"),d=k(!1),{brand:y}=ie(),c=b,u=L({url:"frappe.client.get_value",params:{doctype:"LMS Assignment",fieldname:"title",filters:{name:c.assignmentID}},auto:!0});U(()=>{l.data||(window.location.href="/login"),new URLSearchParams(window.location.search).get("fromLesson")&&(d.value=!0)});const f=x(()=>[{label:"Submissions",route:{name:"AssignmentSubmissionList"}},{label:u.data?.title,route:{name:"AssignmentSubmission",params:{assignmentID:c.assignmentID}}}]);return re(()=>({title:u.data?.title,icon:y.favicon})),(p,F)=>(r(),m(le,null,[d.value?g("",!0):(r(),m("header",Be,[v(t(ue),{items:f.value},null,8,["items"])])),n("div",Ee,[v(Ge,{assignmentID:b.assignmentID,submissionName:b.submissionName,showTitle:!d.value},null,8,["assignmentID","submissionName","showTitle"])])],64))}};export{ls as default};
