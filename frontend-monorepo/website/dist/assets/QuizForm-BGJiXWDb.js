import"@headlessui/vue";import{J as X,K,r as B,i as J,ap as Y,L as P,A as v,w as W,j as h,f as d,n as _,g as r,e as p,k as y,t as b,h as i,l as t,aH as Z,aG as ee,q as c,F as M,x as O,af as se,_ as z,p as S,M as te,H as q,s as ae,z as oe,o as le,V as ie,b as G,u as ne,d as ue,P as re,ag as de,ah as me,aj as _e,ak as pe,al as ce,am as fe,an as be,ao as ke,N as ye}from"./index-BIerRe8o.js";import{_ as qe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cdx-1Hlv.js";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";import"@vueuse/core";import"@tiptap/core";import"@tiptap/extension-code-block";import"@tiptap/extension-heading";import"@tiptap/suggestion";import"@tiptap/extension-link";const ve={class:"p-5 space-y-5"},Ve={class:"text-lg font-semibold text-ink-gray-9 mb-5"},ge={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},we={key:1,class:"space-y-2"},he={class:"block text-xs text-ink-gray-5 mb-1"},ze={class:"grid grid-cols-2 gap-4"},Qe={key:0,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-5"},$e={key:1,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-5"},Se={key:2,class:"grid grid-cols-2 gap-4"},Me={class:"space-y-4 py-2"},Ue={key:3,class:"grid grid-cols-2 gap-4 py-2"},De={key:2,class:"space-y-2"},xe={class:"flex items-center justify-end space-x-2 mt-5"},Ce={__name:"Question",props:X({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(Q){const k=K(Q,"modelValue"),g=K(Q,"quiz"),f=B(!1),w=B(!1),U=J("$user"),{updateOnboardingStep:D}=Y("learning"),m=P({question:"",marks:1}),s=P({question:"",type:"Choices",marks:1}),$=()=>{let o=["option","is_correct","explanation","possibility"],n=1;o.forEach(e=>{for(;n<=4;)s[`${e}_${n}`]=e==="is_correct"?!1:null,n++})};$();const u=Q,x=v({url:"frappe.client.get",makeParams(){return{doctype:"LMS Question",name:u.questionDetail.question}},auto:!1,onSuccess(o){let n=1;for(w.value=!0,Object.keys(o).forEach(e=>{Object.hasOwn(s,e)&&(s[e]=o[e])});n<=4;)s[`is_correct_${n}`]=!!o[`is_correct_${n}`],n++;s.marks=u.questionDetail.marks}});W(k,()=>{k.value&&(w.value=!1,u.questionDetail.question?x.fetch():(s.question="",s.marks=1,s.type="Choices",m.question="",m.marks=1,f.value=!1,$()),u.questionDetail.marks&&(s.marks=u.questionDetail.marks))});const j=v({url:"frappe.client.insert",makeParams(o){return{doc:{doctype:"LMS Quiz Question",parent:g.value.data.name,parentfield:"questions",parenttype:"LMS Quiz",...o}}}}),C=v({url:"frappe.client.insert",makeParams(o){return{doc:{doctype:"LMS Question",...s}}}}),T=()=>{u.questionDetail?.question?A():N()},N=()=>{f.value?L({question:m.question,marks:m.marks}):C.submit({},{onSuccess(o){L({question:o.name,marks:s.marks})},onError(o){q.error(o.messages?.[0]||o)}})},L=o=>{j.submit({...o},{onSuccess(){U.data?.is_system_manager&&D("create_first_quiz"),k.value=!1,q.success(__("Question added successfully")),g.value.reload(),k.value=!1},onError(n){q.error(n.messages?.[0]||n),k.value=!1}})},I=v({url:"frappe.client.set_value",auto:!1,makeParams(o){return{doctype:"LMS Question",name:x.data?.name,fieldname:{...s}}}}),E=v({url:"frappe.client.set_value",auto:!1,makeParams(o){return{doctype:"LMS Quiz Question",name:u.questionDetail.name,fieldname:{marks:s.marks}}}}),A=()=>{I.submit({},{onSuccess(){E.submit({},{onSuccess(){k.value=!1,q.success(__("Question updated successfully")),g.value.reload()}})},onError(o){q.error(o.messages?.[0]||o)}})};return(o,n)=>(d(),h(t(te),{modelValue:k.value,"onUpdate:modelValue":n[7]||(n[7]=e=>k.value=e),options:{size:"3xl"}},{body:_(()=>[r("div",ve,[r("div",Ve,b(o.__(u.title)),1),w.value?y("",!0):(d(),p("div",ge,[i(t(Z),{size:"sm",label:o.__("Choose an existing question"),modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=e=>f.value=e),class:"!p-0"},null,8,["label","modelValue"])])),!f.value||w.value?(d(),p("div",we,[r("div",null,[r("label",he,b(o.__("Question")),1),i(t(ee),{content:s.question,onChange:n[1]||(n[1]=e=>s.question=e),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r("div",ze,[i(t(c),{modelValue:s.marks,"onUpdate:modelValue":n[2]||(n[2]=e=>s.marks=e),label:o.__("Marks"),type:"number"},null,8,["modelValue","label"]),i(t(c),{label:o.__("Type"),modelValue:s.type,"onUpdate:modelValue":n[3]||(n[3]=e=>s.type=e),type:"select",options:["Choices","User Input","Open Ended"],class:"pb-2",required:!0},null,8,["label","modelValue"])]),s.type=="Choices"?(d(),p("div",Qe,b(o.__("Options")),1)):s.type=="User Input"?(d(),p("div",$e,b(o.__("Possibilities")),1)):y("",!0),s.type=="Choices"?(d(),p("div",Se,[(d(),p(M,null,O(4,e=>r("div",Me,[i(t(c),{label:o.__("Option")+" "+e,modelValue:s[`option_${e}`],"onUpdate:modelValue":a=>s[`option_${e}`]=a,required:e<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),i(t(c),{label:o.__("Explanation"),modelValue:s[`explanation_${e}`],"onUpdate:modelValue":a=>s[`explanation_${e}`]=a},null,8,["label","modelValue","onUpdate:modelValue"]),i(t(c),{label:o.__("Correct Answer"),modelValue:s[`is_correct_${e}`],"onUpdate:modelValue":a=>s[`is_correct_${e}`]=a,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):s.type=="User Input"?(d(),p("div",Ue,[(d(),p(M,null,O(4,e=>r("div",null,[i(t(c),{label:o.__("Possibility")+" "+e,modelValue:s[`possibility_${e}`],"onUpdate:modelValue":a=>s[`possibility_${e}`]=a,required:e==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64))])):y("",!0)])):f.value?(d(),p("div",De,[i(se,{modelValue:m.question,"onUpdate:modelValue":n[4]||(n[4]=e=>m.question=e),label:o.__("Select a question"),doctype:"LMS Question"},null,8,["modelValue","label"]),i(t(c),{modelValue:m.marks,"onUpdate:modelValue":n[5]||(n[5]=e=>m.marks=e),label:o.__("Marks"),type:"number"},null,8,["modelValue","label"])])):y("",!0),r("div",xe,[i(t(z),{variant:"solid",onClick:n[6]||(n[6]=e=>T())},{default:_(()=>[S(b(o.__("Submit")),1)]),_:1})])])]),_:1},8,["modelValue"]))}},Le={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ie={key:0,class:"space-x-2"},Ee={class:"w-3/4 mx-auto py-5"},Pe={class:"mb-8"},Oe={class:"font-semibold text-ink-gray-9 mb-4"},je={key:0},Te={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Ne={class:"mb-8"},Ae={class:"font-semibold text-ink-gray-9 mb-4"},Fe={class:"grid grid-cols-3 gap-5 my-4"},Re={class:"mb-8"},Be={class:"font-semibold text-ink-gray-9 mb-4"},He={class:"grid grid-cols-3"},Ke={class:"flex items-center justify-between mb-4"},Ge={class:"font-semibold text-ink-gray-9"},Je=["innerHTML"],We={key:1,class:"text-xs"},Xe={class:"flex gap-2"},ys={__name:"QuizForm",props:{quizID:{type:String,required:!0}},setup(Q){const{brand:k}=ae(),g=B(!1),f=P({question:"",marks:0,name:""}),w=J("$user"),U=oe(),D=window.read_only_mode,m=Q,s=P({title:"",total_marks:0,passing_percentage:0,max_attempts:0,duration:0,limit_questions_to:0,show_answers:!0,show_submission_history:!1,shuffle_questions:!1,questions:[]});le(()=>{m.quizID=="new"&&!w.data?.is_moderator&&!w.data?.is_instructor&&U.push({name:"Courses"}),m.quizID!=="new"&&u.reload(),window.addEventListener("keydown",$)});const $=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(C(),e.preventDefault())};ie(()=>{window.removeEventListener("keydown",$)}),W(()=>m.quizID!=="new",e=>{e&&u.reload()});const u=v({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Quiz",name:m.quizID}},auto:!1,onSuccess(e){Object.keys(e).forEach(V=>{Object.hasOwn(s,V)&&(s[V]=e[V])});let a=["show_answers","show_submission_history","shuffle_questions"];for(let V in a){let l=a[V];s[l]=!!s[l]}}}),x=v({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:{doctype:"LMS Quiz",...s}}}}),j=v({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Quiz",name:e.quizID,fieldname:{total_marks:L(),...s}}}}),C=()=>{u.data?.name?N():T()},T=()=>{x.submit({},{onSuccess(e){q.success(__("Quiz created successfully")),U.push({name:"QuizForm",params:{quizID:e.name}})},onError(e){q.error(e.messages?.[0]||e)}})},N=()=>{j.submit({quizID:u.data?.name},{onSuccess(e){s.total_marks=e.total_marks,q.success(__("Quiz updated successfully"))},onError(e){q.error(e.messages?.[0]||e)}})},L=()=>{let e=0;return s.limit_questions_to&&s.questions.length>0?s.questions[0].marks*s.limit_questions_to:(s.questions.forEach(a=>{e+=a.marks}),e)},I=G(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Marks"),key:"marks",width:"5rem"}]),E=(e=null)=>{e?(f.question=e.question,f.marks=e.marks,f.name=e.name):(f.question="",f.marks=0,f.name=""),g.value=!0},A=v({url:"lms.lms.api.delete_documents",makeParams(e){return{doctype:"LMS Quiz Question",documents:e.questions}}}),o=(e,a)=>{A.submit({questions:Array.from(e)},{onSuccess(){q.success(__("Questions deleted successfully")),u.reload(),a()}})},n=G(()=>{let e=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return e.push({label:m.quizID=="new"?__("New Quiz"):u.data?.title,route:{name:"QuizForm",params:{quizID:m.quizID}}}),e});return ne(()=>({title:m.quizID=="new"?__("New Quiz"):u.data?.title,icon:k.favicon})),(e,a)=>{const V=ue("router-link");return d(),p(M,null,[r("header",Le,[i(t(qe),{items:n.value},null,8,["items"]),t(D)?y("",!0):(d(),p("div",Ie,[t(u).data?.name?(d(),h(V,{key:0,to:{name:"QuizPage",params:{quizID:t(u).data.name}}},{default:_(()=>[i(t(z),null,{default:_(()=>[S(b(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):y("",!0),t(u).data?.name?(d(),h(V,{key:1,to:{name:"QuizSubmissionList",params:{quizID:t(u).data.name}}},{default:_(()=>[i(t(z),null,{default:_(()=>[S(b(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):y("",!0),i(t(z),{variant:"solid",onClick:a[0]||(a[0]=l=>C())},{default:_(()=>[S(b(e.__("Save")),1)]),_:1})]))]),r("div",Ee,[r("div",Pe,[r("div",Oe,b(e.__("Details")),1),i(t(c),{modelValue:s.title,"onUpdate:modelValue":a[1]||(a[1]=l=>s.title=l),label:t(u).data?.name?e.__("Title"):e.__("Enter a title and save the quiz to proceed"),required:!0},null,8,["modelValue","label"]),t(u).data?.name?(d(),p("div",je,[r("div",Te,[i(t(c),{type:"number",modelValue:s.max_attempts,"onUpdate:modelValue":a[2]||(a[2]=l=>s.max_attempts=l),label:e.__("Maximum Attempts")},null,8,["modelValue","label"]),i(t(c),{type:"number",modelValue:s.duration,"onUpdate:modelValue":a[3]||(a[3]=l=>s.duration=l),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),i(t(c),{modelValue:s.total_marks,"onUpdate:modelValue":a[4]||(a[4]=l=>s.total_marks=l),label:e.__("Total Marks"),disabled:""},null,8,["modelValue","label"]),i(t(c),{modelValue:s.passing_percentage,"onUpdate:modelValue":a[5]||(a[5]=l=>s.passing_percentage=l),label:e.__("Passing Percentage")},null,8,["modelValue","label"])]),r("div",Ne,[r("div",Ae,b(e.__("Settings")),1),r("div",Fe,[i(t(c),{modelValue:s.show_answers,"onUpdate:modelValue":a[6]||(a[6]=l=>s.show_answers=l),type:"checkbox",label:e.__("Show Answers")},null,8,["modelValue","label"]),i(t(c),{modelValue:s.show_submission_history,"onUpdate:modelValue":a[7]||(a[7]=l=>s.show_submission_history=l),type:"checkbox",label:e.__("Show Submission History")},null,8,["modelValue","label"])])]),r("div",Re,[r("div",Be,b(e.__("Shuffle Settings")),1),r("div",He,[i(t(c),{modelValue:s.shuffle_questions,"onUpdate:modelValue":a[8]||(a[8]=l=>s.shuffle_questions=l),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),s.shuffle_questions?(d(),h(t(c),{key:0,modelValue:s.limit_questions_to,"onUpdate:modelValue":a[9]||(a[9]=l=>s.limit_questions_to=l),label:e.__("Limit Questions To")},null,8,["modelValue","label"])):y("",!0)])]),r("div",null,[r("div",Ke,[r("div",Ge,b(e.__("Questions")),1),t(D)?y("",!0):(d(),h(t(z),{key:0,onClick:a[10]||(a[10]=l=>E())},{prefix:_(()=>[i(t(re),{class:"w-4 h-4"})]),default:_(()=>[S(" "+b(e.__("New Question")),1)]),_:1}))]),i(t(ke),{columns:I.value,rows:s.questions,"row-key":"name",options:{showTooltip:!1}},{default:_(()=>[i(t(de),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:_(()=>[(d(!0),p(M,null,O(I.value,l=>(d(),h(t(me),{item:l},null,8,["item"]))),256))]),_:1}),i(t(_e),null,{default:_(()=>[(d(!0),p(M,null,O(s.questions,l=>(d(),h(t(pe),{row:l,onClick:F=>E(l),class:"cursor-pointer"},{default:_(({idx:F,column:H,item:R})=>[i(t(ce),{item:R},{default:_(()=>[H.key=="question_detail"?(d(),p("div",{key:0,class:"text-xs truncate h-4",innerHTML:R},null,8,Je)):(d(),p("div",We,b(R),1))]),_:2},1032,["item"])]),_:2},1032,["row","onClick"]))),256))]),_:1}),i(t(fe),null,{actions:_(({unselectAll:l,selections:F})=>[r("div",Xe,[i(t(z),{variant:"ghost",onClick:H=>o(F,l)},{default:_(()=>[i(t(be),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):y("",!0)])]),i(Ce,{modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=l=>g.value=l),questionDetail:f,quiz:t(u),"onUpdate:quiz":a[12]||(a[12]=l=>ye(u)?u.value=l:null),title:f.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{ys as default};
