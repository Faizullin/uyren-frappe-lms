import"@headlessui/vue";import{i as M,j as m,e as a,l as e,f as s,g as o,h as u,t as n,n as l,_ as g,Q as ne,k as f,F,x as A,z as ie,R as le,r as y,s as ue,T as de,o as ce,V as D,A as I,b as me,w as B,u as pe,d as _e,W as fe,O as he,X as ve,p as C,B as be,Y as ye,C as P,Z as ge,$ as ke,a0 as we,a1 as xe,a2 as Ne,a3 as j}from"./index-BIerRe8o.js";import{_ as $e}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cdx-1Hlv.js";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";import"@vueuse/core";import{_ as qe}from"./CourseOutline-D_ftegVj.js";import{_ as Ce}from"./UserAvatar-D66_PbG8.js";import{_ as ze}from"./Discussions-DP_ry0CQ.js";import{_ as Se}from"./Quiz-mfGrQju1.js";import Le from"markdown-it";import{_ as Ie}from"./CourseInstructors-B6EFgXV2.js";import{_ as Pe}from"./ProgressBar-DT3bUdWT.js";import{_ as Me}from"./CertificationLinks-C-_tkyiZ.js";import"@tiptap/core";import"@tiptap/extension-code-block";import"@tiptap/extension-heading";import"@tiptap/suggestion";import"@tiptap/extension-link";import"./vuedraggable.umd-D2H5jHu-.js";const Fe={key:1,class:"border rounded-md text-center py-20"},Q={__name:"QuizBlock",props:{quiz:{type:String,required:!0}},setup(c){const d=M("$user"),$=()=>{window.location.href="/login"};return(k,w)=>e(d).data?(s(),m(Se,{key:0,quizName:c.quiz},null,8,["quizName"])):(s(),a("div",Fe,[o("div",null,n(k.__("Please login to access the quiz.")),1),u(e(g),{onClick:w[0]||(w[0]=p=>$()),class:"mt-2"},{default:l(()=>[o("span",null,n(k.__("Login")),1)]),_:1})]))}},Te={key:0},Ee=["src","height"],Re={key:0},Ve=["src","height"],De={key:1},Be={key:2},je={controls:"",width:"100%",controlsList:"nodownload",oncontextmenu:"return false;"},Qe=["src"],Ze={key:3},Ae=["src"],Oe={key:4},Ye={width:"100%",controls:"",controlsList:"nodownload"},He=["src"],Ge={key:5},Je=["src"],Ke=["innerHTML"],Ue={key:1},Z={__name:"LessonContent",props:{content:{type:String,required:!0},youtube:{type:String,required:!1},quizId:{type:String,required:!1}},setup(c){const d=ne(),$=new Le({html:!0,linkify:!0}),k=v=>(v.includes("{{")&&(v=p(v)),`https://www.youtube.com/embed/${v}`),w=v=>`${p(v)}#toolbar=0`,p=v=>v.match(/\(["']([^"']+?)["']\)/)[1];return(v,T)=>(s(),a(F,null,[c.youtube?(s(),a("div",Te,[o("iframe",{class:"youtube-video",src:k(c.youtube.split("/").pop()),width:"100%",height:e(d).width<640?200:400,frameborder:"0",allowfullscreen:""},null,8,Ee)])):f("",!0),(s(!0),a(F,null,A(c.content?.split(`

`),i=>(s(),a("div",null,[i.includes("{{ YouTubeVideo")?(s(),a("div",Re,[o("iframe",{class:"youtube-video",src:k(i),width:"100%",height:e(d).width<640?200:400,frameborder:"0",allowfullscreen:""},null,8,Ve)])):i.includes("{{ Quiz")?(s(),a("div",De,[u(Q,{quiz:p(i)},null,8,["quiz"])])):i.includes("{{ Video")?(s(),a("div",Be,[o("video",je,[o("source",{src:p(i),type:"video/mp4"},null,8,Qe)])])):i.includes("{{ PDF")?(s(),a("div",Ze,[o("iframe",{src:w(i),width:"100%",height:"700px",frameborder:"0",allowfullscreen:""},null,8,Ae)])):i.includes("{{ Audio")?(s(),a("div",Oe,[o("audio",Ye,[o("source",{src:p(i),type:"audio/mp3"},null,8,He)])])):i.includes("{{ Embed")?(s(),a("div",Ge,[o("iframe",{width:"100%",height:"400",src:p(i),frameborder:"0",allowfullscreen:""},null,8,Je)])):(s(),a("div",{key:6,innerHTML:e($).render(i)},null,8,Ke))]))),256)),c.quizId?(s(),a("div",Ue,[u(Q,{quiz:c.quizId},null,8,["quiz"])])):f("",!0)],64))}},We={key:0,class:""},Xe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},et={class:"flex items-center space-x-2"},tt={class:"grid md:grid-cols-[70%,30%] h-screen"},st={key:0,class:"border-r"},rt={class:"shadow rounded-md w-3/4 mt-10 mx-auto text-center p-4"},ot={class:"flex items-center justify-center mt-4 space-x-2"},at={class:"text-lg font-semibold text-ink-gray-7"},nt={class:"mt-1 mb-4 text-ink-gray-7"},it={class:"flex flex-col md:flex-row md:items-center justify-between"},lt={class:"flex flex-col"},ut={class:"text-3xl font-semibold text-ink-gray-9"},dt={key:0,class:"relative flex items-center space-x-2 text-sm mt-1 text-ink-gray-7 group w-fit mt-2"},ct={class:"hidden group-hover:block rounded bg-gray-900 px-2 py-1 text-xs text-white shadow-xl absolute left-0 top-full mt-2"},mt={class:"flex items-center space-x-2 mt-2 md:mt-0"},pt={key:0,class:"flex items-center mt-2"},_t={key:1,class:"bg-surface-gray-2 p-3 rounded-md mt-6"},ft={class:"text-ink-gray-5 font-medium"},ht={key:2,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-8"},vt={key:3,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-8"},bt={key:4,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-8"},yt={class:"sticky top-10"},gt={class:"bg-surface-menu-bar py-5 px-2 border-b"},kt={class:"text-lg font-semibold text-ink-gray-9"},wt={key:0,class:"text-sm mt-4 mb-2 text-ink-gray-5"},Wt={__name:"Lesson",props:{courseName:{type:String,required:!0},chapterNumber:{type:String,required:!0},lessonNumber:{type:String,required:!0}},setup(c){const d=M("$user"),$=M("$socket"),k=ie(),w=le(),p=y(!1),v=y(null),T=y(null),i=y(0),b=y(null),x=y(!1),O=y(!1),E=y(null),S=y(0),{brand:Y}=ue(),L=de();let z;const h=c;ce(()=>{V(),console.log(L.isSidebarCollapsed),L.isSidebarCollapsed=!0,document.addEventListener("fullscreenchange",R),$.on("update_lesson_progress",r=>{r.course===h.courseName&&(i.value=r.progress)})});const R=()=>{document.fullscreenElement?(x.value=!0,p.value=!1):(x.value=!1,O.value||(p.value=!0))};D(()=>{document.removeEventListener("fullscreenchange",R),L.isSidebarCollapsed=!1});const t=I({url:"lms.lms.utils.get_lesson",makeParams(r){return{course:h.courseName,chapter:r?r.chapter:h.chapterNumber,lesson:r?r.lesson:h.lessonNumber}},auto:!0}),H=r=>{if(Object.keys(r).length===0){k.push({name:"CourseDetail",params:{courseName:h.courseName}});return}i.value=r.membership?.progress},G=()=>{d.data&&t.data&&!t.data.progress&&J.submit()},J=I({url:"lms.lms.doctype.course_lesson.course_lesson.save_progress",makeParams(){return{lesson:t.data.name,course:h.courseName}},onSuccess(r){i.value=r}}),K=me(()=>{let r=[{label:"Courses",route:{name:"Courses"}}];return r.push({label:t?.data?.course_title,route:{name:"CourseDetail",params:{courseName:h.courseName}}}),r.push({label:t?.data?.title,route:{name:"Lesson",params:{courseName:h.courseName,chapterNumber:h.chapterNumber,lessonNumber:h.lessonNumber}}}),r});B([()=>w.params.chapterNumber,()=>w.params.lessonNumber],([r,_],[q,N])=>{(r||_)&&(v.value=null,T.value=null,p.value=!1,t.submit({chapter:r,lesson:_}),clearInterval(z),S.value=0,V(),j())}),B(()=>t.data,r=>{H(r),j()});const V=()=>{z=setInterval(()=>{S.value++,S.value==30&&(clearInterval(z),G())},1e3)};D(()=>{clearInterval(z)});const U=()=>window.read_only_mode?!1:!!(d.data?.is_moderator||t.data?.instructors?.includes(d.data?.name)),W=()=>!!(d.data?.is_moderator||t.data?.instructors?.includes(d.data?.name)),X=I({url:"frappe.client.insert",makeParams(){return{doc:{doctype:"LMS Enrollment",course:h.courseName,member:d.data?.name}}}}),ee=()=>{X.submit({},{onSuccess(){window.location.reload()}})},te=()=>!!(d.data?.is_moderator||d.data?.is_instructor||d.data?.is_evaluator||t.data?.membership),se=()=>{b.value.requestFullscreen?b.value.requestFullscreen():b.value.mozRequestFullScreen?b.value.mozRequestFullScreen():b.value.webkitRequestFullscreen?b.value.webkitRequestFullscreen():b.value.msRequestFullscreen&&b.value.msRequestFullscreen()},re=()=>{p.value?p.value=!1:(p.value=!0,oe())},oe=()=>{Ne(()=>{E.value?.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})})},ae=()=>{window.location.href=`/login?redirect-to=/lms/courses/${h.courseName}`};return pe(()=>({title:t?.data?.title,icon:Y.favicon})),(r,_)=>{const q=_e("router-link");return e(t).data?(s(),a("div",We,[o("header",Xe,[u(e($e),{class:"h-7",items:K.value},null,8,["items"]),o("div",et,[te()?(s(),m(e(he),{key:0,text:r.__("Zen Mode")},{default:l(()=>[u(e(g),{onClick:_[0]||(_[0]=N=>se())},{icon:l(()=>[u(e(fe),{class:"w-4 h-4 stroke-2"})]),_:1})]),_:1},8,["text"])):f("",!0),u(Me,{courseName:c.courseName},null,8,["courseName"])])]),o("div",tt,[e(t).data.no_preview?(s(),a("div",st,[o("div",rt,[o("div",ot,[u(e(ve),{class:"size-4 stroke-2 text-ink-gray-5"}),o("div",at,n(r.__("This lesson is locked")),1)]),o("div",nt,n(r.__("This lesson is not available for preview. Please enroll in the course to access it.")),1),e(d).data&&!e(t).data.disable_self_learning?(s(),m(e(g),{key:0,onClick:_[1]||(_[1]=N=>ee()),variant:"solid"},{default:l(()=>[C(n(r.__("Start Learning")),1)]),_:1})):e(t).data.disable_self_learning?(s(),m(e(be),{key:1,theme:"blue",size:"lg",class:"mt-2"},{default:l(()=>[C(n(r.__("Contact the Administrator to enroll for this course.")),1)]),_:1})):(s(),m(e(g),{key:2,onClick:_[2]||(_[2]=N=>ae())},{prefix:l(()=>[u(e(ye),{class:"w-4 h-4 stroke-1"})]),default:l(()=>[C(" "+n(r.__("Login")),1)]),_:1}))])])):(s(),a("div",{key:1,ref_key:"lessonContainer",ref:b,class:P(["bg-surface-white",{"overflow-y-auto":x.value}])},[o("div",{class:P(["border-r container pt-5 pb-10 px-5 h-full",{"w-full md:w-3/5 mx-auto border-none !pt-10":x.value}])},[o("div",it,[o("div",lt,[o("div",ut,n(e(t).data.title),1),x.value?(s(),a("div",dt,[o("span",null,n(e(t).data.chapter_title)+" - "+n(e(t).data.course_title),1),u(e(ge),{class:"size-3"}),o("div",ct,n(Math.ceil(e(t).data.membership.progress))+"% "+n(r.__("completed")),1)])):f("",!0)]),o("div",mt,[x.value?(s(),m(e(g),{key:0,onClick:_[3]||(_[3]=N=>re())},{icon:l(()=>[u(e(ke),{class:"w-4 h-4 stroke-1.5"})]),_:1})):f("",!0),e(t).data.prev?(s(),m(q,{key:1,to:{name:"Lesson",params:{courseName:c.courseName,chapterNumber:e(t).data.prev.split(".")[0],lessonNumber:e(t).data.prev.split(".")[1]}}},{default:l(()=>[u(e(g),null,{prefix:l(()=>[u(e(we),{class:"w-4 h-4 stroke-1"})]),default:l(()=>[o("span",null,n(r.__("Previous")),1)]),_:1})]),_:1},8,["to"])):f("",!0),U()?(s(),m(q,{key:2,to:{name:"LessonForm",params:{courseName:c.courseName,chapterNumber:h.chapterNumber,lessonNumber:h.lessonNumber}}},{default:l(()=>[u(e(g),null,{default:l(()=>[C(n(r.__("Edit")),1)]),_:1})]),_:1},8,["to"])):f("",!0),e(t).data.next?(s(),m(q,{key:3,to:{name:"Lesson",params:{courseName:c.courseName,chapterNumber:e(t).data.next.split(".")[0],lessonNumber:e(t).data.next.split(".")[1]}}},{default:l(()=>[u(e(g),null,{suffix:l(()=>[u(e(xe),{class:"w-4 h-4 stroke-1"})]),default:l(()=>[o("span",null,n(r.__("Next")),1)]),_:1})]),_:1},8,["to"])):(s(),m(q,{key:4,to:{name:"CourseDetail",params:{courseName:c.courseName}}},{default:l(()=>[u(e(g),null,{default:l(()=>[C(n(r.__("Back to Course")),1)]),_:1})]),_:1},8,["to"]))])]),x.value?f("",!0):(s(),a("div",pt,[o("span",{class:P(["h-6 mr-1",{"avatar-group overlap":e(t).data.instructors?.length>1}])},[(s(!0),a(F,null,A(e(t).data.instructors,N=>(s(),m(Ce,{user:N},null,8,["user"]))),256))],2),e(t).data?.instructors?(s(),m(Ie,{key:0,instructors:e(t).data.instructors},null,8,["instructors"])):f("",!0)])),e(t).data.instructor_content&&JSON.parse(e(t).data.instructor_content)?.blocks?.length>1&&W()?(s(),a("div",_t,[o("div",ft,n(r.__("Instructor Notes")),1),_[4]||(_[4]=o("div",{id:"instructor-content",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,-1))])):e(t).data.instructor_notes?(s(),a("div",ht,[u(Z,{content:e(t).data.instructor_notes},null,8,["content"])])):f("",!0),e(t).data.content?(s(),a("div",vt,_[5]||(_[5]=[o("div",{id:"editor"},null,-1)]))):(s(),a("div",bt,[e(t).data?.body?(s(),m(Z,{key:0,content:e(t).data.body,youtube:e(t).data.youtube,quizId:e(t).data.quiz_id},null,8,["content","youtube","quizId"])):f("",!0)])),o("div",{class:"mt-20",ref_key:"discussionsContainer",ref:E},[p.value?(s(),m(ze,{title:"Questions",doctype:"Course Lesson",docname:e(t).data.name,key:e(t).data.name},null,8,["docname"])):f("",!0)],512)],2)],2)),o("div",yt,[o("div",gt,[o("div",kt,n(e(t).data.course_title),1),e(d)&&e(t).data.membership?(s(),a("div",wt,n(Math.ceil(i.value))+"% "+n(r.__("completed")),1)):f("",!0),e(d)&&e(t).data.membership?(s(),m(Pe,{key:1,progress:i.value},null,8,["progress"])):f("",!0)]),(s(),m(qe,{courseName:c.courseName,key:c.chapterNumber,getProgress:!!e(t).data.membership},null,8,["courseName","getProgress"]))])])])):f("",!0)}}};export{Wt as default};
