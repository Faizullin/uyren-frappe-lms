import{V as Z,W as K,g as R,i as X,aE as G,X as P,L as v,D as Y,E as h,o as d,w as _,d as r,c,h as k,t as b,b as n,p as t,aV as J,aU as ee,I as p,F as D,f as O,au as se,H as z,e as S,Y as te,R as q,B as ae,u as le,n as oe,aa as ne,z as W,a as ie,r as ue,P as re,av as de,aw as me,ay as _e,az as ce,aA as pe,aB as fe,aC as be,aD as ye,Z as ke}from"./index-RevCnO16.js";import{_ as qe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CeasAM64.js";const ve={class:"p-5 space-y-5"},Ve={class:"text-lg font-semibold text-ink-gray-9 mb-5"},ge={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},we={key:1,class:"space-y-2"},he={class:"block text-xs text-ink-gray-5 mb-1"},ze={class:"grid grid-cols-2 gap-4"},Qe={key:0,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-5"},$e={key:1,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-5"},Se={key:2,class:"grid grid-cols-2 gap-4"},De={class:"space-y-4 py-2"},Ue={key:3,class:"grid grid-cols-2 gap-4 py-2"},Me={key:2,class:"space-y-2"},xe={class:"flex items-center justify-end space-x-2 mt-5"},Ce={__name:"Question",props:Z({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(Q){const y=K(Q,"modelValue"),g=K(Q,"quiz"),f=R(!1),w=R(!1),U=X("$user"),{updateOnboardingStep:M}=G("learning"),m=P({question:"",marks:1}),s=P({question:"",type:"Choices",marks:1}),$=()=>{let l=["option","is_correct","explanation","possibility"],i=1;l.forEach(e=>{for(;i<=4;)s[`${e}_${i}`]=e==="is_correct"?!1:null,i++})};$();const u=Q,x=v({url:"frappe.client.get",makeParams(){return{doctype:"LMS Question",name:u.questionDetail.question}},auto:!1,onSuccess(l){let i=1;for(w.value=!0,Object.keys(l).forEach(e=>{Object.hasOwn(s,e)&&(s[e]=l[e])});i<=4;)s[`is_correct_${i}`]=!!l[`is_correct_${i}`],i++;s.marks=u.questionDetail.marks}});Y(y,()=>{y.value&&(w.value=!1,u.questionDetail.question?x.fetch():(s.question="",s.marks=1,s.type="Choices",m.question="",m.marks=1,f.value=!1,$()),u.questionDetail.marks&&(s.marks=u.questionDetail.marks))});const T=v({url:"frappe.client.insert",makeParams(l){return{doc:{doctype:"LMS Quiz Question",parent:g.value.data.name,parentfield:"questions",parenttype:"LMS Quiz",...l}}}}),C=v({url:"frappe.client.insert",makeParams(l){return{doc:{doctype:"LMS Question",...s}}}}),j=()=>{u.questionDetail?.question?B():A()},A=()=>{f.value?L({question:m.question,marks:m.marks}):C.submit({},{onSuccess(l){L({question:l.name,marks:s.marks})},onError(l){q.error(l.messages?.[0]||l)}})},L=l=>{T.submit({...l},{onSuccess(){U.data?.is_system_manager&&M("create_first_quiz"),y.value=!1,q.success(__("Question added successfully")),g.value.reload(),y.value=!1},onError(i){q.error(i.messages?.[0]||i),y.value=!1}})},E=v({url:"frappe.client.set_value",auto:!1,makeParams(l){return{doctype:"LMS Question",name:x.data?.name,fieldname:{...s}}}}),I=v({url:"frappe.client.set_value",auto:!1,makeParams(l){return{doctype:"LMS Quiz Question",name:u.questionDetail.name,fieldname:{marks:s.marks}}}}),B=()=>{E.submit({},{onSuccess(){I.submit({},{onSuccess(){y.value=!1,q.success(__("Question updated successfully")),g.value.reload()}})},onError(l){q.error(l.messages?.[0]||l)}})};return(l,i)=>(d(),h(t(te),{modelValue:y.value,"onUpdate:modelValue":i[7]||(i[7]=e=>y.value=e),options:{size:"3xl"}},{body:_(()=>[r("div",ve,[r("div",Ve,b(l.__(u.title)),1),w.value?k("",!0):(d(),c("div",ge,[n(t(J),{size:"sm",label:l.__("Choose an existing question"),modelValue:f.value,"onUpdate:modelValue":i[0]||(i[0]=e=>f.value=e),class:"!p-0"},null,8,["label","modelValue"])])),!f.value||w.value?(d(),c("div",we,[r("div",null,[r("label",he,b(l.__("Question")),1),n(t(ee),{content:s.question,onChange:i[1]||(i[1]=e=>s.question=e),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r("div",ze,[n(t(p),{modelValue:s.marks,"onUpdate:modelValue":i[2]||(i[2]=e=>s.marks=e),label:l.__("Marks"),type:"number"},null,8,["modelValue","label"]),n(t(p),{label:l.__("Type"),modelValue:s.type,"onUpdate:modelValue":i[3]||(i[3]=e=>s.type=e),type:"select",options:["Choices","User Input","Open Ended"],class:"pb-2",required:!0},null,8,["label","modelValue"])]),s.type=="Choices"?(d(),c("div",Qe,b(l.__("Options")),1)):s.type=="User Input"?(d(),c("div",$e,b(l.__("Possibilities")),1)):k("",!0),s.type=="Choices"?(d(),c("div",Se,[(d(),c(D,null,O(4,e=>r("div",De,[n(t(p),{label:l.__("Option")+" "+e,modelValue:s[`option_${e}`],"onUpdate:modelValue":a=>s[`option_${e}`]=a,required:e<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),n(t(p),{label:l.__("Explanation"),modelValue:s[`explanation_${e}`],"onUpdate:modelValue":a=>s[`explanation_${e}`]=a},null,8,["label","modelValue","onUpdate:modelValue"]),n(t(p),{label:l.__("Correct Answer"),modelValue:s[`is_correct_${e}`],"onUpdate:modelValue":a=>s[`is_correct_${e}`]=a,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):s.type=="User Input"?(d(),c("div",Ue,[(d(),c(D,null,O(4,e=>r("div",null,[n(t(p),{label:l.__("Possibility")+" "+e,modelValue:s[`possibility_${e}`],"onUpdate:modelValue":a=>s[`possibility_${e}`]=a,required:e==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64))])):k("",!0)])):f.value?(d(),c("div",Me,[n(se,{modelValue:m.question,"onUpdate:modelValue":i[4]||(i[4]=e=>m.question=e),label:l.__("Select a question"),doctype:"LMS Question"},null,8,["modelValue","label"]),n(t(p),{modelValue:m.marks,"onUpdate:modelValue":i[5]||(i[5]=e=>m.marks=e),label:l.__("Marks"),type:"number"},null,8,["modelValue","label"])])):k("",!0),r("div",xe,[n(t(z),{variant:"solid",onClick:i[6]||(i[6]=e=>j())},{default:_(()=>[S(b(l.__("Submit")),1)]),_:1})])])]),_:1},8,["modelValue"]))}},Le={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ee={key:0,class:"space-x-2"},Ie={class:"w-3/4 mx-auto py-5"},Pe={class:"mb-8"},Oe={class:"font-semibold text-ink-gray-9 mb-4"},Te={key:0},je={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Ae={class:"mb-8"},Be={class:"font-semibold text-ink-gray-9 mb-4"},Fe={class:"grid grid-cols-3 gap-5 my-4"},Ne={class:"mb-8"},Re={class:"font-semibold text-ink-gray-9 mb-4"},He={class:"grid grid-cols-3"},Ke={class:"flex items-center justify-between mb-4"},We={class:"font-semibold text-ink-gray-9"},Xe=["innerHTML"],Ye={key:1,class:"text-xs"},Ze={class:"flex gap-2"},es={__name:"QuizForm",props:{quizID:{type:String,required:!0}},setup(Q){const{brand:y}=ae(),g=R(!1),f=P({question:"",marks:0,name:""}),w=X("$user"),U=le(),M=window.read_only_mode,m=Q,s=P({title:"",total_marks:0,passing_percentage:0,max_attempts:0,duration:0,limit_questions_to:0,show_answers:!0,show_submission_history:!1,shuffle_questions:!1,questions:[]});oe(()=>{m.quizID=="new"&&!w.data?.is_moderator&&!w.data?.is_instructor&&U.push({name:"Courses"}),m.quizID!=="new"&&u.reload(),window.addEventListener("keydown",$)});const $=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(C(),e.preventDefault())};ne(()=>{window.removeEventListener("keydown",$)}),Y(()=>m.quizID!=="new",e=>{e&&u.reload()});const u=v({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Quiz",name:m.quizID}},auto:!1,onSuccess(e){Object.keys(e).forEach(V=>{Object.hasOwn(s,V)&&(s[V]=e[V])});let a=["show_answers","show_submission_history","shuffle_questions"];for(let V in a){let o=a[V];s[o]=!!s[o]}}}),x=v({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:{doctype:"LMS Quiz",...s}}}}),T=v({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Quiz",name:e.quizID,fieldname:{total_marks:L(),...s}}}}),C=()=>{u.data?.name?A():j()},j=()=>{x.submit({},{onSuccess(e){q.success(__("Quiz created successfully")),U.push({name:"QuizForm",params:{quizID:e.name}})},onError(e){q.error(e.messages?.[0]||e)}})},A=()=>{T.submit({quizID:u.data?.name},{onSuccess(e){s.total_marks=e.total_marks,q.success(__("Quiz updated successfully"))},onError(e){q.error(e.messages?.[0]||e)}})},L=()=>{let e=0;return s.limit_questions_to&&s.questions.length>0?s.questions[0].marks*s.limit_questions_to:(s.questions.forEach(a=>{e+=a.marks}),e)},E=W(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Marks"),key:"marks",width:"5rem"}]),I=(e=null)=>{e?(f.question=e.question,f.marks=e.marks,f.name=e.name):(f.question="",f.marks=0,f.name=""),g.value=!0},B=v({url:"lms.lms.api.delete_documents",makeParams(e){return{doctype:"LMS Quiz Question",documents:e.questions}}}),l=(e,a)=>{B.submit({questions:Array.from(e)},{onSuccess(){q.success(__("Questions deleted successfully")),u.reload(),a()}})},i=W(()=>{let e=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return e.push({label:m.quizID=="new"?__("New Quiz"):u.data?.title,route:{name:"QuizForm",params:{quizID:m.quizID}}}),e});return ie(()=>({title:m.quizID=="new"?__("New Quiz"):u.data?.title,icon:y.favicon})),(e,a)=>{const V=ue("router-link");return d(),c(D,null,[r("header",Le,[n(t(qe),{items:i.value},null,8,["items"]),t(M)?k("",!0):(d(),c("div",Ee,[t(u).data?.name?(d(),h(V,{key:0,to:{name:"QuizPage",params:{quizID:t(u).data.name}}},{default:_(()=>[n(t(z),null,{default:_(()=>[S(b(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):k("",!0),t(u).data?.name?(d(),h(V,{key:1,to:{name:"QuizSubmissionList",params:{quizID:t(u).data.name}}},{default:_(()=>[n(t(z),null,{default:_(()=>[S(b(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):k("",!0),n(t(z),{variant:"solid",onClick:a[0]||(a[0]=o=>C())},{default:_(()=>[S(b(e.__("Save")),1)]),_:1})]))]),r("div",Ie,[r("div",Pe,[r("div",Oe,b(e.__("Details")),1),n(t(p),{modelValue:s.title,"onUpdate:modelValue":a[1]||(a[1]=o=>s.title=o),label:t(u).data?.name?e.__("Title"):e.__("Enter a title and save the quiz to proceed"),required:!0},null,8,["modelValue","label"]),t(u).data?.name?(d(),c("div",Te,[r("div",je,[n(t(p),{type:"number",modelValue:s.max_attempts,"onUpdate:modelValue":a[2]||(a[2]=o=>s.max_attempts=o),label:e.__("Maximum Attempts")},null,8,["modelValue","label"]),n(t(p),{type:"number",modelValue:s.duration,"onUpdate:modelValue":a[3]||(a[3]=o=>s.duration=o),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),n(t(p),{modelValue:s.total_marks,"onUpdate:modelValue":a[4]||(a[4]=o=>s.total_marks=o),label:e.__("Total Marks"),disabled:""},null,8,["modelValue","label"]),n(t(p),{modelValue:s.passing_percentage,"onUpdate:modelValue":a[5]||(a[5]=o=>s.passing_percentage=o),label:e.__("Passing Percentage")},null,8,["modelValue","label"])]),r("div",Ae,[r("div",Be,b(e.__("Settings")),1),r("div",Fe,[n(t(p),{modelValue:s.show_answers,"onUpdate:modelValue":a[6]||(a[6]=o=>s.show_answers=o),type:"checkbox",label:e.__("Show Answers")},null,8,["modelValue","label"]),n(t(p),{modelValue:s.show_submission_history,"onUpdate:modelValue":a[7]||(a[7]=o=>s.show_submission_history=o),type:"checkbox",label:e.__("Show Submission History")},null,8,["modelValue","label"])])]),r("div",Ne,[r("div",Re,b(e.__("Shuffle Settings")),1),r("div",He,[n(t(p),{modelValue:s.shuffle_questions,"onUpdate:modelValue":a[8]||(a[8]=o=>s.shuffle_questions=o),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),s.shuffle_questions?(d(),h(t(p),{key:0,modelValue:s.limit_questions_to,"onUpdate:modelValue":a[9]||(a[9]=o=>s.limit_questions_to=o),label:e.__("Limit Questions To")},null,8,["modelValue","label"])):k("",!0)])]),r("div",null,[r("div",Ke,[r("div",We,b(e.__("Questions")),1),t(M)?k("",!0):(d(),h(t(z),{key:0,onClick:a[10]||(a[10]=o=>I())},{prefix:_(()=>[n(t(re),{class:"w-4 h-4"})]),default:_(()=>[S(" "+b(e.__("New Question")),1)]),_:1}))]),n(t(ye),{columns:E.value,rows:s.questions,"row-key":"name",options:{showTooltip:!1}},{default:_(()=>[n(t(de),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:_(()=>[(d(!0),c(D,null,O(E.value,o=>(d(),h(t(me),{item:o},null,8,["item"]))),256))]),_:1}),n(t(_e),null,{default:_(()=>[(d(!0),c(D,null,O(s.questions,o=>(d(),h(t(ce),{row:o,onClick:F=>I(o),class:"cursor-pointer"},{default:_(({idx:F,column:H,item:N})=>[n(t(pe),{item:N},{default:_(()=>[H.key=="question_detail"?(d(),c("div",{key:0,class:"text-xs truncate h-4",innerHTML:N},null,8,Xe)):(d(),c("div",Ye,b(N),1))]),_:2},1032,["item"])]),_:2},1032,["row","onClick"]))),256))]),_:1}),n(t(fe),null,{actions:_(({unselectAll:o,selections:F})=>[r("div",Ze,[n(t(z),{variant:"ghost",onClick:H=>l(F,o)},{default:_(()=>[n(t(be),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):k("",!0)])]),n(Ce,{modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=o=>g.value=o),questionDetail:f,quiz:t(u),"onUpdate:quiz":a[12]||(a[12]=o=>ke(u)?u.value=o:null),title:f.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{es as default};
//# sourceMappingURL=QuizForm-_MM_NE6g.js.map
