import{x as oe,c as h,o as i,d as t,aJ as re,V as le,W as ne,g,X as Z,D as Y,z as j,E as M,w as b,b as a,p as e,I as O,au as de,H as Q,e as E,t as w,P as ce,aD as me,av as pe,F as H,f as D,aw as ve,h as R,ax as fe,ay as ge,az as _e,aA as ye,cm as ae,aB as be,aC as he,Y as W,R as A,n as ie,q as K,cn as we,k as ue,v as ke,Z as ze,as as xe,co as G,cp as Ce,cq as Ve,cr as $e,af as Se,cs as Te,a1 as qe,a2 as Ne,a3 as Le,ct as Me,cu as Re,a4 as Qe,cv as Ie,cw as Ee,cx as Ue,cy as Pe,B as Oe,i as Ae,aE as He,T as ee,ab as Be,L as J,aa as je,a as Fe,ai as De,bA as Je,aU as te,cz as Ye}from"./index-RevCnO16.js";import{_ as We}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CeasAM64.js";import{_ as Xe}from"./Quiz-BJ_gUwcF.js";import{_ as Ze}from"./Tabs-DLV3y4DS.js";import"./ProgressBar-D6f4tpmc.js";const Ke={},Ge={width:"20",height:"20",viewBox:"0 0 68 75",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function et(u,l){return i(),h("svg",Ge,l[0]||(l[0]=[t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M0 6.78182C0 1.60212 5.5742 -1.65958 10.09 0.879521L64.09 31.2545C68.6916 33.8443 68.6916 40.4693 64.09 43.0595L10.09 73.4345C5.5744 75.9736 0 72.7119 0 67.5322V6.78182ZM26.2695 38.5201C26.2695 37.3248 25.2265 37.9342 26.2695 38.5201C27.332 39.1178 27.332 37.9225 26.2695 38.5201Z",fill:"white"},null,-1)]))}const se=oe(Ke,[["render",et]]),tt={class:"text-base"},st={class:"flex items-end gap-4"},ot={class:"mt-10 mb-5"},lt={class:"font-medium mb-4"},nt={key:0,class:"leading-5 text-sm"},at={key:1,class:"leading-5 text-sm"},it={class:"flex gap-2"},ut={key:1,class:"text-ink-gray-5 italic text-xs"},rt=re({__name:"QuizInVideo",props:le({quizzes:{type:Array,default:()=>[]},saveQuizzes:{type:Function,required:!0},duration:{type:Number,default:0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const l=ne(u,"modelValue"),r=g([]),o=Z({time:"",quiz:""}),m=u,q=()=>{o.time=`${z()}`,!(!V()||!N())&&(r.value.push({time:o.time,quiz:o.quiz}),m.saveQuizzes(r.value),o.time="",o.quiz="")},z=()=>{o.time&&!o.time.includes(":")&&(o.time=`${o.time}:00`);const d=o.time.split(":");return parseInt(d[0])*60+parseInt(d[1])},V=()=>parseInt(o.time)>m.duration?(A.error(__("Time in video exceeds the total duration of the video.")),!1):!0,N=()=>o.time?o.quiz?!0:(A.error(__("Please select a quiz")),!1):(A.error(__("Please enter a valid timestamp")),!1),k=(d,c)=>{Array.from(d).forEach(f=>{const x=r.value.findIndex(I=>I.quiz===f);x!==-1&&r.value.splice(x,1),c()}),m.saveQuizzes(r.value)};Y(()=>m.quizzes,d=>{r.value=d},{immediate:!0});const p=j(()=>[{key:"quiz",label:__("Quiz")},{key:"time",label:__("Time in Video (minutes)"),align:"center"}]);return(d,c)=>(i(),M(e(W),{modelValue:l.value,"onUpdate:modelValue":c[3]||(c[3]=f=>l.value=f),options:{title:d.__("Add quiz to this video"),size:"2xl"}},{"body-content":b(()=>[t("div",tt,[t("div",st,[a(e(O),{label:d.__("Time in Video"),modelValue:o.time,"onUpdate:modelValue":c[0]||(c[0]=f=>o.time=f),type:"text",placeholder:"2:15",class:"flex-1"},null,8,["label","modelValue"]),a(de,{modelValue:o.quiz,"onUpdate:modelValue":c[1]||(c[1]=f=>o.quiz=f),label:d.__("Quiz"),doctype:"LMS Quiz",class:"flex-1"},null,8,["modelValue","label"]),a(e(Q),{onClick:c[2]||(c[2]=f=>q()),variant:"solid"},{prefix:b(()=>[a(e(ce),{class:"w-4 h-4 stroke-1.5"})]),default:b(()=>[E(" "+w(d.__("Add")),1)]),_:1})]),t("div",ot,[t("div",lt,w(d.__("Quizzes in this video")),1),r.value.length?(i(),M(e(me),{key:0,columns:p.value,rows:r.value,"row-key":"quiz",options:{showTooltip:!1}},{default:b(()=>[a(e(pe),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:b(()=>[(i(!0),h(H,null,D(p.value,f=>(i(),M(e(ve),{item:f},{prefix:b(({item:x})=>[x.icon?(i(),M(fe(x.icon),{key:0,class:"h-4 w-4 stroke-1.5 ml-4"})):R("",!0)]),_:2},1032,["item"]))),256))]),_:1}),a(e(ge),null,{default:b(()=>[(i(!0),h(H,null,D(r.value,f=>(i(),M(e(_e),{row:f},{default:b(({column:x,item:I})=>[a(e(ye),{item:f[x.key],align:x.align},{default:b(()=>[x.key=="time"?(i(),h("div",nt,w(e(ae)(f[x.key])),1)):(i(),h("div",at,w(f[x.key]),1))]),_:2},1032,["item","align"])]),_:2},1032,["row"]))),256))]),_:1}),a(e(be),null,{actions:b(({unselectAll:f,selections:x})=>[t("div",it,[a(e(Q),{variant:"ghost",onClick:I=>k(x,f)},{default:b(()=>[a(e(he),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])):(i(),h("div",ut,w(d.__("No quizzes added yet.")),1))])])]),_:1},8,["modelValue","options"]))}}),dt={key:0,class:"leading-5"},ct={class:"pl-3 mt-1"},mt={class:"font-semibold"},pt=["src","type"],vt={class:"rounded-full p-4 pl-4.5",style:{background:`radial-gradient(
							circle,
							rgba(0, 0, 0, 0.3) 0%,
							rgba(0, 0, 0, 0.4) 50%
						)`}},ft={class:"relative flex items-center w-full flex-1"},gt=["max"],_t={class:"absolute top-0 left-0 w-full h-full pointer-events-none"},yt={class:"text-sm font-medium"},bt={class:"flex flex-col space-y-2 p-5 text-base leading-5"},ht={class:"font-semibold"},wt={__name:"VideoBlock",props:{file:{type:String,required:!0},type:{type:String,default:"video/mp4"},readOnly:{type:String,default:!0},quizzes:{type:Array,default:()=>[]},saveQuizzes:{type:Function}},setup(u){const l=g(null),r=g(null);let o=g(!1),m=g(0),q=g(0),z=g(!1);const V=g(!1),N=g(!1),k=g(!1),p=g(0),d=g(null),c=g({}),f=u;ie(()=>{x(),P()});const x=()=>{setTimeout(()=>{l.value.onloadedmetadata=()=>{q.value=l.value.duration},l.value.ontimeupdate=()=>{m.value=l.value?.currentTime||m.value,m.value>=c.value.time&&(l.value.pause(),o.value=!1,l.value.onTimeupdate=null,d.value=c.value.quiz,p.value=7)}},0)};Y(p,()=>{p.value>0?(k.value=!0,setTimeout(()=>{p.value-=1},1e3)):(k.value=!1,N.value=!0)});const I=(y=!1)=>{N.value=!1,d.value=null,x(),setTimeout(()=>{l.value.currentTime=y?0:m.value,l.value.play(),o.value=!0,P()},0)},P=()=>{if(!f.quizzes.length)return;f.quizzes.forEach(C=>{if(typeof C.time=="string"&&C.time.includes(":")){let B=C.time.split(":"),L=parseInt(B[0])*60+parseInt(B[1]);C.time=L}}),f.quizzes.sort((C,B)=>C.time-B.time);const y=f.quizzes.findIndex(C=>C.time>m.value);y!==-1?c.value=f.quizzes[y]:c.value={}},F=j(()=>f.file),U=()=>{l.value.play(),o.value=!0},v=()=>{l.value.pause(),o.value=!1},n=()=>{o.value?v():U()},$=()=>{o.value=!1},T=()=>{l.value.muted=!l.value.muted,z.value=l.value.muted},S=()=>{l.value.currentTime=m.value,P()},s=()=>{document.fullscreenElement?document.exitFullscreen():r.value.requestFullscreen()},_=y=>({left:`${(y-5)/Math.ceil(q.value)*100}%`});return(y,C)=>{const B=Xe;return i(),h(H,null,[t("div",null,[u.quizzes.length&&!N.value&&u.readOnly?(i(),h("div",dt,[E(w(y.__("This video contains {0} {1}:").format(u.quizzes.length,u.quizzes.length==1?"quiz":"quizzes"))+" ",1),(i(!0),h(H,null,D(u.quizzes,(L,X)=>(i(),h("div",ct,[t("span",null,[E(w(X+1)+". ",1),t("span",mt,w(L.quiz),1)]),E(" "+w(y.__("at {0} minutes").format(e(ae)(L.time))),1)]))),256))])):R("",!0),N.value?R("",!0):(i(),h("div",{key:1,ref_key:"videoContainer",ref:r,class:"video-block relative group"},[t("video",{onTimeupdate:C[0]||(C[0]=(...L)=>y.updateTime&&y.updateTime(...L)),onEnded:$,onClick:n,oncontextmenu:"return false",class:"rounded-md border border-gray-100 cursor-pointer",ref_key:"videoRef",ref:l},[t("source",{src:F.value,type:u.type},null,8,pt)],544),e(o)?R("",!0):(i(),h("div",{key:0,class:"absolute inset-0 flex items-center justify-center cursor-pointer",onClick:U},[t("div",vt,[a(se)])])),t("div",{class:K(["flex items-center space-x-2 py-2 px-1 text-ink-white bg-gradient-to-b from-transparent to-black/75 absolute bottom-0 left-0 right-0 mx-auto rounded-md",{"invisible group-hover:visible":e(o)}])},[a(e(Q),{variant:"ghost",class:"hover:bg-transparent"},{icon:b(()=>[e(o)?(i(),M(e(we),{key:1,onClick:v,class:"size-5 text-ink-white"})):(i(),M(se,{key:0,onClick:U,class:"size-4 text-ink-gray-9"}))]),_:1}),t("div",ft,[ue(t("input",{type:"range",min:"0",max:e(q),step:"0.1","onUpdate:modelValue":C[1]||(C[1]=L=>ze(m)?m.value=L:m=L),onInput:S,class:"duration-slider h-1"},null,40,gt),[[ke,e(m)]]),t("div",_t,[(i(!0),h(H,null,D(u.quizzes,(L,X)=>(i(),h("div",{key:X,style:xe(_(L.time)),class:"absolute top-0 h-full w-2 bg-surface-amber-3"},null,4))),128))])]),t("span",yt,w(e(G)(e(m)))+" / "+w(e(G)(e(q))),1),a(e(Q),{variant:"ghost",onClick:T,class:"hover:bg-transparent"},{icon:b(()=>[e(z)?(i(),M(e(Ve),{key:1,class:"size-5 text-ink-white"})):(i(),M(e(Ce),{key:0,class:"size-5 text-ink-white"}))]),_:1}),a(e(Q),{variant:"ghost",onClick:s,class:"hover:bg-transparent"},{icon:b(()=>[a(e($e),{class:"size-5 text-ink-white"})]),_:1})],2)],512)),N.value?(i(),M(B,{key:2,quizName:d.value,inVideo:!0,backToVideo:I},null,8,["quizName"])):R("",!0),u.readOnly?R("",!0):(i(),h("div",{key:3,onClick:C[2]||(C[2]=L=>V.value=!0)},[a(e(Q),null,{default:b(()=>[E(w(y.__("Add Quiz to Video")),1)]),_:1})]))]),a(rt,{modelValue:V.value,"onUpdate:modelValue":C[3]||(C[3]=L=>V.value=L),quizzes:u.quizzes,saveQuizzes:u.saveQuizzes,duration:e(q)},null,8,["modelValue","quizzes","saveQuizzes","duration"]),a(e(W),{modelValue:k.value,"onUpdate:modelValue":C[4]||(C[4]=L=>k.value=L),options:{size:"sm"}},{body:b(()=>[t("div",bt,[t("span",ht,w(y.__("Time for a Quiz")),1),t("span",null,w(y.__("Complete the upcoming quiz to continue watching the video. The quiz will open in {0} {1}.").format(p.value,p.value===1?"second":"seconds")),1)])]),_:1},8,["modelValue"])],64)}}},kt=oe(wt,[["__scopeId","data-v-6713f9c1"]]),zt={__name:"ExplanationVideos",props:le({type:{type:[String,null],required:!0},title:{type:[String,null],required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const l=ne(u,"modelValue"),r=u,o=j(()=>{if(r.type=="youtube")return"/assets/lms/frontend/Youtube.mp4";if(r.type=="quiz")return"/assets/lms/frontend/Quiz.mp4";if(r.type=="upload")return"/assets/lms/frontend/Upload.mp4";if(r.type=="remove")return"/assets/lms/frontend/Remove.mp4"});return(m,q)=>(i(),M(e(W),{modelValue:l.value,"onUpdate:modelValue":q[0]||(q[0]=z=>l.value=z),options:{size:"4xl",title:u.title}},{"body-content":b(()=>[t("div",null,[a(kt,{file:o.value},null,8,["file"])])]),_:1},8,["modelValue","options"]))}},xt={class:"space-y-5 text-ink-gray-9"},Ct={class:"space-y-2"},Vt={class:"flex items-center text-sm font-medium space-x-2"},$t={class:"text-xs text-ink-gray-5 mb-1 leading-5"},St=["onClick"],Tt={class:"text-xs text-ink-gray-5 mb-1 leading-5"},qt={__name:"LessonHelp",setup(u){const l=g(!1),r=g(null),o=g(null),m={quiz:{title:"How to add a Quiz?",description:"Click on the add icon in the editor and select Quiz from the menu. It opens up a dialog, where you can either select a quiz from the list or create a new quiz. When you select the Create New option it redirects you to the quiz creation page."},upload:{title:"How to upload content from your system?",description:"To upload Image, Video, Audio or PDF from your system, click on the add icon and select upload from the menu. Then choose the file you want to add to the lesson and it gets added to your lesson."},youtube:{title:"How to add a YouTube Video?",description:"Copy the URL of the video from YouTube and paste it in the editor."},remove:{title:"How to remove an embed?",description:"To remove an embed like YouTube or Vimeo, put your cursor on the line below the embed, then drag your mouse cursor upwards to select the embed. Once the embed is selected press BackSpace."}},q=z=>{r.value=z,o.value=m[z].title,l.value=!0};return(z,V)=>(i(),h(H,null,[t("div",xt,[t("div",Ct,[t("div",Vt,[t("span",null,w(z.__("What does include in preview mean?")),1)]),t("div",$t,w(z.__("If Include in Preview is enabled for a lesson then the lesson will also be accessible to non logged in users.")),1)]),(i(),h(H,null,D(m,(N,k)=>t("div",{class:"space-y-2",key:k},[t("div",{class:"flex items-center text-sm font-medium space-x-2 cursor-pointer",onClick:p=>q(k)},[t("span",null,w(z.__(N.title)),1),a(e(Se),{class:"w-3 h-3 text-ink-gray-7"})],8,St),t("div",Tt,w(z.__(N.description)),1)])),64))]),a(zt,{modelValue:l.value,"onUpdate:modelValue":V[0]||(V[0]=N=>l.value=N),title:o.value,type:r.value},null,8,["modelValue","title","type"])],64))}},Nt={class:"code-block-container"},Lt={class:"code-block-controls"},Mt=["disabled"],Rt={key:0,class:"code-console"},Qt={class:"console-header"},It={key:0},Et={key:1},Ut={key:0,class:"code-output"},Pt={__name:"CodeBlockComponent",props:Te,setup(u){const l=u,r=g(!1),o=Z({allowRun:l.node.attrs.allowRun??!1,isStatic:l.node.attrs.isStatic??!1,language:l.node.attrs.language||null}),m=g(null);Y(m,v=>{console.log("selectValue changed:",v);const n=l.node.attrs;v&&v.value!==n.language&&(console.log("Updating language from",n,"to",v.value),l.updateAttributes({language:v.value}))});const q=j(()=>l.extension.options.lowlight.listLanguages().map(v=>({label:v,value:v})).concat([{label:"html",value:"xml"}]).sort((v,n)=>v.label.localeCompare(n.label)));function z(){l.updateAttributes({allowRun:o.allowRun,isStatic:o.isStatic,language:m.value?m.value.value:null}),console.log("Settings saved:",{allowRun:o.allowRun,isStatic:o.isStatic,language:m.value?m.value.value:null}),r.value=!1}Y(()=>r.value,v=>{if(v){const n=l.node.attrs.language;m.value=n&&q.value.find($=>$.value===n)||null}});const V=g({index:0}),N=g(""),k=g(""),p=g(!1),d=g(!1),c=g(!1),f=j(()=>l.node&&l.editor&&typeof l.updateAttributes=="function");async function x(){try{const v=l.node.textContent||"";await navigator.clipboard.writeText(v),console.log("Code copied to clipboard")}catch(v){console.error("Failed to copy code:",v)}}async function I(){if(l.node.attrs.allowRun){p.value=!0,c.value=!1,d.value=!0;try{const v=l.node.textContent||"",n=l.node.attrs.language||"javascript",$=await F(v,n);k.value=$}catch(v){c.value=!0,k.value=v.message||"An error occurred while running the code"}finally{p.value=!1}}}function P(){k.value="",d.value=!1,c.value=!1}async function F(v,n){try{const T=await fetch("http://82.115.49.85:8001/api/v1/executions/execute-immediate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:v,language:n||"javascript"})}),S=await T.json();if(!T.ok){if(T.status===422&&S.detail){const _=S.detail.map(y=>`${y.loc.join(".")}: ${y.msg}`).join(`
`);throw new Error(`Validation Error:
${_}`)}throw new Error(S.message||`HTTP ${T.status}: ${T.statusText}`)}let s="";return S.status==="string"&&(s+=`Status: ${S.status}
`),S.output&&(s+=`Output:
${S.output}
`),S.error_output&&(s+=`Errors:
${S.error_output}
`),S.execution_time&&(s+=`Execution Time: ${S.execution_time}
`),S.memory_usage&&(s+=`Memory Usage: ${S.memory_usage}
`),S.message&&(s+=`Message: ${S.message}`),s.trim()||"Code executed successfully (no output)"}catch($){throw $ instanceof TypeError&&$.message.includes("fetch")?new Error("Failed to connect to code execution service. Please check your network connection."):$}}async function U(){p.value=!0,p.value=!1}return(v,n)=>(i(),M(e(Ie),null,{default:b(()=>[t("div",Nt,[t("div",Lt,[t("button",{class:"action-btn",onClick:x,title:"Copy code"},[a(e(qe),{class:"h-4 w-4"})]),v.node.attrs.allowRun?(i(),h("button",{key:0,class:"action-btn",onClick:I,disabled:p.value,title:"Run code"},[p.value?(i(),M(e(Le),{key:1,class:"h-4 w-4 animate-spin"})):(i(),M(e(Ne),{key:0,class:"h-4 w-4"}))],8,Mt)):R("",!0),f.value?(i(),h("button",{key:1,class:"settings-btn",onClick:n[0]||(n[0]=$=>r.value=!0),title:"Code-block settings"},[a(e(Me),{class:"h-4 w-4"})])):R("",!0)]),t("pre",null,[t("code",null,[a(e(Re))])]),d.value&&k.value?(i(),h("div",Rt,[t("div",Qt,[n[8]||(n[8]=t("span",{class:"console-title"},"Output:",-1)),t("button",{onClick:P,class:"clear-btn",title:"Clear output"},[a(e(Qe),{class:"h-3 w-3"})])]),t("pre",{class:K(["console-content",{error:c.value}])},w(k.value),3)])):R("",!0)]),f.value?(i(),M(e(W),{key:0,modelValue:r.value,"onUpdate:modelValue":n[7]||(n[7]=$=>r.value=$)},{"body-title":b(()=>n[9]||(n[9]=[t("h3",null,"Code-block options",-1)])),"body-content":b(()=>[a(e(Ze),{as:"div",tabs:[{label:"Options",content:"Options"},{label:"Run",content:"Run"}],modelValue:V.value.index,"onUpdate:modelValue":n[5]||(n[5]=$=>V.value.index=$),class:"mt-4"},{"tab-panel":b(({tab:$})=>[V.value.index===0?(i(),h("div",It,[a(e(O),{type:"autocomplete",options:q.value,size:"sm",variant:"subtle",placeholder:"Select language",disabled:!1,label:"Language",modelValue:m.value,"onUpdate:modelValue":n[1]||(n[1]=T=>m.value=T),class:"mb-2"},null,8,["options","modelValue"]),a(e(O),{type:"checkbox",modelValue:o.allowRun,"onUpdate:modelValue":n[2]||(n[2]=T=>o.allowRun=T),label:"Allow run",class:"mb-2"},null,8,["modelValue"]),a(e(O),{type:"checkbox",modelValue:o.isStatic,"onUpdate:modelValue":n[3]||(n[3]=T=>o.isStatic=T),label:"Is static",class:"mb-2"},null,8,["modelValue"])])):V.value.index===1?(i(),h("div",Et,[a(e(O),{type:"textarea",modelValue:N.value,"onUpdate:modelValue":n[4]||(n[4]=T=>N.value=T),label:"Code Input",placeholder:"Enter your code here...",disabled:!o.isStatic,class:"mb-2"},null,8,["modelValue","disabled"]),a(e(Q),{onClick:U,loading:p.value,class:"mb-2",disabled:!o.isStatic},{default:b(()=>n[10]||(n[10]=[E(" Run Code ")])),_:1,__:[10]},8,["loading","disabled"]),k.value!==""?(i(),h("div",Ut,[n[11]||(n[11]=t("h4",null,"Output:",-1)),t("pre",null,w(k.value),1)])):R("",!0)])):R("",!0)]),_:1},8,["modelValue"])]),actions:b(()=>[a(e(Q),{variant:"solid",onClick:z},{default:b(()=>n[12]||(n[12]=[E("Save")])),_:1,__:[12]}),a(e(Q),{class:"ml-2",onClick:n[6]||(n[6]=$=>r.value=!1)},{default:b(()=>n[13]||(n[13]=[E("Cancel")])),_:1,__:[13]})]),_:1},8,["modelValue"])):R("",!0)]),_:1}))}},Ot=Ee.extend({name:"codeBlockLowlight",addAttributes(){return{language:{default:null,parseHTML:u=>u.getAttribute("data-language")||null,renderHTML:u=>u.language?{"data-language":u.language}:{}},allowRun:{default:!1,parseHTML:u=>u.getAttribute("data-allow-run")==="true",renderHTML:u=>u.allowRun?{"data-allow-run":"true"}:{}},isStatic:{default:!1,parseHTML:u=>u.getAttribute("data-is-static")==="true",renderHTML:u=>u.isStatic?{"data-is-static":"true"}:{}}}},addNodeView(){return Ue(Pt)}}),At={class:""},Ht={class:"grid md:grid-cols-[75%,25%] h-screen"},Bt={class:"border-r"},jt={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b overflow-hidden bg-surface-white px-3 py-2.5 sm:px-5"},Ft={class:"py-5"},Dt={class:"w-5/6 mx-auto"},Jt={class:"border-t mt-4"},Yt={class:"w-5/6 mx-auto pt-4"},Wt={class:"block font-medium text-ink-gray-5 mb-1"},Xt={class:"border-t mt-4"},Zt={class:"w-5/6 mx-auto pt-4"},Kt={class:"block font-medium text-ink-gray-5 mb-1"},Gt={class:""},es={class:"sticky top-0 p-5"},as={__name:"LessonForm",props:{courseName:{type:String,required:!0},chapterNumber:{type:String,required:!0},lessonNumber:{type:String,required:!0}},setup(u){const l=Pe(Ye),r=g(""),o=g(""),m={codeBlockLowlight:Ot.configure({lowlight:l})},{brand:q}=Oe();g(null),g(null);const z=Ae("$user"),V=g(!1),{updateOnboardingStep:N}=He("learning");let k=!1;const p=u;ie(()=>{!z.data?.is_moderator&&!z.data?.is_instructor&&(window.location.href="/login"),ee("lesson_form_opened"),Be()});const d=Z({title:"",include_in_preview:!1,body:"",instructor_notes:"",content:"",instructor_content:""}),c=J({url:"lms.lms.utils.get_lesson_creation_details",params:{course:p.courseName,chapter:p.chapterNumber,lesson:p.lessonNumber},auto:!0,onSuccess(s){s.lesson&&(Object.keys(s.lesson).forEach(_=>{d[_]=s.lesson[_]}),d.include_in_preview=!!s?.lesson?.include_in_preview,f(s))}}),f=s=>{if(s.lesson.content)try{const _=JSON.parse(s.lesson.content);_.html?r.value=_.html:r.value=s.lesson.content}catch{r.value=s.lesson.content}if(s.lesson.instructor_content)try{const _=JSON.parse(s.lesson.instructor_content);_.html?o.value=_.html:o.value=s.lesson.instructor_content}catch{o.value=s.lesson.instructor_content}},x=s=>{s.key==="s"&&(s.ctrlKey||s.metaKey)&&!s.target.classList.contains("ProseMirror")&&(v({showSuccessMessage:!0}),s.preventDefault())};je(()=>{window.removeEventListener("keydown",x)});const I=J({url:"frappe.client.insert",makeParams(s){return{doc:{doctype:"Course Lesson",course:p.courseName,chapter:c.data?.chapter.name,...d}}}}),P=J({url:"frappe.client.set_value",makeParams(s){return{doctype:"Course Lesson",name:s.lesson,fieldname:d}}}),F=J({url:"frappe.client.insert",makeParams(s){return{doc:{doctype:"Lesson Reference",parent:c.data?.chapter.name,parenttype:"Course Chapter",parentfield:"lessons",lesson:s.lesson,idx:p.lessonNumber}}}}),U=s=>({type:"doc",content:[{type:"paragraph",content:[{type:"text",text:s.replace(/<[^>]*>/g,"")}]}]}),v=s=>{k=!1,typeof s<"u"&&s.showSuccessMessage&&(k=!0),d.content=JSON.stringify({json:U(r.value),html:r.value}),o.value&&o.value.trim()?d.instructor_content=JSON.stringify({json:U(o.value),html:o.value}):d.instructor_content="",c.data?.lesson?$():n()},n=()=>{I.submit({},{validate(){return T()},onSuccess(s){F.submit({lesson:s.name},{onSuccess(){z.data?.is_system_manager&&N("create_first_lesson"),ee("lesson_created"),A.success(__("Lesson created successfully")),c.reload()}})},onError(s){A.error(s.messages?.[0]||s)}})},$=()=>{P.submit({lesson:c.data.lesson.name},{validate(){return T()},onSuccess(){k&&A.success(__("Lesson updated successfully"))},onError(s){A.error(s.message)}})},T=()=>{if(!d.title)return"Title is required";if(!d.content)return"Content is required"},S=j(()=>{let s=[{label:"Courses",route:{name:"Courses"}},{label:c.data?.course_title,route:{name:"CourseForm",params:{courseName:p.courseName}}}];return c?.data?.lesson&&s.push({label:c.data.lesson.title,route:{name:"Lesson",params:{courseName:p.courseName,chapterNumber:p.chapterNumber,lessonNumber:p.lessonNumber}}}),s.push({label:c?.data?.lesson?"Edit Lesson":"Create Lesson",route:{name:"LessonForm",params:{courseName:p.courseName,chapterNumber:p.chapterNumber,lessonNumber:p.lessonNumber}}}),s});return Fe(()=>({title:c?.data?.lesson?c.data.lesson.title:"New Lesson",icon:q.favicon})),(s,_)=>(i(),h("div",At,[t("div",Ht,[t("div",Bt,[t("header",jt,[a(e(We),{class:"text-ellipsis",items:S.value},null,8,["items"]),a(e(Q),{variant:"solid",onClick:_[0]||(_[0]=y=>v({showSuccessMessage:!0})),class:"mt-3 md:mt-0"},{default:b(()=>[E(w(s.__("Save")),1)]),_:1})]),t("div",Ft,[t("div",Dt,[a(e(O),{modelValue:d.title,"onUpdate:modelValue":_[1]||(_[1]=y=>d.title=y),label:"Title",class:"mb-4",required:!0},null,8,["modelValue"]),a(e(O),{modelValue:d.include_in_preview,"onUpdate:modelValue":_[2]||(_[2]=y=>d.include_in_preview=y),type:"checkbox",label:"Include in Preview"},null,8,["modelValue"])]),t("div",Jt,[t("div",Yt,[t("div",{class:"flex justify-between cursor-pointer",onClick:_[3]||(_[3]=()=>{V.value=!V.value})},[t("label",Wt,w(s.__("Instructor Notes")),1),a(e(De),{class:K(["stroke-2 h-5 w-5 text-ink-gray-5",{"rotate-90 transform duration-200":V.value,"duration-200":!V.value}])},null,8,["class"])]),ue(t("div",null,[a(e(te),{"editor-class":"prose-sm min-h-[4rem] border rounded-b-lg border-t-0 p-2",content:o.value,placeholder:"Type instructor notes...",onChange:_[4]||(_[4]=y=>o.value=y),bubbleMenu:!0,"fixed-menu":!0,extensions:m},null,8,["content"])],512),[[Je,V.value]])])]),t("div",Xt,[t("div",Zt,[t("label",Kt,w(s.__("Content")),1),a(e(te),{"editor-class":"prose-sm min-h-[4rem] border rounded-b-lg border-t-0 p-2",content:r.value,placeholder:"Type something...",onChange:_[5]||(_[5]=y=>r.value=y),bubbleMenu:!0,"fixed-menu":!0,extensions:m,ref:"editorRef"},null,8,["content"])])])])]),t("div",Gt,[t("div",es,[a(qt)])])])]))}};export{as as default};
//# sourceMappingURL=LessonForm-Bc79aXpA.js.map
