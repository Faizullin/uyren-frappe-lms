import{J as Y,K as q,i as X,ap as Z,L as G,A as v,w as J,j as c,f as o,n as m,g as u,h as g,e as x,k as d,l as t,q as ee,aH as te,bk as ae,_ as B,p as M,t as b,bl as K,bm as se,bn as le,M as re,H as h,I as oe,R as ne,z as ie,r as A,aB as ce,d as ue,C as N,F as I,x as de,a1 as me,O as j,bW as pe,bx as T,an as H,bX as _e,bY as ge,by as ke,N as he}from"./index-BIerRe8o.js";import{DisclosureButton as fe,DisclosurePanel as be,Disclosure as ye}from"@headlessui/vue";import"@vueuse/core";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";import{D as Ce}from"./vuedraggable.umd-D2H5jHu-.js";const ve={class:"space-y-4 text-base"},xe={key:0},we={class:"mb-4"},De={key:1,class:""},Ne={class:"flex items-center"},Ee={class:"border rounded-md p-2 mr-2"},$e={class:"flex flex-col"},Ve={class:"text-sm text-ink-gray-4 mt-1"},Se={__name:"ChapterModal",props:Y({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(s){const C=q(s,"modelValue"),E=q(s,"outline"),$=X("$user"),{updateOnboardingStep:w}=Z("learning"),y=s,a=G({title:"",is_scorm_package:0,scorm_package:null}),D=v({url:"lms.lms.api.upsert_chapter",makeParams(l){return{title:a.title,course:y.course,is_scorm_package:a.is_scorm_package,scorm_package:a.scorm_package,name:y.chapterDetail?.name}}}),f=v({url:"frappe.client.insert",makeParams(l){return{doc:{doctype:"Chapter Reference",chapter:l.name,parent:y.course,parenttype:"LMS Course",parentfield:"chapters"}}}}),_=async l=>{D.submit({},{validate(){return P()},onSuccess:r=>{$.data?.is_system_manager&&w("create_first_chapter"),oe("chapter_created"),f.submit({name:r.name},{onSuccess(i){L(),E.value.reload(),h.success(__("Chapter added successfully"))},onError(i){h.error(i.messages?.[0]||i)}}),l()},onError(r){h.error(r.messages?.[0]||r)}})},P=()=>{if(!a.title)return __("Title is required");if(a.is_scorm_package&&!a.scorm_package)return __("Please upload a SCORM package")},L=()=>{a.title="",a.is_scorm_package=0,a.scorm_package=null},O=l=>{D.submit({},{validate(){if(!a.title)return"Title is required"},onSuccess(){E.value.reload(),h.success(__("Chapter updated successfully")),l()},onError(r){h.error(r.messages?.[0]||r)}})};J(()=>y.chapterDetail,l=>{a.title=l?.title,a.is_scorm_package=l?.is_scorm_package,a.scorm_package=l?.scorm_package});const R=l=>{if(l.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(l,r)=>(o(),c(t(re),{modelValue:C.value,"onUpdate:modelValue":r[4]||(r[4]=i=>C.value=i),options:{title:s.chapterDetail?l.__("Edit Chapter"):l.__("Add Chapter"),size:"lg",actions:[{label:s.chapterDetail?l.__("Edit"):l.__("Create"),variant:"solid",onClick:i=>s.chapterDetail?O(i):_(i)}]}},{"body-content":m(()=>[u("div",ve,[g(t(ee),{label:"Title",modelValue:a.title,"onUpdate:modelValue":r[0]||(r[0]=i=>a.title=i),required:!0},null,8,["modelValue"]),g(t(te),{size:"sm",label:l.__("SCORM Package"),description:l.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:a.is_scorm_package,"onUpdate:modelValue":r[1]||(r[1]=i=>a.is_scorm_package=i)},null,8,["label","description","modelValue"]),a.is_scorm_package?(o(),x("div",xe,[a.scorm_package?(o(),x("div",De,[u("div",Ne,[u("div",Ee,[g(t(K),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),u("div",$e,[u("span",null,b(a.scorm_package.file_name),1),u("span",Ve,b(t(se)(a.scorm_package.file_size)),1)]),g(t(le),{onClick:r[3]||(r[3]=()=>a.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(o(),c(t(ae),{key:0,fileTypes:[".zip"],validateFile:R,onSuccess:r[2]||(r[2]=i=>a.scorm_package=i)},{default:m(({file:i,progress:z,uploading:V,openFileSelector:F})=>[u("div",we,[g(t(B),{onClick:F,loading:V},{default:m(()=>[M(b(V?`Uploading ${z}%`:"Upload an ZIP file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):d("",!0)])]),_:1},8,["modelValue","options"]))}},Me={class:""},Pe=["onClick"],Le={class:"flex ml-auto space-x-4"},Oe={class:"flex items-center text-sm leading-5 group"},Re={key:1,class:"flex mt-2 mb-4 pl-8"},Ze={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1}},setup(s){const C=ne(),E=ie(),$=X("$user"),w=A(!1),y=A(null),a=ce(),{$dialog:D}=a.appContext.config.globalProperties,f=s,_=v({url:"lms.lms.utils.get_course_outline",cache:["course_outline",f.courseName],makeParams(){return{course:f.courseName,progress:f.getProgress}},auto:!0});J(()=>f.courseName,()=>{_.reload()});const P=v({url:"lms.lms.api.delete_lesson",makeParams(e){return{lesson:e.lesson,chapter:e.chapter}},onSuccess(){_.reload(),h.success(__("Lesson deleted successfully"))}}),L=v({url:"lms.lms.api.update_lesson_index",makeParams(e){return{lesson:e.lesson,sourceChapter:e.sourceChapter,targetChapter:e.targetChapter,idx:e.idx}},onSuccess(){h.success(__("Lesson moved successfully"))}}),O=(e,k)=>{D({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(S){P.submit({lesson:e,chapter:k}),S()}}]})},R=e=>e==C.params.chapterNumber||e==1,l=(e=null)=>{y.value=e,w.value=!0},r=()=>y.value,i=e=>{L.submit({lesson:e.item.__draggable_context.element.name,sourceChapter:e.from.dataset.chapter,targetChapter:e.to.dataset.chapter,idx:e.newIndex})},z=v({url:"lms.lms.api.delete_chapter",makeParams(e){return{chapter:e.chapter}},onSuccess(){_.reload(),h.success(__("Chapter deleted successfully"))}}),V=e=>{D({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(k){z.submit({chapter:e}),k()}}]})},F=e=>{if(e.is_scorm_package&&(event.preventDefault(),!f.allowEdit)){if(!$.data){h.success(__("Please enroll for this course to view this lesson"));return}E.push({name:"SCORMChapter",params:{courseName:f.courseName,chapterName:e.name}})}},Q=e=>C.params.chapterNumber==e.split(".")[0]&&C.params.lessonNumber==e.split(".")[1];return(e,k)=>{const S=ue("router-link");return o(),x(I,null,[u("div",Me,[s.title&&(t(_).data?.length||s.allowEdit)?(o(),x("div",{key:0,class:N(["flex items-center justify-between space-x-2 mb-4 px-2",{"sticky top-0 z-10 bg-surface-white border-b px-3 py-2.5 sm:px-5":s.allowEdit}])},[u("div",{class:N(["font-semibold text-lg leading-5 text-ink-gray-9",{"font-medium text-p-base":s.allowEdit}])},b(e.__(s.title)),3),s.allowEdit?(o(),c(t(B),{key:0,size:"sm",onClick:k[0]||(k[0]=n=>l())},{default:m(()=>[M(b(e.__("Add Chapter")),1)]),_:1})):d("",!0)],2)):d("",!0),u("div",{class:N({"border-2 rounded-md py-2 px-2":s.showOutline&&t(_).data?.length})},[(o(!0),x(I,null,de(t(_).data,(n,W)=>(o(),c(t(ye),{key:n.name,defaultOpen:R(n.idx)},{default:m(({open:U})=>[g(t(fe),{ref_for:!0,ref:"",class:"flex items-center w-full p-2 group"},{default:m(()=>[g(t(me),{class:N([{"rotate-90 transform duration-200":U,"duration-200":!U,hidden:n.is_scorm_package,open:W==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),u("div",{class:"text-base text-left text-ink-gray-9 font-medium leading-5 ml-2",onClick:p=>F(n)},b(n.title),9,Pe),u("div",Le,[g(t(j),{text:e.__("Edit Chapter"),placement:"bottom"},{default:m(()=>[s.allowEdit?(o(),c(t(pe),{key:0,onClick:T(p=>l(n),["prevent"]),class:"h-4 w-4 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])):d("",!0)]),_:2},1032,["text"]),g(t(j),{text:e.__("Delete Chapter"),placement:"bottom"},{default:m(()=>[s.allowEdit?(o(),c(t(H),{key:0,onClick:T(p=>V(n.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 invisible group-hover:visible"},null,8,["onClick"])):d("",!0)]),_:2},1032,["text"])])]),_:2},1536),n.is_scorm_package?d("",!0):(o(),c(t(be),{key:0},{default:m(()=>[n.is_scorm_package?d("",!0):(o(),c(t(Ce),{key:0,list:n.lessons,disabled:!s.allowEdit,"item-key":"name",group:"items",onEnd:i,"data-chapter":n.name},{item:m(({element:p})=>[u("div",{class:N(["outline-lesson pl-8 py-2 pr-4 text-ink-gray-9",Q(p.number)?"bg-surface-gray-3":""])},[g(S,{to:{name:s.allowEdit?"LessonForm":"Lesson",params:{courseName:s.courseName,chapterNumber:p.number.split(".")[0],lessonNumber:p.number.split(".")[1]}}},{default:m(()=>[u("div",Oe,[p.icon==="icon-youtube"?(o(),c(t(_e),{key:0,class:"h-4 w-4 stroke-1 mr-2"})):p.icon==="icon-quiz"?(o(),c(t(ge),{key:1,class:"h-4 w-4 stroke-1 mr-2"})):p.icon==="icon-list"?(o(),c(t(K),{key:2,class:"h-4 w-4 text-ink-gray-9 stroke-1 mr-2"})):d("",!0),M(" "+b(p.title)+" ",1),s.allowEdit?(o(),c(t(H),{key:3,onClick:T(ze=>O(p.name,n.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 ml-auto invisible group-hover:visible"},null,8,["onClick"])):d("",!0),p.is_complete?(o(),c(t(ke),{key:4,class:"h-4 w-4 text-green-700 ml-2"})):d("",!0)])]),_:2},1032,["to"])],2)]),_:2},1032,["list","disabled","data-chapter"])),s.allowEdit?(o(),x("div",Re,[n.is_scorm_package?d("",!0):(o(),c(S,{key:0,to:{name:"LessonForm",params:{courseName:s.courseName,chapterNumber:n.idx,lessonNumber:n.lessons.length+1}}},{default:m(()=>[g(t(B),null,{default:m(()=>[M(b(e.__("Add Lesson")),1)]),_:1})]),_:2},1032,["to"]))])):d("",!0)]),_:2},1024))]),_:2},1032,["defaultOpen"]))),128))],2)]),t($).data?(o(),c(Se,{key:0,modelValue:w.value,"onUpdate:modelValue":k[1]||(k[1]=n=>w.value=n),outline:t(_),"onUpdate:outline":k[2]||(k[2]=n=>he(_)?_.value=n:null),course:s.courseName,chapterDetail:r()},null,8,["modelValue","outline","course","chapterDetail"])):d("",!0)],64)}}};export{Ze as _};
//# sourceMappingURL=CourseOutline-D_ftegVj.js.map
