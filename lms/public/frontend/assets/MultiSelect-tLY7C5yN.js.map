{"version":3,"file":"MultiSelect-tLY7C5yN.js","sources":["../../../../frontend-monorepo/website/src/components/Controls/MultiSelect.vue"],"sourcesContent":["<template>\n  <div>\n    <label class=\"block mb-1\" :class=\"labelClasses\" v-if=\"label\">\n      {{ label }}\n      <span class=\"text-ink-red-3\" v-if=\"required\">*</span>\n    </label>\n    <div class=\"w-full\">\n      <Combobox v-model=\"selectedValue\" nullable>\n        <Popover class=\"w-full\" v-model:show=\"showOptions\">\n          <template #target=\"{ togglePopover }\">\n            <ComboboxInput ref=\"search\"\n              class=\"search-input form-input w-full border-[#f1511b] hover:border-[#f1511b] focus:ring-[#f1511b] focus:border-[#f1511b] focus-visible:ring-[#f1511b] transition-colors\"\n              type=\"text\" :value=\"query\" @change=\"\n                (e) => {\n                  query = e.target.value\n                  showOptions = true\n                }\n              \" autocomplete=\"off\" @focus=\"() => togglePopover()\" @keydown.delete.capture.stop=\"removeLastValue\" />\n          </template>\n          <template #body=\"{ isOpen, close }\">\n            <div v-show=\"isOpen\">\n              <div class=\"mt-1 rounded-lg bg-surface-white py-1 text-base border-2\">\n                <ComboboxOptions class=\"my-1 min-h-[6rem] max-h-[12rem] overflow-y-auto px-1.5\" static>\n                  <ComboboxOption v-for=\"option in options\" :key=\"option.value\" :value=\"option\" v-slot=\"{ active }\">\n                    <li :class=\"[\n                      'flex cursor-pointer items-center rounded px-2 py-1 text-base transition-colors',\n                      active\n                        ? 'bg-[#f1511b] text-white [&_*]:text-white'\n                        : '',\n                    ]\">\n                      <div class=\"flex flex-col gap-1 p-1\">\n                        <div class=\"text-base font-medium text-ink-gray-8\">\n                          {{ option.description }}\n                        </div>\n                        <div class=\"text-sm text-ink-gray-5\">\n                          {{ option.value }}\n                        </div>\n                      </div>\n                    </li>\n                  </ComboboxOption>\n                  <div class=\"h-10\"></div>\n                  <div v-if=\"attrs.onCreate\" class=\"absolute bottom-2 left-1 w-[99%] pt-2 bg-white border-t\">\n                    <Button variant=\"ghost\" class=\"w-full !justify-start\" :label=\"__('Create New')\"\n                      @click=\"attrs.onCreate(close)\">\n                      <template #prefix>\n                        <Plus class=\"h-4 w-4 stroke-1.5 text-[#f1511b]\" />\n                      </template>\n                    </Button>\n                  </div>\n                </ComboboxOptions>\n              </div>\n            </div>\n          </template>\n        </Popover>\n      </Combobox>\n    </div>\n    <div v-if=\"values.length\" class=\"grid grid-cols-2 gap-2 mt-1\">\n      <div v-for=\"value in values\"\n        class=\"flex items-center justify-between break-all bg-[#f1511b] text-white word-wrap p-2 rounded-md mr-2\">\n        <span class=\"break-all\">\n          {{ value }}\n        </span>\n        <X class=\"size-4 stroke-1.5 cursor-pointer text-white\" @click=\"removeValue(value)\" />\n      </div>\n    </div>\n    <!-- <ErrorMessage class=\"mt-2 pl-2\" v-if=\"error\" :message=\"error\" /> -->\n  </div>\n</template>\n\n<script setup>\nimport {\n  Combobox,\n  ComboboxInput,\n  ComboboxOptions,\n  ComboboxOption,\n} from '@headlessui/vue'\nimport { createResource, Popover, Button } from '@mono/mono-frappe-ui'\nimport { ref, computed, nextTick, useAttrs } from 'vue'\nimport { watchDebounced } from '@vueuse/core'\nimport { X, Plus } from 'lucide-vue-next'\n\nconst props = defineProps({\n  label: {\n    type: String,\n  },\n  size: {\n    type: String,\n    default: 'sm',\n  },\n  doctype: {\n    type: String,\n    required: true,\n  },\n  filters: {\n    type: Object,\n    default: () => ({}),\n  },\n  validate: {\n    type: Function,\n    default: null,\n  },\n  errorMessage: {\n    type: Function,\n    default: (value) => `${value} is an Invalid value`,\n  },\n  required: {\n    type: Boolean,\n  },\n})\n\nconst values = defineModel()\nconst attrs = useAttrs()\nconst emails = ref([])\nconst search = ref(null)\nconst error = ref(null)\nconst query = ref('')\nconst text = ref('')\nconst showOptions = ref(false)\n\nconst selectedValue = computed({\n  get: () => query.value || '',\n  set: (val) => {\n    query.value = ''\n    if (val) {\n      showOptions.value = false\n    }\n    val?.value && addValue(val.value)\n  },\n})\n\nwatchDebounced(\n  query,\n  (val) => {\n    val = val || ''\n    if (text.value === val) return\n    text.value = val\n    reload(val)\n  },\n  { debounce: 300, immediate: true },\n)\n\nconst filterOptions = createResource({\n  url: 'frappe.desk.search.search_link',\n  method: 'POST',\n  cache: [text.value, props.doctype],\n  auto: true,\n  params: {\n    txt: text.value,\n    doctype: props.doctype,\n  },\n})\n\nconst options = computed(() => {\n  return filterOptions.data || []\n})\n\nfunction reload(val) {\n  filterOptions.update({\n    params: {\n      txt: val,\n      doctype: props.doctype,\n    },\n  })\n  filterOptions.reload()\n}\n\nconst addValue = (value) => {\n  error.value = null\n  if (value) {\n    const splitValues = value.split(',')\n    splitValues.forEach((value) => {\n      value = value.trim()\n      if (value) {\n        // check if value is not already in the values array\n        if (!values.value?.includes(value)) {\n          // check if value is valid\n          if (value && props.validate && !props.validate(value)) {\n            error.value = props.errorMessage(value)\n            return\n          }\n          // add value to values array\n          if (!values.value) {\n            values.value = [value]\n          } else {\n            values.value.push(value)\n          }\n          value = value.replace(value, '')\n        }\n      }\n    })\n    !error.value && (value = '')\n  }\n}\n\nconst removeValue = (value) => {\n  values.value = values.value.filter((v) => v !== value)\n}\n\nconst removeLastValue = () => {\n  if (query.value) return\n\n  let emailRef = emails.value[emails.value.length - 1]?.$el\n  if (document.activeElement === emailRef) {\n    values.value.pop()\n    nextTick(() => {\n      if (values.value.length) {\n        emailRef = emails.value[emails.value.length - 1].$el\n        emailRef?.focus()\n      } else {\n        setFocus()\n      }\n    })\n  } else {\n    emailRef?.focus()\n  }\n}\n\nfunction setFocus() {\n  search.value.$el.focus()\n}\n\ndefineExpose({ setFocus })\n\nconst labelClasses = computed(() => {\n  return [\n    {\n      sm: 'text-xs',\n      md: 'text-base',\n    }[props.size || 'sm'],\n    'text-ink-gray-5',\n  ]\n})\n</script>\n"],"names":["props","__props","values","_useModel","attrs","useAttrs","emails","ref","search","error","query","text","showOptions","selectedValue","computed","val","addValue","watchDebounced","reload","filterOptions","createResource","options","value","removeValue","v","removeLastValue","emailRef","nextTick","setFocus","__expose","labelClasses","_createElementBlock","_normalizeClass","_createTextVNode","_toDisplayString","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_unref","Combobox","$event","Popover","_withCtx","togglePopover","ComboboxInput","_cache","e","isOpen","close","_hoisted_3","ComboboxOptions","_Fragment","_renderList","option","_createBlock","ComboboxOption","active","_hoisted_4","_hoisted_5","_hoisted_6","_openBlock","_hoisted_7","Button","__","Plus","_hoisted_8","_hoisted_9","_hoisted_10","X"],"mappings":"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"}