import{s as K,r as k,z as Q,a5 as W,b as C,u as X,e as g,f as m,g as n,k as P,h as o,l as e,n as t,p as V,t as p,_ as f,q as Y,P as S,ag as E,F as h,x,j as b,ah as D,aj as F,ak as T,am as j,an as U,ao as A,af as B,aq as Z,M as ee,a as se,H as d}from"./index-DcFDtKzU.js";import{_ as ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DSPCRa1r.js";import{D as re}from"./vuedraggable.umd-BEfN-p6K.js";const oe={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},le={key:0,class:"pt-5 px-5 w-3/4 mx-auto space-y-10"},te={class:"flex items-center justify-between mb-2"},ue={class:"text-lg text-ink-gray-9 font-semibold"},me={class:"flex gap-2"},ne={class:"flex items-center justify-between mb-2"},de={class:"text-lg text-ink-gray-9 font-semibold"},ie={class:"flex gap-2"},pe={__name:"ProgramForm",props:{programName:{type:String,required:!0}},setup(I){const{brand:L}=K(),c=k(!1),_=k(null),v=k(null),w=k(null),q=Q(),y=I,r=W({doctype:"LMS Program",name:y.programName,auto:!0,cache:["program",y.programName]}),z=()=>{r.setValue.submit({program_courses:[...r.doc.program_courses,{course:v.value}]},{onSuccess(s){c.value=!1,v.value=null,d.success(__("Course added to program")),r.reload()},onError(s){d.error(s.messages?.[0]||s)}})},O=()=>{r.setValue.submit({program_members:[...r.doc.program_members,{member:w.value}]},{onSuccess(s){c.value=!1,w.value=null,d.success(__("Member added to program")),r.reload()},onError(s){d.error(s.messages?.[0]||s)}})},N=(s,l,a)=>{s=Array.from(s),r.setValue.submit({[a]:r.doc[a].filter(u=>!s.includes(u.name))},{onSuccess(u){l(),d.success(__("Items removed successfully")),r.reload()},onError(u){d.error(u.messages?.[0]||u)}})},R=s=>{let l=s.from.dataset.idx,a=s.to.dataset.idx,u=r.doc.program_courses;u.splice(a,0,u.splice(l,1)[0]),u.forEach((i,J)=>{i.idx=J+1}),r.setValue.submit({program_courses:u},{onSuccess(i){d.success(__("Course moved successfully")),r.reload()},onError(i){d.error(i.messages?.[0]||i)}})},H=()=>{se("frappe.model.rename_doc.update_document_title",{doctype:"LMS Program",docname:r.doc.name,name:r.doc.title}).then(s=>{q.push({name:"ProgramForm",params:{programName:s}})})},$=C(()=>[{label:"Title",key:"course_title",width:3},{label:"ID",key:"course",width:3}]),M=C(()=>[{label:"Member",key:"member",width:3,align:"left"},{label:"Full Name",key:"full_name",width:3,align:"left"},{label:"Progress (%)",key:"progress",width:3,align:"right"}]),G=C(()=>[{label:"Programs",route:{name:"Programs"}},{label:y.programName==="new"?"New Program":y.programName}]);return X(()=>({title:r.doc?.title,icon:L.favicon})),(s,l)=>(m(),g(h,null,[n("header",oe,[o(e(ae),{items:G.value},null,8,["items"]),o(e(f),{variant:"solid",onClick:l[0]||(l[0]=a=>H())},{default:t(()=>[V(p(s.__("Save")),1)]),_:1})]),e(r).doc?(m(),g("div",le,[o(e(Y),{modelValue:e(r).doc.title,"onUpdate:modelValue":l[1]||(l[1]=a=>e(r).doc.title=a),label:s.__("Title")},null,8,["modelValue","label"]),n("div",null,[n("div",te,[n("div",ue,p(s.__("Program Courses")),1),o(e(f),{onClick:l[2]||(l[2]=()=>{_.value="course",c.value=!0})},{prefix:t(()=>[o(e(S),{class:"w-4 h-4"})]),default:t(()=>[V(" "+p(s.__("Add")),1)]),_:1})]),o(e(A),{columns:$.value,rows:e(r).doc.program_courses,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[o(e(E),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(m(!0),g(h,null,x($.value,a=>(m(),b(e(D),{item:a},null,8,["item"]))),256))]),_:1}),o(e(F),null,{default:t(()=>[o(e(re),{list:e(r).doc.program_courses,"item-key":"name",group:"items",onEnd:R,class:"cursor-move"},{item:t(({element:a})=>[o(e(T),{row:a},null,8,["row"])]),_:1},8,["list"])]),_:1}),o(e(j),null,{actions:t(({unselectAll:a,selections:u})=>[n("div",me,[o(e(f),{variant:"ghost",onClick:i=>N(u,a,"program_courses")},{default:t(()=>[o(e(U),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])]),n("div",null,[n("div",ne,[n("div",de,p(s.__("Program Members")),1),o(e(f),{onClick:l[3]||(l[3]=()=>{_.value="member",c.value=!0})},{prefix:t(()=>[o(e(S),{class:"w-4 h-4"})]),default:t(()=>[V(" "+p(s.__("Add")),1)]),_:1})]),o(e(A),{columns:M.value,rows:e(r).doc.program_members,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[o(e(E),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(m(!0),g(h,null,x(M.value,a=>(m(),b(e(D),{item:a},null,8,["item"]))),256))]),_:1}),o(e(F),null,{default:t(()=>[(m(!0),g(h,null,x(e(r).doc.program_members,a=>(m(),b(e(T),{row:a},null,8,["row"]))),256))]),_:1}),o(e(j),null,{actions:t(({unselectAll:a,selections:u})=>[n("div",ie,[o(e(f),{variant:"ghost",onClick:i=>N(u,a,"program_members")},{default:t(()=>[o(e(U),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):P("",!0),o(e(ee),{modelValue:c.value,"onUpdate:modelValue":l[6]||(l[6]=a=>c.value=a),options:{title:_.value=="course"?s.__("New Program Course"):s.__("New Program Member"),actions:[{label:s.__("Add"),variant:"solid",onClick:()=>_.value=="course"?z(s.close):O(s.close)}]}},{"body-content":t(()=>[_.value=="course"?(m(),b(B,{key:0,modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=a=>v.value=a),doctype:"LMS Course",filters:{disable_self_learning:1},label:s.__("Program Course"),description:s.__("Only courses for which self learning is disabled can be added to program.")},null,8,["modelValue","label","description"])):P("",!0),_.value=="member"?(m(),b(B,{key:1,modelValue:w.value,"onUpdate:modelValue":l[5]||(l[5]=a=>w.value=a),doctype:"User",filters:{ignore_user_type:1},label:s.__("Program Member"),onCreate:(a,u)=>e(Z)("Members",u)},null,8,["modelValue","label","onCreate"])):P("",!0)]),_:1},8,["modelValue","options"])],64))}};export{pe as default};
//# sourceMappingURL=ProgramForm-Hf3Mo81Z.js.map
