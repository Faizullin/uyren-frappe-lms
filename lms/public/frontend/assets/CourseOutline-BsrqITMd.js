import{aJ as H,z,n as se,bk as le,g as $,bJ as pe,c9 as me,ca as M,cb as J,cc as L,bV as oe,cd as fe,ce as F,cf as Z,cg as W,ch as ge,ci as Y,i as U,V as _e,W as G,aE as ke,X as he,L as N,D as re,E as k,o as i,w as y,d as h,b as x,c as V,h as b,p as l,I as ve,aV as be,bB as ye,H as K,e as R,t as P,bC as ne,bD as Ce,a4 as xe,Y as we,R as D,T as De,a8 as Se,u as Ee,aP as $e,r as Pe,q as I,F as ee,f as Oe,ai as Ne,$ as te,cj as Ve,j as A,aC as ae,ck as Me,cl as Le,bN as Ie,Z as Te}from"./index-RevCnO16.js";import{D as Be}from"./vuedraggable.umd-Cwiqepd0.js";var Re=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Re||{});let ie=Symbol("DisclosureContext");function Q(e){let f=U(ie,null);if(f===null){let v=new Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(v,Q),v}return f}let ue=Symbol("DisclosurePanelContext");function ze(){return U(ue,null)}let Fe=H({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(e,{slots:f,attrs:v}){let g=$(e.defaultOpen?0:1),a=$(null),_=$(null),t={buttonId:$(`headlessui-disclosure-button-${W()}`),panelId:$(`headlessui-disclosure-panel-${W()}`),disclosureState:g,panel:a,button:_,toggleDisclosure(){g.value=Y(g.value,{0:1,1:0})},closeDisclosure(){g.value!==1&&(g.value=1)},close(n){t.closeDisclosure();let p=n?n instanceof HTMLElement?n:n.value instanceof HTMLElement?M(n):M(t.button):M(t.button);p?.focus()}};return oe(ie,t),ge(z(()=>Y(g.value,{0:F.Open,1:F.Closed}))),()=>{let{defaultOpen:n,...p}=e,m={open:g.value===0,close:t.close};return J({theirProps:p,ourProps:{},slot:m,slots:f,attrs:v,name:"Disclosure"})}}}),Ue=H({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(e,{attrs:f,slots:v,expose:g}){let a=Q("DisclosureButton"),_=ze(),t=z(()=>_===null?!1:_.value===a.panelId.value);se(()=>{t.value||e.id!==null&&(a.buttonId.value=e.id)}),le(()=>{t.value||(a.buttonId.value=null)});let n=$(null);g({el:n,$el:n}),t.value||pe(()=>{a.button.value=n.value});let p=me(z(()=>({as:e.as,type:f.type})),n);function m(){var c;e.disabled||(t.value?(a.toggleDisclosure(),(c=M(a.button))==null||c.focus()):a.toggleDisclosure())}function S(c){var E;if(!e.disabled)if(t.value)switch(c.key){case L.Space:case L.Enter:c.preventDefault(),c.stopPropagation(),a.toggleDisclosure(),(E=M(a.button))==null||E.focus();break}else switch(c.key){case L.Space:case L.Enter:c.preventDefault(),c.stopPropagation(),a.toggleDisclosure();break}}function O(c){switch(c.key){case L.Space:c.preventDefault();break}}return()=>{var c;let E={open:a.disclosureState.value===0},{id:o,...r}=e,d=t.value?{ref:n,type:p.value,onClick:m,onKeydown:S}:{id:(c=a.buttonId.value)!=null?c:o,ref:n,type:p.value,"aria-expanded":a.disclosureState.value===0,"aria-controls":a.disclosureState.value===0||M(a.panel)?a.panelId.value:void 0,disabled:e.disabled?!0:void 0,onClick:m,onKeydown:S,onKeyup:O};return J({ourProps:d,theirProps:r,slot:E,attrs:f,slots:v,name:"DisclosureButton"})}}}),je=H({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:f,slots:v,expose:g}){let a=Q("DisclosurePanel");se(()=>{e.id!==null&&(a.panelId.value=e.id)}),le(()=>{a.panelId.value=null}),g({el:a.panel,$el:a.panel}),oe(ue,a.panelId);let _=fe(),t=z(()=>_!==null?(_.value&F.Open)===F.Open:a.disclosureState.value===0);return()=>{var n;let p={open:a.disclosureState.value===0,close:a.close},{id:m,...S}=e,O={id:(n=a.panelId.value)!=null?n:m,ref:a.panel};return J({ourProps:O,theirProps:S,slot:p,attrs:f,slots:v,features:Z.RenderStrategy|Z.Static,visible:t.value,name:"DisclosurePanel"})}}});const qe={class:"space-y-4 text-base"},Ae={key:0},Ke={class:"mb-4"},He={key:1,class:""},Je={class:"flex items-center"},Qe={class:"border rounded-md p-2 mr-2"},Xe={class:"flex flex-col"},Ze={class:"text-sm text-ink-gray-4 mt-1"},We={__name:"ChapterModal",props:_e({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(e){const f=G(e,"modelValue"),v=G(e,"outline"),g=U("$user"),{updateOnboardingStep:a}=ke("learning"),_=e,t=he({title:"",is_scorm_package:0,scorm_package:null}),n=N({url:"lms.lms.api.upsert_chapter",makeParams(o){return{title:t.title,course:_.course,is_scorm_package:t.is_scorm_package,scorm_package:t.scorm_package,name:_.chapterDetail?.name}}}),p=N({url:"frappe.client.insert",makeParams(o){return{doc:{doctype:"Chapter Reference",chapter:o.name,parent:_.course,parenttype:"LMS Course",parentfield:"chapters"}}}}),m=async o=>{n.submit({},{validate(){return S()},onSuccess:r=>{g.data?.is_system_manager&&a("create_first_chapter"),De("chapter_created"),p.submit({name:r.name},{onSuccess(d){O(),v.value.reload(),D.success(__("Chapter added successfully"))},onError(d){D.error(d.messages?.[0]||d)}}),o()},onError(r){D.error(r.messages?.[0]||r)}})},S=()=>{if(!t.title)return __("Title is required");if(t.is_scorm_package&&!t.scorm_package)return __("Please upload a SCORM package")},O=()=>{t.title="",t.is_scorm_package=0,t.scorm_package=null},c=o=>{n.submit({},{validate(){if(!t.title)return"Title is required"},onSuccess(){v.value.reload(),D.success(__("Chapter updated successfully")),o()},onError(r){D.error(r.messages?.[0]||r)}})};re(()=>_.chapterDetail,o=>{t.title=o?.title,t.is_scorm_package=o?.is_scorm_package,t.scorm_package=o?.scorm_package});const E=o=>{if(o.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(o,r)=>(i(),k(l(we),{modelValue:f.value,"onUpdate:modelValue":r[4]||(r[4]=d=>f.value=d),options:{title:e.chapterDetail?o.__("Edit Chapter"):o.__("Add Chapter"),size:"lg",actions:[{label:e.chapterDetail?o.__("Edit"):o.__("Create"),variant:"solid",onClick:d=>e.chapterDetail?c(d):m(d)}]}},{"body-content":y(()=>[h("div",qe,[x(l(ve),{label:"Title",modelValue:t.title,"onUpdate:modelValue":r[0]||(r[0]=d=>t.title=d),required:!0},null,8,["modelValue"]),x(l(be),{size:"sm",label:o.__("SCORM Package"),description:o.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:t.is_scorm_package,"onUpdate:modelValue":r[1]||(r[1]=d=>t.is_scorm_package=d)},null,8,["label","description","modelValue"]),t.is_scorm_package?(i(),V("div",Ae,[t.scorm_package?(i(),V("div",He,[h("div",Je,[h("div",Qe,[x(l(ne),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),h("div",Xe,[h("span",null,P(t.scorm_package.file_name),1),h("span",Ze,P(l(Ce)(t.scorm_package.file_size)),1)]),x(l(xe),{onClick:r[3]||(r[3]=()=>t.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(i(),k(l(ye),{key:0,fileTypes:[".zip"],validateFile:E,onSuccess:r[2]||(r[2]=d=>t.scorm_package=d)},{default:y(({file:d,progress:j,uploading:T,openFileSelector:q})=>[h("div",Ke,[x(l(K),{onClick:q,loading:T},{default:y(()=>[R(P(T?`Uploading ${j}%`:"Upload an ZIP file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):b("",!0)])]),_:1},8,["modelValue","options"]))}},Ye={class:""},Ge=["onClick"],et={class:"flex ml-auto space-x-4"},tt={class:"flex items-center text-sm leading-5 group"},at={key:1,class:"flex mt-2 mb-4 pl-8"},rt={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1}},setup(e){const f=Se(),v=Ee(),g=U("$user"),a=$(!1),_=$(null),t=$e(),{$dialog:n}=t.appContext.config.globalProperties,p=e,m=N({url:"lms.lms.utils.get_course_outline",cache:["course_outline",p.courseName],makeParams(){return{course:p.courseName,progress:p.getProgress}},auto:!0});re(()=>p.courseName,()=>{m.reload()});const S=N({url:"lms.lms.api.delete_lesson",makeParams(s){return{lesson:s.lesson,chapter:s.chapter}},onSuccess(){m.reload(),D.success(__("Lesson deleted successfully"))}}),O=N({url:"lms.lms.api.update_lesson_index",makeParams(s){return{lesson:s.lesson,sourceChapter:s.sourceChapter,targetChapter:s.targetChapter,idx:s.idx}},onSuccess(){D.success(__("Lesson moved successfully"))}}),c=(s,w)=>{n({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(B){S.submit({lesson:s,chapter:w}),B()}}]})},E=s=>s==f.params.chapterNumber||s==1,o=(s=null)=>{_.value=s,a.value=!0},r=()=>_.value,d=s=>{O.submit({lesson:s.item.__draggable_context.element.name,sourceChapter:s.from.dataset.chapter,targetChapter:s.to.dataset.chapter,idx:s.newIndex})},j=N({url:"lms.lms.api.delete_chapter",makeParams(s){return{chapter:s.chapter}},onSuccess(){m.reload(),D.success(__("Chapter deleted successfully"))}}),T=s=>{n({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(w){j.submit({chapter:s}),w()}}]})},q=s=>{if(s.is_scorm_package&&(event.preventDefault(),!p.allowEdit)){if(!g.data){D.success(__("Please enroll for this course to view this lesson"));return}v.push({name:"SCORMChapter",params:{courseName:p.courseName,chapterName:s.name}})}},ce=s=>f.params.chapterNumber==s.split(".")[0]&&f.params.lessonNumber==s.split(".")[1];return(s,w)=>{const B=Pe("router-link");return i(),V(ee,null,[h("div",Ye,[e.title&&(l(m).data?.length||e.allowEdit)?(i(),V("div",{key:0,class:I(["flex items-center justify-between space-x-2 mb-4 px-2",{"sticky top-0 z-10 bg-surface-white border-b px-3 py-2.5 sm:px-5":e.allowEdit}])},[h("div",{class:I(["font-semibold text-lg leading-5 text-ink-gray-9",{"font-medium text-p-base":e.allowEdit}])},P(s.__(e.title)),3),e.allowEdit?(i(),k(l(K),{key:0,size:"md",class:"text-white",onClick:w[0]||(w[0]=u=>o()),style:{"background-color":"rgb(241, 81, 27)"}},{default:y(()=>[R(P(s.__("Add Chapter")),1)]),_:1})):b("",!0)],2)):b("",!0),h("div",{class:I({"border-2 rounded-md py-2 px-2":e.showOutline&&l(m).data?.length})},[(i(!0),V(ee,null,Oe(l(m).data,(u,de)=>(i(),k(l(Fe),{key:u.name,defaultOpen:E(u.idx)},{default:y(({open:X})=>[x(l(Ue),{ref_for:!0,ref:"",class:"flex items-center w-full p-2 group"},{default:y(()=>[x(l(Ne),{class:I([{"rotate-90 transform duration-200":X,"duration-200":!X,hidden:u.is_scorm_package,open:de==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),h("div",{class:"text-base text-left text-ink-gray-9 font-medium leading-5 ml-2",onClick:C=>q(u)},P(u.title),9,Ge),h("div",et,[x(l(te),{text:s.__("Edit Chapter"),placement:"bottom"},{default:y(()=>[e.allowEdit?(i(),k(l(Ve),{key:0,onClick:A(C=>o(u),["prevent"]),class:"h-6 w-6 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])):b("",!0)]),_:2},1032,["text"]),x(l(te),{text:s.__("Delete Chapter"),placement:"bottom"},{default:y(()=>[e.allowEdit?(i(),k(l(ae),{key:0,onClick:A(C=>T(u.name),["prevent"]),class:"h-6 w-6 text-ink-red-3 invisible group-hover:visible"},null,8,["onClick"])):b("",!0)]),_:2},1032,["text"])])]),_:2},1536),u.is_scorm_package?b("",!0):(i(),k(l(je),{key:0},{default:y(()=>[u.is_scorm_package?b("",!0):(i(),k(l(Be),{key:0,list:u.lessons,disabled:!e.allowEdit,"item-key":"name",group:"items",onEnd:d,"data-chapter":u.name},{item:y(({element:C})=>[h("div",{class:I(["outline-lesson pl-8 py-2 pr-4 text-ink-gray-9",ce(C.number)?"bg-surface-gray-3":""])},[x(B,{to:{name:e.allowEdit?"LessonForm":"Lesson",params:{courseName:e.courseName,chapterNumber:C.number.split(".")[0],lessonNumber:C.number.split(".")[1]}}},{default:y(()=>[h("div",tt,[C.icon==="icon-youtube"?(i(),k(l(Me),{key:0,class:"h-5 w-5 text-[#f1511b] stroke-1 mr-2"})):C.icon==="icon-quiz"?(i(),k(l(Le),{key:1,class:"h-5 w-5 text-[#f1511b] stroke-1 mr-2"})):C.icon==="icon-list"?(i(),k(l(ne),{key:2,class:"h-5 w-5 text-[#f1511b] stroke-1 mr-2"})):b("",!0),R(" "+P(C.title)+" ",1),e.allowEdit?(i(),k(l(ae),{key:3,onClick:A(st=>c(C.name,u.name),["prevent"]),class:"h-5 w-5 text-ink-red-3 ml-auto invisible group-hover:visible"},null,8,["onClick"])):b("",!0),C.is_complete?(i(),k(l(Ie),{key:4,class:"h-4 w-4 text-green-700 ml-2"})):b("",!0)])]),_:2},1032,["to"])],2)]),_:2},1032,["list","disabled","data-chapter"])),e.allowEdit?(i(),V("div",at,[u.is_scorm_package?b("",!0):(i(),k(B,{key:0,to:{name:"LessonForm",params:{courseName:e.courseName,chapterNumber:u.idx,lessonNumber:u.lessons.length+1}}},{default:y(()=>[x(l(K),{size:"md",class:"text-white",style:{"background-color":"rgb(241, 81, 27)"}},{default:y(()=>[R(P(s.__("Add Lesson")),1)]),_:1})]),_:2},1032,["to"]))])):b("",!0)]),_:2},1024))]),_:2},1032,["defaultOpen"]))),128))],2)]),l(g).data?(i(),k(We,{key:0,modelValue:a.value,"onUpdate:modelValue":w[1]||(w[1]=u=>a.value=u),outline:l(m),"onUpdate:outline":w[2]||(w[2]=u=>Te(m)?m.value=u:null),course:e.courseName,chapterDetail:r()},null,8,["modelValue","outline","course","chapterDetail"])):b("",!0)],64)}}};export{rt as _};
//# sourceMappingURL=CourseOutline-BsrqITMd.js.map
