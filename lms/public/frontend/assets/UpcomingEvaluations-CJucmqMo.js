import{J as B,i as g,K as Y,L as U,A as M,w as j,j as V,f as r,n as c,g as l,e as d,k as h,h as n,t as i,l as t,v as N,q as A,F as D,x as P,C as T,a7 as S,M as z,H as L,r as R,aB as q,b as F,p as $,_ as E,bb as G,bc as H,bd as J,be as I,bf as K,bg as O,bh as Q,ax as W,a6 as X,G as Z,bi as ee,N as te,a as ae}from"./index-DiXMRYjh.js";const se={class:"flex flex-col gap-4"},le={class:"mb-1.5 text-sm text-ink-gray-5"},oe={class:"mb-1.5 text-sm text-ink-gray-5"},ne={key:0},ie={class:"mb-1.5 text-sm text-ink-gray-5"},re={class:"grid grid-cols-2 gap-2"},ce=["onClick"],de={key:1,class:"text-sm italic text-ink-red-4"},ue={__name:"EvaluationModal",props:B({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(_){const b=g("$user"),u=g("$dayjs"),v=Y(_,"modelValue"),y=Y(_,"reloadEvals"),f=_,a=U({course:"",date:"",start_time:"",end_time:"",day:"",batch:f.batch,member:b.data.name}),m=M({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Certificate Request",batch_name:e.batch,...e}}}});function k(e){m.submit(a,{validate(){if(!a.course)return"Please select a course.";if(!a.date)return"Please select a date.";if(!a.start_time)return"Please select a slot.";if(u(a.date).isBefore(u(),"day"))return"Please select a future date.";if(u(a.date).isAfter(u(f.endDate),"day"))return`Please select a date before the end date ${u(f.endDate).format("DD MMMM YYYY")}.`},onSuccess(){y.value.reload(),e()},onError(o){L.warning(__(o.messages?.[0]||o))}})}const x=()=>{const e=[];for(const o of f.courses)o.evaluator&&e.push({label:o.title,value:o.course});return e.length===1&&(a.course=e[0].value),e},p=M({url:"lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(e){return{course:e.course,date:e.date,batch:f.batch}}});j(()=>a.date,e=>{a.start_time="",e&&a.course&&p.submit(a)}),j(()=>a.course,e=>{a.date="",a.start_time="",p.reset()});const C=e=>{a.start_time=e.start_time,a.end_time=e.end_time,a.day=e.day};return(e,o)=>(r(),V(t(z),{modelValue:v.value,"onUpdate:modelValue":o[2]||(o[2]=s=>v.value=s),options:{title:e.__("Schedule Evaluation"),size:"xl",actions:[{label:e.__("Submit"),variant:"solid",onClick:s=>k(s)}]}},{"body-content":c(()=>[l("div",se,[l("div",null,[l("div",le,i(e.__("Course")),1),n(t(N),{modelValue:a.course,"onUpdate:modelValue":o[0]||(o[0]=s=>a.course=s),options:x()},null,8,["modelValue","options"])]),l("div",null,[l("div",oe,i(e.__("Date")),1),n(t(A),{type:"date",modelValue:a.date,"onUpdate:modelValue":o[1]||(o[1]=s=>a.date=s),min:t(u)().add(t(u).duration({days:1})).format("YYYY-MM-DD")},null,8,["modelValue","min"])]),t(p).data?.length?(r(),d("div",ne,[l("div",ie,i(e.__("Select a slot")),1),l("div",re,[(r(!0),d(D,null,P(t(p).data,s=>(r(),d("div",null,[l("div",{class:T(["text-base text-center border rounded-md text-ink-gray-8 bg-surface-gray-3 p-2 cursor-pointer",{"border-outline-gray-4":a.start_time==s.start_time}]),onClick:w=>C(s)},i(t(S)(s.start_time))+" - "+i(t(S)(s.end_time)),11,ce)]))),256))])])):a.course&&a.date?(r(),d("div",de,i(e.__("No slots available for this date.")),1)):h("",!0)])]),_:1},8,["modelValue","options"]))}},me={class:"flex items-center justify-between mb-4"},_e={class:"text-lg text-ink-gray-9 font-semibold"},fe={key:0},ve={class:"grid grid-cols-3 gap-4"},pe={class:"border text-ink-gray-7 rounded-md p-3"},be={class:"flex justify-between mb-3"},he={class:"font-semibold text-ink-gray-9 leading-5"},ge={class:"flex items-center mb-2"},ye={class:"ml-2"},ke={class:"flex items-center mb-2"},xe={class:"ml-2"},Ce={class:"flex items-center"},we={class:"ml-2"},$e={key:0,class:"flex items-center justify-between space-x-2 mt-4"},Ee={key:1,class:"text-sm italic text-ink-gray-5"},De={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null}},setup(_){const b=g("$dayjs"),u=g("$user"),v=R(!1),y=q(),{$dialog:f}=y.appContext.config.globalProperties,a=_,m=M({url:"lms.lms.utils.get_upcoming_evals",params:{student:u.data.name,courses:a.courses.map(e=>e.course),batch:a.batch},auto:!0});function k(){v.value=!0}const x=e=>{window.open(e.google_meet_link,"_blank")},p=F(()=>a.courses.filter(e=>e.evaluator!="")),C=e=>{f({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(o){ae("lms.lms.api.cancel_evaluation",{evaluation:e}).then(()=>{m.reload()}),o()}}]})};return(e,o)=>(r(),d(D,null,[l("div",null,[l("div",me,[l("div",_e,i(e.__("Upcoming Evaluations")),1),t(m).data?.length!=p.value.length?(r(),V(t(E),{key:0,onClick:k},{default:c(()=>[$(i(e.__("Schedule Evaluation")),1)]),_:1})):h("",!0)]),t(m).data?.length?(r(),d("div",fe,[l("div",ve,[(r(!0),d(D,null,P(t(m).data,s=>(r(),d("div",null,[l("div",pe,[l("div",be,[l("span",he,i(s.course_title),1),s.date>t(b)().format()?(r(),V(t(Q),{key:0,as:"div",class:"relative inline-block text-left"},{default:c(()=>[l("div",null,[n(t(G),{class:"inline-flex w-full justify-center"},{default:c(()=>[n(t(H),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),n(J,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:c(()=>[n(t(I),{class:"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5"},{default:c(()=>[n(t(K),null,{default:c(({active:w})=>[n(t(E),{variant:"ghost",class:"w-full",onClick:Me=>C(s)},{prefix:c(()=>[n(t(O),{active:w,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:c(()=>[$(" "+i(e.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):h("",!0)]),l("div",ge,[n(t(W),{class:"w-4 h-4 stroke-1.5"}),l("span",ye,i(t(b)(s.date).format("DD MMMM YYYY")),1)]),l("div",ke,[n(t(X),{class:"w-4 h-4 stroke-1.5"}),l("span",xe,i(t(S)(s.start_time)),1)]),l("div",Ce,[n(t(Z),{class:"w-4 h-4 stroke-1.5"}),l("span",we,i(s.evaluator_name),1)]),s.google_meet_link?(r(),d("div",$e,[n(t(E),{onClick:w=>x(s),class:"w-full"},{prefix:c(()=>[n(t(ee),{class:"w-4 h-4 stroke-1.5"})]),default:c(()=>[$(" "+i(e.__("Join Call")),1)]),_:2},1032,["onClick"])])):h("",!0)])]))),256))])])):(r(),d("div",Ee,i(e.__("Please schedule an evaluation to get certified.")),1))]),n(ue,{batch:_.batch,endDate:_.endDate,courses:_.courses,modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=s=>v.value=s),reloadEvals:t(m),"onUpdate:reloadEvals":o[1]||(o[1]=s=>te(m)?m.value=s:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64))}};export{De as _};
//# sourceMappingURL=UpcomingEvaluations-CJucmqMo.js.map
