import"@headlessui/vue";import{z as K,i as Z,s as G,ap as H,r as J,L as N,o as Q,I as E,A as b,bS as W,V as X,H as x,bT as M,b as Y,u as ee,e as v,f as _,g as s,h as o,l as i,n as f,p as g,t as d,_ as V,q as r,aq as h,aG as ae,af as y,j as te,bV as le,bk as se,k as oe}from"./index-BIerRe8o.js";import{_ as ie}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cdx-1Hlv.js";import"@tiptap/vue-3";import"@vueuse/core";import{_ as ne}from"./MultiSelect-CtWluYIQ.js";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/core";import"@tiptap/extension-code-block";import"@tiptap/extension-heading";import"@tiptap/suggestion";import"@tiptap/extension-link";import"@tiptap/extension-mention";const re={class:""},de={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},me={class:"py-5"},ue={class:"px-20 pb-5 space-y-5 border-b mb-5"},pe={class:"text-lg text-ink-gray-9 font-semibold mb-4"},ce={class:"grid grid-cols-2 gap-5"},be={class:"space-y-5"},_e={class:"px-20 pb-5 space-y-5 border-b mb-5"},fe={class:"text-lg text-ink-gray-9 font-semibold mb-4"},ge={class:"grid grid-cols-3 gap-5"},he={class:"px-20 pb-5 space-y-5 border-b mb-5"},ye={class:"text-lg text-ink-gray-9 font-semibold mb-4"},ve={class:"grid grid-cols-3 gap-10"},Ve={class:"space-y-5"},we={class:"space-y-5"},ke={class:"space-y-5"},Se={class:"px-20 pb-5 space-y-5 border-b mb-5"},Be={class:"block text-sm text-ink-gray-5 mb-1"},Ce={class:"px-20 pb-5 space-y-5 border-b mb-5"},Ue={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Ne={class:"grid grid-cols-3 gap-10"},Ee={class:"space-y-5"},xe={class:"space-y-5"},Me={class:"space-y-5"},De={class:"text-xs text-ink-gray-5"},Te={class:"flex items-center"},Le={class:"border rounded-md w-fit py-5 px-20"},qe={class:"ml-4"},Ie={class:"mt-1 text-ink-gray-5 text-sm leading-5"},Oe={key:1,class:"mb-4"},$e={class:"flex items-center"},ze=["src"],Pe={class:"ml-4"},je={class:"mt-2 text-ink-gray-5 text-sm"},Ae={class:"px-20 pb-5 space-y-5"},Re={class:"text-lg text-ink-gray-9 font-semibold"},Fe={key:0,class:"grid grid-cols-3 gap-5"},Ke={class:"px-20 pb-5 space-y-5 border-b"},Ze={class:"text-lg text-ink-gray-9 font-semibold"},Ge={class:"space-y-5"},_a={__name:"BatchForm",props:{batchName:{type:String,required:!0}},setup(D){const w=K(),k=Z("$user"),{brand:T}=G(),{updateOnboardingStep:L}=H("learning"),p=J([]),m=D,l=N({title:"",published:!1,description:"",batch_details:"",start_date:"",end_date:"",start_time:"",end_time:"",timezone:"",evaluation_end_date:"",confirmation_email_template:"",seat_count:"",medium:"",category:"",allow_self_enrollment:!1,certification:!1,image:null,paid_batch:!1,currency:"",amount:0,zoom_account:""}),u=N({description:"",keywords:""});Q(()=>{k.data||(window.location.href="/login"),m.batchName!="new"?q():E("batch_form_opened"),window.addEventListener("keydown",S)});const q=()=>{c.reload(),W("batches",m.batchName,u)},S=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(B(),e.preventDefault())};X(()=>{window.removeEventListener("keydown",S)});const I=b({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Batch",meta_image:l.image?.file_url,instructors:p.value.map(t=>({instructor:t})),...l}}}}),c=b({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Batch",name:m.batchName}},onSuccess(e){Object.keys(e).forEach(a=>{if(a=="instructors")e.instructors.forEach(n=>{p.value.push(n.instructor)});else if(["start_time","end_time"].includes(a)){let[n,C,U]=e[a].split(":");n=n.length==1?"0"+n:n,l[a]=`${n}:${C}`}else Object.hasOwn(l,a)&&(l[a]=e[a])});let t=["published","paid_batch","allow_self_enrollment","certification"];for(let a in t){let n=t[a];l[n]=!!l[n]}e.meta_image&&$.reload({image:e.meta_image})}}),O=b({url:"frappe.client.set_value",makeParams(e){return{doctype:"LMS Batch",name:m.batchName,fieldname:{meta_image:l.image?.file_url,instructors:p.value.map(t=>({instructor:t})),...l}}}}),$=b({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.image=e}}),B=()=>{c.data?P():z()},z=()=>{I.submit({},{onSuccess(e){k.data?.is_system_manager&&L("create_first_batch",!0,!1,()=>{localStorage.setItem("firstBatch",e.name)}),M("batches",e.name,u),E("batch_created"),w.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){x.error(e.messages?.[0]||e)}})},P=()=>{O.submit({},{onSuccess(e){M("batches",e.name,u),w.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){x.error(e.messages?.[0]||e)}})},j=e=>{l.image=e},A=()=>{l.image=null},R=e=>{let t=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(t))return"Only image file is allowed."},F=Y(()=>{let e=[{label:"Batches",route:{name:"Batches"}}];return c.data&&e.push({label:c.data.title,route:{name:"BatchDetail",params:{batchName:m.batchName}}}),e.push({label:m.batchName=="new"?"New Batch":"Edit Batch",route:{name:"BatchForm",params:{batchName:m.batchName}}}),e});return ee(()=>({title:m.batchName=="new"?"New Batch":c.data?.title,icon:T.favicon})),(e,t)=>(_(),v("div",re,[s("header",de,[o(i(ie),{class:"h-7",items:F.value},null,8,["items"]),o(i(V),{variant:"solid",onClick:t[0]||(t[0]=a=>B())},{default:f(()=>[g(d(e.__("Save")),1)]),_:1})]),s("div",me,[s("div",ue,[s("div",pe,d(e.__("Details")),1),s("div",ce,[s("div",be,[o(i(r),{modelValue:l.title,"onUpdate:modelValue":t[1]||(t[1]=a=>l.title=a),label:e.__("Title"),required:!0,class:"w-full"},null,8,["modelValue","label"]),o(ne,{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=a=>p.value=a),doctype:"Course Evaluator",label:e.__("Instructors"),required:!0,onCreate:a=>i(h)("Evaluators",a),filters:{ignore_user_type:1}},null,8,["modelValue","label","onCreate"])]),o(i(r),{modelValue:l.description,"onUpdate:modelValue":t[3]||(t[3]=a=>l.description=a),label:e.__("Short Description"),type:"textarea",rows:8,placeholder:e.__("Short description of the batch"),required:!0},null,8,["modelValue","label","placeholder"])])]),s("div",_e,[s("div",fe,d(e.__("Settings")),1),s("div",ge,[o(i(r),{modelValue:l.published,"onUpdate:modelValue":t[4]||(t[4]=a=>l.published=a),type:"checkbox",label:e.__("Published")},null,8,["modelValue","label"]),o(i(r),{modelValue:l.allow_self_enrollment,"onUpdate:modelValue":t[5]||(t[5]=a=>l.allow_self_enrollment=a),type:"checkbox",label:e.__("Allow self enrollment")},null,8,["modelValue","label"]),o(i(r),{modelValue:l.certification,"onUpdate:modelValue":t[6]||(t[6]=a=>l.certification=a),type:"checkbox",label:e.__("Certification")},null,8,["modelValue","label"])])]),s("div",he,[s("div",ye,d(e.__("Date and Time")),1),s("div",ve,[s("div",Ve,[o(i(r),{modelValue:l.start_date,"onUpdate:modelValue":t[7]||(t[7]=a=>l.start_date=a),label:e.__("Start Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(i(r),{modelValue:l.end_date,"onUpdate:modelValue":t[8]||(t[8]=a=>l.end_date=a),label:e.__("End Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",we,[o(i(r),{modelValue:l.start_time,"onUpdate:modelValue":t[9]||(t[9]=a=>l.start_time=a),label:e.__("Start Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(i(r),{modelValue:l.end_time,"onUpdate:modelValue":t[10]||(t[10]=a=>l.end_time=a),label:e.__("End Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",ke,[o(i(r),{modelValue:l.timezone,"onUpdate:modelValue":t[11]||(t[11]=a=>l.timezone=a),label:e.__("Timezone"),type:"text",placeholder:e.__("Example: IST (+5:30)"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"]),o(i(r),{modelValue:l.evaluation_end_date,"onUpdate:modelValue":t[12]||(t[12]=a=>l.evaluation_end_date=a),label:e.__("Evaluation End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"])])])]),s("div",Se,[s("div",null,[s("label",Be,[g(d(e.__("Batch Details"))+" ",1),t[26]||(t[26]=s("span",{class:"text-ink-red-3"},"*",-1))]),o(i(ae),{content:l.batch_details,onChange:t[13]||(t[13]=a=>l.batch_details=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem] max-h-[20rem] overflow-y-scroll mb-4"},null,8,["content"])])]),s("div",Ce,[s("div",Ue,d(e.__("Configurations")),1),s("div",Ne,[s("div",Ee,[o(i(r),{modelValue:l.seat_count,"onUpdate:modelValue":t[14]||(t[14]=a=>l.seat_count=a),label:e.__("Seat Count"),type:"number",class:"mb-4",placeholder:e.__("Number of seats available")},null,8,["modelValue","label","placeholder"]),o(y,{doctype:"Email Template",label:e.__("Email Template"),modelValue:l.confirmation_email_template,"onUpdate:modelValue":t[15]||(t[15]=a=>l.confirmation_email_template=a),onCreate:(a,n)=>{i(h)("Email Templates",n)}},null,8,["label","modelValue","onCreate"]),o(y,{doctype:"LMS Zoom Settings",label:e.__("Zoom Account"),modelValue:l.zoom_account,"onUpdate:modelValue":t[16]||(t[16]=a=>l.zoom_account=a),onCreate:(a,n)=>{i(h)("Zoom Accounts",n)}},null,8,["label","modelValue","onCreate"])]),s("div",xe,[o(i(r),{modelValue:l.medium,"onUpdate:modelValue":t[17]||(t[17]=a=>l.medium=a),type:"select",options:[{label:"Online",value:"Online"},{label:"Offline",value:"Offline"}],label:e.__("Medium"),class:"mb-4"},null,8,["modelValue","label"]),o(y,{doctype:"LMS Category",label:e.__("Category"),modelValue:l.category,"onUpdate:modelValue":t[18]||(t[18]=a=>l.category=a),onCreate:(a,n)=>i(h)("Categories",n)},null,8,["label","modelValue","onCreate"])]),s("div",Me,[s("div",null,[s("div",De,d(e.__("Meta Image")),1),l.image?(_(),v("div",Oe,[s("div",$e,[s("img",{src:l.image.file_url,class:"border rounded-md w-40"},null,8,ze),s("div",Pe,[o(i(V),{onClick:t[20]||(t[20]=a=>A())},{default:f(()=>[g(d(e.__("Remove")),1)]),_:1}),s("div",je,d(e.__("Appears when the batch URL is shared on any online platform")),1)])])])):(_(),te(i(se),{key:0,fileTypes:["image/*"],validateFile:R,onSuccess:t[19]||(t[19]=a=>j(a))},{default:f(({file:a,progress:n,uploading:C,openFileSelector:U})=>[s("div",Te,[s("div",Le,[o(i(le),{class:"size-5 stroke-1 text-ink-gray-7"})]),s("div",qe,[o(i(V),{onClick:U},{default:f(()=>[g(d(e.__("Upload")),1)]),_:2},1032,["onClick"]),s("div",Ie,d(e.__("Appears when the batch URL is shared on socials")),1)])])]),_:1}))])])])]),s("div",Ae,[s("div",Re,d(e.__("Pricing")),1),o(i(r),{modelValue:l.paid_batch,"onUpdate:modelValue":t[21]||(t[21]=a=>l.paid_batch=a),type:"checkbox",label:e.__("Paid Batch")},null,8,["modelValue","label"]),l.paid_batch?(_(),v("div",Fe,[o(i(r),{modelValue:l.amount,"onUpdate:modelValue":t[22]||(t[22]=a=>l.amount=a),label:e.__("Amount"),type:"number"},null,8,["modelValue","label"]),o(y,{doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":t[23]||(t[23]=a=>l.currency=a),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])):oe("",!0)]),s("div",Ke,[s("div",Ze,d(e.__("Meta Tags")),1),s("div",Ge,[o(i(r),{modelValue:u.description,"onUpdate:modelValue":t[24]||(t[24]=a=>u.description=a),label:e.__("Meta Description"),type:"textarea",rows:7},null,8,["modelValue","label"]),o(i(r),{modelValue:u.keywords,"onUpdate:modelValue":t[25]||(t[25]=a=>u.keywords=a),label:e.__("Meta Keywords"),type:"textarea",rows:7,placeholder:e.__("Comma separated keywords for SEO")},null,8,["modelValue","label","placeholder"])])])])]))}};export{_a as default};
//# sourceMappingURL=BatchForm-BEzoG1-k.js.map
