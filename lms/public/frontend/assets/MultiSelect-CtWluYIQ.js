import{J as E,K as T,c7 as U,r as m,b as _,A,e as u,f as o,k as x,g as r,C as S,p as I,t as g,h as c,n as p,l,bs as L,bi as R,F as $,x as O,j as J,_ as X,P as G,bj as H,bU as Q,bx as W,bn as Y,a2 as Z}from"./index-BIerRe8o.js";import{ComboboxOptions as ee,ComboboxOption as te,ComboboxInput as se,Combobox as ae}from"@headlessui/vue";import{watchDebounced as le}from"@vueuse/core";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";const oe={key:0,class:"text-ink-red-3"},re={class:"w-full"},ue={class:"mt-1 rounded-lg bg-surface-white py-1 text-base border-2"},ie={class:"flex flex-col gap-1 p-1"},ne={class:"text-base font-medium text-ink-gray-8"},ce={class:"text-sm text-ink-gray-5"},de={key:0,class:"absolute bottom-2 left-1 w-[99%] pt-2 bg-white border-t"},me={key:1,class:"grid grid-cols-2 gap-2 mt-1"},pe={class:"flex items-center justify-between break-all bg-surface-gray-2 text-ink-gray-7 word-wrap p-2 rounded-md mr-2"},fe={class:"break-all"},$e={__name:"MultiSelect",props:E({label:{type:String},size:{type:String,default:"sm"},doctype:{type:String,required:!0},filters:{type:Object,default:()=>({})},validate:{type:Function,default:null},errorMessage:{type:Function,default:i=>`${i} is an Invalid value`},required:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(i,{expose:j}){const n=i,a=T(i,"modelValue"),C=U(),v=m([]),V=m(null),k=m(null),d=m(""),b=m(""),y=m(!1),F=_({get:()=>d.value||"",set:e=>{d.value="",e&&(y.value=!1),e?.value&&q(e.value)}});le(d,e=>{e=e||"",b.value!==e&&(b.value=e,N(e))},{debounce:300,immediate:!0});const w=A({url:"frappe.desk.search.search_link",method:"POST",cache:[b.value,n.doctype],auto:!0,params:{txt:b.value,doctype:n.doctype}}),B=_(()=>w.data||[]);function N(e){w.update({params:{txt:e,doctype:n.doctype}}),w.reload()}const q=e=>{k.value=null,e&&(e.split(",").forEach(t=>{if(t=t.trim(),t&&!a.value?.includes(t)){if(t&&n.validate&&!n.validate(t)){k.value=n.errorMessage(t);return}a.value?a.value.push(t):a.value=[t],t=t.replace(t,"")}}),!k.value&&(e=""))},z=e=>{a.value=a.value.filter(s=>s!==e)},K=()=>{if(d.value)return;let e=v.value[v.value.length-1]?.$el;document.activeElement===e?(a.value.pop(),Z(()=>{a.value.length?(e=v.value[v.value.length-1].$el,e?.focus()):M()})):e?.focus()};function M(){V.value.$el.focus()}j({setFocus:M});const P=_(()=>[{sm:"text-xs",md:"text-base"}[n.size||"sm"],"text-ink-gray-5"]);return(e,s)=>(o(),u("div",null,[i.label?(o(),u("label",{key:0,class:S(["block mb-1",P.value])},[I(g(i.label)+" ",1),i.required?(o(),u("span",oe,"*")):x("",!0)],2)):x("",!0),r("div",re,[c(l(ae),{modelValue:F.value,"onUpdate:modelValue":s[2]||(s[2]=t=>F.value=t),nullable:""},{default:p(()=>[c(l(L),{class:"w-full",show:y.value,"onUpdate:show":s[1]||(s[1]=t=>y.value=t)},{target:p(({togglePopover:t})=>[c(l(se),{ref_key:"search",ref:V,class:"search-input form-input w-full focus-visible:!ring-0",type:"text",value:d.value,onChange:s[0]||(s[0]=h=>{d.value=h.target.value,y.value=!0}),autocomplete:"off",onFocus:()=>t(),onKeydownCapture:Q(W(K,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:p(({isOpen:t,close:h})=>[R(r("div",null,[r("div",ue,[c(l(ee),{class:"my-1 min-h-[6rem] max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:p(()=>[(o(!0),u($,null,O(B.value,f=>(o(),J(l(te),{key:f.value,value:f},{default:p(({active:D})=>[r("li",{class:S(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-2":D}])},[r("div",ie,[r("div",ne,g(f.description),1),r("div",ce,g(f.value),1)])],2)]),_:2},1032,["value"]))),128)),s[3]||(s[3]=r("div",{class:"h-10"},null,-1)),l(C).onCreate?(o(),u("div",de,[c(l(X),{variant:"ghost",class:"w-full !justify-start",label:e.__("Create New"),onClick:f=>l(C).onCreate(h)},{prefix:p(()=>[c(l(G),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["label","onClick"])])):x("",!0)]),_:2,__:[3]},1024)])],512),[[H,t]])]),_:1},8,["show"])]),_:1},8,["modelValue"])]),a.value.length?(o(),u("div",me,[(o(!0),u($,null,O(a.value,t=>(o(),u("div",pe,[r("span",fe,g(t),1),c(l(Y),{class:"size-4 stroke-1.5 cursor-pointer",onClick:h=>z(t)},null,8,["onClick"])]))),256))])):x("",!0)]))}};export{$e as _};
//# sourceMappingURL=MultiSelect-CtWluYIQ.js.map
