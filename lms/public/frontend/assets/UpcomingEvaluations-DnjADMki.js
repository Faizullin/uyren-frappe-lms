import{Q as B,i as g,R as Y,T as U,I as V,A as j,B as M,o as r,w as c,d as l,c as d,h as b,b as n,t as i,s as t,G as N,E as A,F as D,f as P,n as T,ad as S,V as R,N as z,g as G,aG as q,q as F,e as E,D as $,bg as I,bh as L,bi as H,bj as J,bk as Q,bl as W,bm as K,aC as O,ac as X,M as Z,bn as ee,W as te,l as ae}from"./index-CgbsATbs.js";const se={class:"flex flex-col gap-4"},le={class:"mb-1.5 text-sm text-ink-gray-5"},oe={class:"mb-1.5 text-sm text-ink-gray-5"},ne={key:0},ie={class:"mb-1.5 text-sm text-ink-gray-5"},re={class:"grid grid-cols-2 gap-2"},ce=["onClick"],de={key:1,class:"text-sm italic text-ink-red-4"},ue={__name:"EvaluationModal",props:B({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(_){const h=g("$user"),u=g("$dayjs"),v=Y(_,"modelValue"),y=Y(_,"reloadEvals"),f=_,a=U({course:"",date:"",start_time:"",end_time:"",day:"",batch:f.batch,member:h.data.name}),m=V({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Certificate Request",batch_name:e.batch,...e}}}});function k(e){m.submit(a,{validate(){if(!a.course)return"Please select a course.";if(!a.date)return"Please select a date.";if(!a.start_time)return"Please select a slot.";if(u(a.date).isBefore(u(),"day"))return"Please select a future date.";if(u(a.date).isAfter(u(f.endDate),"day"))return`Please select a date before the end date ${u(f.endDate).format("DD MMMM YYYY")}.`},onSuccess(){y.value.reload(),e()},onError(o){z.warning(__(o.messages?.[0]||o))}})}const C=()=>{const e=[];for(const o of f.courses)o.evaluator&&e.push({label:o.title,value:o.course});return e.length===1&&(a.course=e[0].value),e},p=V({url:"lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(e){return{course:e.course,date:e.date,batch:f.batch}}});j(()=>a.date,e=>{a.start_time="",e&&a.course&&p.submit(a)}),j(()=>a.course,e=>{a.date="",a.start_time="",p.reset()});const x=e=>{a.start_time=e.start_time,a.end_time=e.end_time,a.day=e.day};return(e,o)=>(r(),M(t(R),{modelValue:v.value,"onUpdate:modelValue":o[2]||(o[2]=s=>v.value=s),options:{title:e.__("Schedule Evaluation"),size:"xl",actions:[{label:e.__("Submit"),variant:"solid",onClick:s=>k(s)}]}},{"body-content":c(()=>[l("div",se,[l("div",null,[l("div",le,i(e.__("Course")),1),n(t(N),{modelValue:a.course,"onUpdate:modelValue":o[0]||(o[0]=s=>a.course=s),options:C()},null,8,["modelValue","options"])]),l("div",null,[l("div",oe,i(e.__("Date")),1),n(t(A),{type:"date",modelValue:a.date,"onUpdate:modelValue":o[1]||(o[1]=s=>a.date=s),min:t(u)().add(t(u).duration({days:1})).format("YYYY-MM-DD")},null,8,["modelValue","min"])]),t(p).data?.length?(r(),d("div",ne,[l("div",ie,i(e.__("Select a slot")),1),l("div",re,[(r(!0),d(D,null,P(t(p).data,s=>(r(),d("div",null,[l("div",{class:T(["text-base text-center border rounded-md text-ink-gray-8 bg-surface-gray-3 p-2 cursor-pointer",{"border-outline-gray-4":a.start_time==s.start_time}]),onClick:w=>x(s)},i(t(S)(s.start_time))+" - "+i(t(S)(s.end_time)),11,ce)]))),256))])])):a.course&&a.date?(r(),d("div",de,i(e.__("No slots available for this date.")),1)):b("",!0)])]),_:1},8,["modelValue","options"]))}},me={class:"flex items-center justify-between mb-4"},_e={class:"text-lg text-ink-gray-9 font-semibold"},fe={key:0},ve={class:"grid grid-cols-3 gap-4"},pe={class:"border text-ink-gray-7 rounded-md p-3"},he={class:"flex justify-between mb-3"},be={class:"font-semibold text-ink-gray-9 leading-5"},ge={class:"flex items-center mb-2"},ye={class:"ml-2"},ke={class:"flex items-center mb-2"},Ce={class:"ml-2"},xe={class:"flex items-center"},we={class:"ml-2"},Ee={key:0,class:"flex items-center justify-between space-x-2 mt-4"},$e={key:1,class:"text-sm italic text-ink-gray-5"},De={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null}},setup(_){const h=g("$dayjs"),u=g("$user"),v=G(!1),y=q(),{$dialog:f}=y.appContext.config.globalProperties,a=_,m=V({url:"lms.lms.utils.get_upcoming_evals",params:{student:u.data.name,courses:a.courses.map(e=>e.course),batch:a.batch},auto:!0});function k(){v.value=!0}const C=e=>{window.open(e.google_meet_link,"_blank")},p=F(()=>a.courses.filter(e=>e.evaluator!="")),x=e=>{f({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(o){ae("lms.lms.api.cancel_evaluation",{evaluation:e}).then(()=>{m.reload()}),o()}}]})};return(e,o)=>(r(),d(D,null,[l("div",null,[l("div",me,[l("div",_e,i(e.__("Upcoming Evaluations")),1),t(m).data?.length!=p.value.length?(r(),M(t($),{key:0,onClick:k},{default:c(()=>[E(i(e.__("Schedule Evaluation")),1)]),_:1})):b("",!0)]),t(m).data?.length?(r(),d("div",fe,[l("div",ve,[(r(!0),d(D,null,P(t(m).data,s=>(r(),d("div",null,[l("div",pe,[l("div",he,[l("span",be,i(s.course_title),1),s.date>t(h)().format()?(r(),M(t(K),{key:0,as:"div",class:"relative inline-block text-left"},{default:c(()=>[l("div",null,[n(t(I),{class:"inline-flex w-full justify-center"},{default:c(()=>[n(t(L),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),n(H,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:c(()=>[n(t(J),{class:"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5"},{default:c(()=>[n(t(Q),null,{default:c(({active:w})=>[n(t($),{variant:"ghost",class:"w-full",onClick:Ve=>x(s)},{prefix:c(()=>[n(t(W),{active:w,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:c(()=>[E(" "+i(e.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):b("",!0)]),l("div",ge,[n(t(O),{class:"w-4 h-4 stroke-1.5"}),l("span",ye,i(t(h)(s.date).format("DD MMMM YYYY")),1)]),l("div",ke,[n(t(X),{class:"w-4 h-4 stroke-1.5"}),l("span",Ce,i(t(S)(s.start_time)),1)]),l("div",xe,[n(t(Z),{class:"w-4 h-4 stroke-1.5"}),l("span",we,i(s.evaluator_name),1)]),s.google_meet_link?(r(),d("div",Ee,[n(t($),{onClick:w=>C(s),class:"w-full"},{prefix:c(()=>[n(t(ee),{class:"w-4 h-4 stroke-1.5"})]),default:c(()=>[E(" "+i(e.__("Join Call")),1)]),_:2},1032,["onClick"])])):b("",!0)])]))),256))])])):(r(),d("div",$e,i(e.__("Please schedule an evaluation to get certified.")),1))]),n(ue,{batch:_.batch,endDate:_.endDate,courses:_.courses,modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=s=>v.value=s),reloadEvals:t(m),"onUpdate:reloadEvals":o[1]||(o[1]=s=>te(m)?m.value=s:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64))}};export{De as _};
//# sourceMappingURL=UpcomingEvaluations-DnjADMki.js.map
