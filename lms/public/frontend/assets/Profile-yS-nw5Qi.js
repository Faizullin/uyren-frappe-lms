import"@headlessui/vue";import{i as M,d as N,e as b,f as r,g as a,k as C,p as x,t as n,l as s,h as l,n as m,_ as S,J as A,K as q,L as O,A as U,w as R,j as w,bk as z,bl as H,bm as D,bn as G,q as E,aG as J,M as K,H as X,r as F,bo as Y,F as B,x as Q,bp as W,bq as Z,br as ee,bs as se,s as te,R as ae,z as oe,o as le,aI as re,bt as ie,b as ne,u as de,C as ue,bu as I,N as me}from"./index-BIerRe8o.js";import{_ as ce}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cdx-1Hlv.js";import{T as pe}from"./TabButtons-DGauTnEB.js";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";import"@vueuse/core";import{_ as fe}from"./UserAvatar-D66_PbG8.js";import"@tiptap/core";import"@tiptap/extension-code-block";import"@tiptap/extension-heading";import"@tiptap/suggestion";import"@tiptap/extension-link";const _e={class:"border rounded-md w-1/3 mx-auto my-32"},be={class:"border-b px-5 py-3 font-medium"},ge={key:0,class:"px-5 py-3"},ve={class:"px-5 py-3"},he={__name:"NoPermission",setup($){const y=M("$user"),p=()=>{window.location.href="/login"};return(t,f)=>{const k=N("router-link");return r(),b("div",_e,[a("div",be,[f[1]||(f[1]=a("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),x(" "+n(t.__("Not Permitted")),1)]),s(y).data?(r(),b("div",ge,[a("div",null,n(t.__("You do not have permission to access this page.")),1),l(k,{to:{name:"Courses"}},{default:m(()=>[l(s(S),{variant:"solid",class:"mt-2"},{default:m(()=>[x(n(t.__("Checkout Courses")),1)]),_:1})]),_:1})])):C("",!0),a("div",ve,[a("div",null,n(t.__("Please login to access this page.")),1),l(s(S),{onClick:f[0]||(f[0]=_=>p()),class:"mt-4"},{default:m(()=>[x(n(t.__("Login")),1)]),_:1})])])}}},xe={class:"mb-4"},ye={key:1,class:"mb-4"},ke={class:"text-xs text-ink-gray-5 mb-1"},we={class:"flex items-center"},$e={class:"border rounded-md p-2 mr-2"},Pe={class:"text-base flex flex-col"},Ce={class:"text-sm text-ink-gray-4 mt-1"},Se={class:"mb-4"},Ue={class:"mb-1.5 text-sm text-ink-gray-5"},Ve={__name:"EditProfile",props:A({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup($){const y=q($,"reloadProfile"),p=$,t=O({first_name:"",last_name:"",headline:"",bio:"",image:""}),f=U({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){t.image=e}}),k=U({url:"frappe.client.set_value",makeParams(e){return{doctype:"User",name:p.profile.data.name,fieldname:{user_image:t.image.file_url,...t}}},onSuccess(e){p.profile.data=e}}),_=e=>{k.submit({},{onSuccess(){e(),y.value.reload()},onError(o){X.error(o.messages?.[0]||o)}})},c=e=>{let o=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(o))return"Only image file is allowed."},g=e=>{t.image=e},d=()=>{t.image=null};return R(()=>p.profile.data,e=>{e&&(t.first_name=e.first_name,t.last_name=e.last_name,t.headline=e.headline,t.bio=e.bio,e.user_image&&f.submit({image:e.user_image}))}),(e,o)=>(r(),w(s(K),{options:{title:"Edit your profile",size:"xl",actions:[{label:"Save",variant:"solid",onClick:i=>_(i)}]}},{"body-content":m(()=>[a("div",null,[t.image?(r(),b("div",ye,[a("div",ke,n(e.__("Profile Image")),1),a("div",we,[a("div",$e,[l(s(H),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),a("div",Pe,[a("span",null,n(t.image.file_name),1),a("span",Ce,n(s(D)(t.image.file_size)),1)]),l(s(G),{onClick:o[1]||(o[1]=i=>d()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(r(),w(s(z),{key:0,fileTypes:["image/*"],validateFile:c,onSuccess:o[0]||(o[0]=i=>g(i))},{default:m(({file:i,progress:j,uploading:P,openFileSelector:T})=>[a("div",xe,[l(s(S),{onClick:T,loading:P},{default:m(()=>[x(n(P?`Uploading ${j}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),l(s(E),{modelValue:t.first_name,"onUpdate:modelValue":o[2]||(o[2]=i=>t.first_name=i),label:e.__("First Name"),class:"mb-4"},null,8,["modelValue","label"]),l(s(E),{modelValue:t.last_name,"onUpdate:modelValue":o[3]||(o[3]=i=>t.last_name=i),label:e.__("Last Name"),class:"mb-4"},null,8,["modelValue","label"]),l(s(E),{modelValue:t.headline,"onUpdate:modelValue":o[4]||(o[4]=i=>t.headline=i),label:e.__("Headline"),class:"mb-4"},null,8,["modelValue","label"]),a("div",Se,[a("div",Ue,n(e.__("Bio")),1),l(s(J),{fixedMenu:!0,onChange:o[5]||(o[5]=i=>t.bio=i),content:t.bio,editorClass:"prose-sm py-2 px-2 min-h-[200px] border-outline-gray-2 hover:border-outline-gray-3 rounded-md bg-surface-gray-3"},null,8,["content"])])])]),_:1},8,["options"]))}},je={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-surface-white px-4 sm:px-0 lg:max-w-3xl"},Te={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Ee={class:"flex items-center justify-center space-x-2"},Fe={class:""},Re={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-surface-white lg:grid-cols-2"},Ie=["onClick"],Me=["src"],Ne={key:0,class:"mt-2 text-center text-sm text-ink-gray-4"},ze={class:"underline",target:"_blank",href:"https://unsplash.com"},Be={__name:"EditCoverImage",emits:["select"],setup($,{emit:y}){const p=F(null),t=y,f=U({url:"lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:p.value}),auto:!0,debounce:500});R(()=>p.value,()=>{f.reload()});const k=c=>{t("select",c.file_url)},_=c=>{let g=c.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(g))return"Only image file is allowed."};return(c,g)=>(r(),w(s(se),{transition:"default"},{target:m(({isOpen:d,togglePopover:e})=>[W(c.$slots,"default",Z(ee({isOpen:d,togglePopover:e})))]),body:m(()=>[a("div",je,[a("div",Te,[a("div",Ee,[l(s(Y),{type:"text",placeholder:"search by keyword",modelValue:p.value,"onUpdate:modelValue":g[0]||(g[0]=d=>p.value=d),debounce:300,class:"flex-1"},null,8,["modelValue"]),l(s(z),{fileTypes:["image/*"],validateFile:_,onSuccess:g[1]||(g[1]=d=>k(d))},{default:m(({file:d,progress:e,uploading:o,openFileSelector:i})=>[a("div",Fe,[l(s(S),{onClick:i,loading:o},{default:m(()=>[x(n(o?`Uploading ${e}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),a("div",Re,[(r(!0),b(B,null,Q(s(f).data,d=>(r(),b("button",{key:d.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:e=>c.$emit("select",d.urls.raw)},[a("img",{src:d.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Me)],8,Ie))),128))]),s(f).data?(r(),b("div",Ne,[x(n(c.__("Image search powered by"))+" ",1),a("a",ze,n(c.__("Unsplash")),1)])):C("",!0)])])]),_:3}))}},Le={key:1},Ae={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},qe={class:"group relative h-[130px] w-full"},Oe=["src"],He={key:2,class:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},De={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},Ge={class:"flex flex-col md:flex-row items-center"},Je=["src"],Ke={class:"ml-6"},Xe={class:"mt-2 text-3xl font-semibold text-ink-gray-9"},Ye={class:"mt-2 text-base text-ink-gray-7"},Qe={class:"mb-4 mt-6"},ys={__name:"Profile",props:{username:{type:String,required:!0}},setup($){const{user:y,brand:p}=te(),t=M("$user"),f=ae(),k=oe(),_=F(""),c=F(!1),g=window.read_only_mode,d=$;le(()=>{t.data&&e.reload(),i()});const e=U({url:"frappe.client.get",makeParams(u){return{doctype:"User",filters:{username:d.username}}}}),o=U({url:"frappe.client.set_value",makeParams(u){return{doctype:"User",name:e.data?.name,fieldname:"cover_image",value:u.url}},onSuccess(){e.reload()}}),i=()=>{let u=f.path.split("/");["certificates","roles","slots","schedule"].forEach(V=>{u.includes(V)&&(_.value=re(V))}),_.value||(_.value="About")};ie(()=>{if(_.value){let u={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Slots:{name:"ProfileEvaluator"},Schedule:{name:"ProfileEvaluationSchedule"}}[_.value];k.push(u)}}),R(()=>d.username,()=>{e.reload()});const j=()=>{c.value=!0},P=()=>t.data?.email===e.data?.email,T=()=>{let u=[{label:"About"},{label:"Certificates"}];return t.data?.is_moderator&&u.push({label:"Roles"}),P()&&(t.data?.is_evaluator||t.data?.is_moderator)&&(u.push({label:"Slots"}),u.push({label:"Schedule"})),u},L=ne(()=>[{label:"People"},{label:e.data?.full_name,route:{name:"Profile",params:{username:y.doc?.username}}}]);return de(()=>({title:e.data?.full_name,icon:p.favicon})),(u,v)=>{const V=N("router-view");return r(),b(B,null,[s(t).data?s(e).data?(r(),b("div",Le,[a("header",Ae,[l(s(ce),{class:"h-7",items:L.value},null,8,["items"])]),a("div",qe,[s(e).data.cover_image?(r(),b("img",{key:0,src:s(e).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,Oe)):(r(),b("div",{key:1,class:ue([{"bg-surface-gray-2":!s(e).data.cover_image},"h-[130px] w-full"])},null,2)),P()?(r(),b("div",He,[l(Be,{onSelect:v[0]||(v[0]=h=>s(o).submit({url:h}))},{default:m(({togglePopover:h})=>[s(g)?C("",!0):(r(),w(s(S),{key:0,variant:"outline",onClick:We=>h()},{prefix:m(()=>[l(s(I),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:m(()=>[x(" "+n(u.__("Edit")),1)]),_:2},1032,["onClick"]))]),_:1})])):C("",!0)]),a("div",De,[a("div",Ge,[a("div",null,[s(e).data.user_image?(r(),b("img",{key:0,src:s(e).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,Je)):(r(),w(fe,{key:1,user:s(e).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),a("div",Ke,[a("h2",Xe,n(s(e).data.full_name),1),a("div",Ye,n(s(e).data.headline),1)]),P()&&!s(g)?(r(),w(s(S),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:v[1]||(v[1]=h=>j())},{prefix:m(()=>[l(s(I),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:m(()=>[x(" "+n(u.__("Edit Profile")),1)]),_:1})):C("",!0)]),a("div",Qe,[l(s(pe),{class:"inline-block",buttons:T(),modelValue:_.value,"onUpdate:modelValue":v[2]||(v[2]=h=>_.value=h)},null,8,["buttons","modelValue"])]),l(V,{profile:s(e)},null,8,["profile"])])])):C("",!0):(r(),w(he,{key:0})),l(Ve,{modelValue:c.value,"onUpdate:modelValue":v[3]||(v[3]=h=>c.value=h),reloadProfile:s(e),"onUpdate:reloadProfile":v[4]||(v[4]=h=>me(e)?e.value=h:null),profile:s(e)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{ys as default};
//# sourceMappingURL=Profile-yS-nw5Qi.js.map
