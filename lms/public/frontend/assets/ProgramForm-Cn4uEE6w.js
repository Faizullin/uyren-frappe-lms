import{B as J,g as k,u as K,al as Q,z as h,a as W,c as p,o as m,d as n,h as P,b as o,p as e,w as t,e as V,t as g,H as f,I as X,P as M,av as E,F as C,f as x,E as b,aw as D,ay as F,az as B,aB as T,aC as I,aD as U,au as A,aF as Z,Y as ee,l as se,R as d}from"./index-RevCnO16.js";import{_ as ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CeasAM64.js";import{D as re}from"./vuedraggable.umd-Cwiqepd0.js";const oe={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},le={key:0,class:"pt-5 px-5 w-3/4 mx-auto space-y-10"},te={class:"flex items-center justify-between mb-2"},ue={class:"text-lg text-ink-gray-9 font-semibold"},me={class:"flex gap-2"},ne={class:"flex items-center justify-between mb-2"},de={class:"text-lg text-ink-gray-9 font-semibold"},ie={class:"flex gap-2"},ge={__name:"ProgramForm",props:{programName:{type:String,required:!0}},setup(L){const{brand:j}=J(),c=k(!1),_=k(null),v=k(null),w=k(null),z=K(),y=L,r=Q({doctype:"LMS Program",name:y.programName,auto:!0,cache:["program",y.programName]}),R=()=>{r.setValue.submit({program_courses:[...r.doc.program_courses,{course:v.value}]},{onSuccess(s){c.value=!1,v.value=null,d.success(__("Course added to program")),r.reload()},onError(s){d.error(s.messages?.[0]||s)}})},O=()=>{r.setValue.submit({program_members:[...r.doc.program_members,{member:w.value}]},{onSuccess(s){c.value=!1,w.value=null,d.success(__("Member added to program")),r.reload()},onError(s){d.error(s.messages?.[0]||s)}})},N=(s,l,a)=>{s=Array.from(s),r.setValue.submit({[a]:r.doc[a].filter(u=>!s.includes(u.name))},{onSuccess(u){l(),d.success(__("Items removed successfully")),r.reload()},onError(u){d.error(u.messages?.[0]||u)}})},q=s=>{let l=s.from.dataset.idx,a=s.to.dataset.idx,u=r.doc.program_courses;u.splice(a,0,u.splice(l,1)[0]),u.forEach((i,G)=>{i.idx=G+1}),r.setValue.submit({program_courses:u},{onSuccess(i){d.success(__("Course moved successfully")),r.reload()},onError(i){d.error(i.messages?.[0]||i)}})},H=()=>{se("frappe.model.rename_doc.update_document_title",{doctype:"LMS Program",docname:r.doc.name,name:r.doc.title}).then(s=>{z.push({name:"ProgramForm",params:{programName:s}})})},$=h(()=>[{label:"Title",key:"course_title",width:3},{label:"ID",key:"course",width:3}]),S=h(()=>[{label:"Member",key:"member",width:3,align:"left"},{label:"Full Name",key:"full_name",width:3,align:"left"},{label:"Progress (%)",key:"progress",width:3,align:"right"}]),Y=h(()=>[{label:"Programs",route:{name:"Programs"}},{label:y.programName==="new"?"New Program":y.programName}]);return W(()=>({title:r.doc?.title,icon:j.favicon})),(s,l)=>(m(),p(C,null,[n("header",oe,[o(e(ae),{items:Y.value},null,8,["items"]),o(e(f),{variant:"solid",onClick:l[0]||(l[0]=a=>H())},{default:t(()=>[V(g(s.__("Save")),1)]),_:1})]),e(r).doc?(m(),p("div",le,[o(e(X),{modelValue:e(r).doc.title,"onUpdate:modelValue":l[1]||(l[1]=a=>e(r).doc.title=a),label:s.__("Title")},null,8,["modelValue","label"]),n("div",null,[n("div",te,[n("div",ue,g(s.__("Program Courses")),1),o(e(f),{onClick:l[2]||(l[2]=()=>{_.value="course",c.value=!0})},{prefix:t(()=>[o(e(M),{class:"w-4 h-4"})]),default:t(()=>[V(" "+g(s.__("Add")),1)]),_:1})]),o(e(U),{columns:$.value,rows:e(r).doc.program_courses,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[o(e(E),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(m(!0),p(C,null,x($.value,a=>(m(),b(e(D),{item:a},null,8,["item"]))),256))]),_:1}),o(e(F),null,{default:t(()=>[o(e(re),{list:e(r).doc.program_courses,"item-key":"name",group:"items",onEnd:q,class:"cursor-move"},{item:t(({element:a})=>[o(e(B),{row:a},null,8,["row"])]),_:1},8,["list"])]),_:1}),o(e(T),null,{actions:t(({unselectAll:a,selections:u})=>[n("div",me,[o(e(f),{variant:"ghost",onClick:i=>N(u,a,"program_courses")},{default:t(()=>[o(e(I),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])]),n("div",null,[n("div",ne,[n("div",de,g(s.__("Program Members")),1),o(e(f),{onClick:l[3]||(l[3]=()=>{_.value="member",c.value=!0})},{prefix:t(()=>[o(e(M),{class:"w-4 h-4"})]),default:t(()=>[V(" "+g(s.__("Add")),1)]),_:1})]),o(e(U),{columns:S.value,rows:e(r).doc.program_members,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[o(e(E),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(m(!0),p(C,null,x(S.value,a=>(m(),b(e(D),{item:a},null,8,["item"]))),256))]),_:1}),o(e(F),null,{default:t(()=>[(m(!0),p(C,null,x(e(r).doc.program_members,a=>(m(),b(e(B),{row:a},null,8,["row"]))),256))]),_:1}),o(e(T),null,{actions:t(({unselectAll:a,selections:u})=>[n("div",ie,[o(e(f),{variant:"ghost",onClick:i=>N(u,a,"program_members")},{default:t(()=>[o(e(I),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):P("",!0),o(e(ee),{modelValue:c.value,"onUpdate:modelValue":l[6]||(l[6]=a=>c.value=a),options:{title:_.value=="course"?s.__("New Program Course"):s.__("New Program Member"),actions:[{label:s.__("Add"),variant:"solid",onClick:()=>_.value=="course"?R(s.close):O(s.close)}]}},{"body-content":t(()=>[_.value=="course"?(m(),b(A,{key:0,modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=a=>v.value=a),doctype:"LMS Course",filters:{disable_self_learning:1},label:s.__("Program Course"),description:s.__("Only courses for which self learning is disabled can be added to program.")},null,8,["modelValue","label","description"])):P("",!0),_.value=="member"?(m(),b(A,{key:1,modelValue:w.value,"onUpdate:modelValue":l[5]||(l[5]=a=>w.value=a),doctype:"User",filters:{ignore_user_type:1},label:s.__("Program Member"),onCreate:(a,u)=>e(Z)("Members",u)},null,8,["modelValue","label","onCreate"])):P("",!0)]),_:1},8,["modelValue","options"])],64))}};export{ge as default};
//# sourceMappingURL=ProgramForm-Cn4uEE6w.js.map
