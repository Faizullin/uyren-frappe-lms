import{i as le,g as N,x as ae,u as te,au as re,aG as ie,T as I,y as ne,O as D,I as V,bZ as ue,a0 as de,N as h,b_ as L,A as ce,q as me,a as pe,c as x,o as d,d as a,b as r,s as t,B as g,h as v,w as k,as as _e,D as U,t as n,E as i,av as S,ak as E,F as fe,f as be,e as w,bv as ge,b$ as ve,c0 as ye,bs as Ce,aL as Ve}from"./index-CgbsATbs.js";import{_ as he}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-KbxUUXyD.js";import{_ as ke}from"./CourseOutline-Dt314m7b.js";import{_ as F}from"./MultiSelect-tLY7C5yN.js";import"./vuedraggable.umd-Dkn0uGDc.js";const we={class:"h-full"},xe={class:"grid md:grid-cols-[70%,30%] h-full"},Ue={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ne={class:"flex items-center mt-3 md:mt-0"},Se={class:"mt-5 mb-5"},Ee={class:"px-10 pb-5 mb-5 space-y-5 border-b"},$e={class:"text-lg font-semibold mb-4"},Me={class:"grid grid-cols-2 gap-5"},Pe={class:"grid grid-cols-2 gap-5"},Ie={class:"mb-1.5 text-xs text-ink-gray-5"},De={class:"flex items-center"},Le={class:"flex items-center bg-surface-gray-2 text-ink-gray-7 p-2 rounded-md mr-2"},Fe={class:"grid grid-cols-2 gap-5"},Oe={class:"mb-4"},Te={class:"text-xs text-ink-gray-5 mb-2"},Re={class:"flex items-center"},je={class:"border rounded-md w-fit py-5 px-20"},Ae={class:"ml-4"},Be={class:"mt-1 text-ink-gray-5 text-sm leading-5"},Ke={key:1,class:"mb-4"},qe={class:"flex items-center"},ze=["src"],Ge={class:"ml-4"},Xe={class:"mt-2 text-ink-gray-5 text-sm"},Ze={class:"px-10 pb-5 mb-5 space-y-5 border-b"},He={class:"text-lg font-semibold"},Je={class:"grid grid-cols-2 gap-5"},Qe={class:"flex flex-col space-y-5"},We={class:"flex flex-col space-y-5"},Ye={class:"px-10 pb-5 mb-5 space-y-5 border-b"},es={class:""},ss={class:"mb-1.5 text-sm text-ink-gray-5"},os={class:"px-10 pb-5 space-y-5 border-b"},ls={class:"text-lg font-semibold mt-5"},as={class:"grid grid-cols-3"},ts={class:"grid grid-cols-2 gap-5"},rs={class:"space-y-5"},is={class:"px-10 pb-5 space-y-5"},ns={class:"text-lg font-semibold mt-5"},us={class:"space-y-5"},ds={class:"border-l"},gs={__name:"CourseForm",props:{courseName:{type:String}},setup(O){const y=le("$user"),p=N(""),{brand:T}=ae(),C=te(),_=N([]),b=N([]),R=ie(),{updateOnboardingStep:j}=re("learning"),{$dialog:A}=R.appContext.config.globalProperties,c=O,l=I({title:"",short_introduction:"",description:"",video_link:"",course_image:null,tags:"",category:"",published:!1,published_on:"",featured:!1,upcoming:!1,disable_self_learning:!1,enable_certification:!1,paid_course:!1,paid_certificate:!1,course_price:"",currency:"",evaluator:""}),f=I({description:"",keywords:""});ne(()=>{!y.data?.is_moderator&&!y.data?.is_instructor&&C.push({name:"Courses"}),c.courseName!=="new"?$():D("course_form_opened"),window.addEventListener("keydown",M)});const $=()=>{m.reload(),ue("courses",c.courseName,f)},M=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(P(),e.preventDefault())};de(()=>{window.removeEventListener("keydown",M)});const B=V({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Course",image:l.course_image?.file_url||"",instructors:_.value.map(s=>({instructor:s})),related_courses:b.value.map(s=>({course:s})),...e}}}}),K=V({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Course",name:e.course,fieldname:{image:l.course_image?.file_url||"",instructors:_.value.map(s=>({instructor:s})),related_courses:b.value.map(s=>({course:s})),...l}}}}),m=V({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Course",name:c.courseName}},auto:!1,onSuccess(e){Object.keys(e).forEach(o=>{o=="instructors"?(_.value=[],e.instructors.forEach(u=>{_.value.push(u.instructor)})):o=="related_courses"?(b.value=[],e.related_courses.forEach(u=>{b.value.push(u.course)})):Object.hasOwn(l,o)&&(l[o]=e[o])});let s=["published","upcoming","disable_self_learning","paid_course","featured","enable_certification","paid_certificate"];for(let o in s){let u=s[o];l[u]=!!l[u]}e.image&&q.reload({image:e.image}),ee()}}),q=V({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.course_image=e}}),P=()=>{m.data?G():z()},z=()=>{B.submit(l,{onSuccess(e){L("courses",e.name,f),y.data?.is_system_manager&&j("create_first_course",!0,!1,()=>{localStorage.setItem("firstCourse",e.name)}),D("course_created"),h.success(__("Course created successfully")),C.push({name:"CourseForm",params:{courseName:e.name}})},onError(e){h.error(e.messages?.[0]||e)}})},G=()=>{K.submit({course:m.data.name},{onSuccess(){L("courses",c.courseName,f),h.success(__("Course updated successfully"))},onError(e){h.error(e.messages?.[0]||e)}})},X=V({url:"lms.lms.api.delete_course",makeParams(e){return{course:c.courseName}},onSuccess(){h.success(__("Course deleted successfully")),C.push({name:"Courses"})}}),Z=()=>{A({title:__("Delete Course"),message:__("Deleting the course will also delete all its chapters and lessons. Are you sure you want to delete this course?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(e){X.submit(),e()}}]})};ce(()=>c.courseName!=="new",e=>{e&&$()});const H=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return __("Only image file is allowed.")},J=()=>{p.value&&(l.tags=l.tags?`${l.tags}, ${p.value}`:p.value,p.value="")},Q=e=>{l.tags=l.tags?.split(", ").filter(s=>s!==e).join(", "),p.value=""},W=e=>{l.course_image=e},Y=()=>{l.course_image=null},ee=()=>{let e=!1;y.data?.is_moderator||(_.value.forEach(s=>{!e&&s==y.data?.name&&(e=!0)}),e||C.push({name:"Courses"}))},se=me(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return m.data&&e.push({label:l.title,route:{name:"CourseDetail",params:{courseName:c.courseName}}}),e.push({label:c.courseName=="new"?"New Course":"Edit Course",route:{name:"CourseForm",params:{courseName:c.courseName}}}),e});return pe(()=>({title:m.data?.title||__("New Course"),icon:T.favicon})),(e,s)=>(d(),x("div",we,[a("div",xe,[a("div",null,[a("header",Ue,[r(t(he),{class:"h-7",items:se.value},null,8,["items"]),a("div",Ne,[t(m).data?.name?(d(),g(t(U),{key:0,onClick:s[0]||(s[0]=o=>Z())},{icon:k(()=>[r(t(_e),{class:"w-4 h-4 stroke-1.5"})]),_:1})):v("",!0),r(t(U),{variant:"solid",onClick:s[1]||(s[1]=o=>P()),class:"ml-2"},{default:k(()=>[a("span",null,n(e.__("Save")),1)]),_:1})])]),a("div",Se,[a("div",Ee,[a("div",$e,n(e.__("Details")),1),a("div",Me,[r(t(i),{modelValue:l.title,"onUpdate:modelValue":s[2]||(s[2]=o=>l.title=o),label:e.__("Title"),required:!0},null,8,["modelValue","label"]),r(E,{doctype:"LMS Category",modelValue:l.category,"onUpdate:modelValue":s[3]||(s[3]=o=>l.category=o),label:e.__("Category"),onCreate:(o,u)=>t(S)("Categories",u)},null,8,["modelValue","label","onCreate"])]),a("div",Pe,[r(F,{modelValue:_.value,"onUpdate:modelValue":s[4]||(s[4]=o=>_.value=o),doctype:"User",label:e.__("Instructors"),filters:{ignore_user_type:1},onCreate:o=>t(S)("Members",o),required:!0},null,8,["modelValue","label","onCreate"]),a("div",null,[a("div",Ie,n(e.__("Tags")),1),a("div",De,[l.tags?(d(!0),x(fe,{key:0},be(l.tags?.split(", "),o=>(d(),x("div",Le,[w(n(o)+" ",1),r(t(ge),{class:"stroke-1.5 w-3 h-3 ml-2 cursor-pointer",onClick:u=>Q(o)},null,8,["onClick"])]))),256)):v("",!0),r(t(i),{modelValue:p.value,"onUpdate:modelValue":s[5]||(s[5]=o=>p.value=o),placeholder:e.__("Add a keyword and then press enter"),class:"w-full",onKeyup:s[6]||(s[6]=ve(o=>J(),["enter"])),id:"tags"},null,8,["modelValue","placeholder"])])])]),a("div",Fe,[r(t(i),{modelValue:l.short_introduction,"onUpdate:modelValue":s[7]||(s[7]=o=>l.short_introduction=o),type:"textarea",rows:5,label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card"),required:!0},null,8,["modelValue","label","placeholder"]),a("div",Oe,[a("div",Te,[w(n(e.__("Course Image"))+" ",1),s[26]||(s[26]=a("span",{class:"text-ink-red-3"},"*",-1))]),l.course_image?(d(),x("div",Ke,[a("div",qe,[a("img",{src:l.course_image.file_url,class:"border rounded-md w-40"},null,8,ze),a("div",Ge,[r(t(U),{onClick:s[9]||(s[9]=o=>Y())},{default:k(()=>[w(n(e.__("Remove")),1)]),_:1}),a("div",Xe,n(e.__("Appears on the course card in the course list")),1)])])])):(d(),g(t(Ce),{key:0,fileTypes:["image/*"],validateFile:H,onSuccess:s[8]||(s[8]=o=>W(o))},{default:k(({file:o,progress:u,uploading:cs,openFileSelector:oe})=>[a("div",Re,[a("div",je,[r(t(ye),{class:"size-5 stroke-1 text-ink-gray-7"})]),a("div",Ae,[r(t(U),{onClick:oe},{default:k(()=>[w(n(e.__("Upload")),1)]),_:2},1032,["onClick"]),a("div",Be,n(e.__("Appears on the course card in the course list")),1)])])]),_:1}))])])]),a("div",Ze,[a("div",He,n(e.__("Settings")),1),a("div",Je,[a("div",Qe,[r(t(i),{type:"checkbox",modelValue:l.published,"onUpdate:modelValue":s[10]||(s[10]=o=>l.published=o),label:e.__("Published")},null,8,["modelValue","label"]),r(t(i),{modelValue:l.published_on,"onUpdate:modelValue":s[11]||(s[11]=o=>l.published_on=o),label:e.__("Published On"),type:"date"},null,8,["modelValue","label"])]),a("div",We,[r(t(i),{type:"checkbox",modelValue:l.upcoming,"onUpdate:modelValue":s[12]||(s[12]=o=>l.upcoming=o),label:e.__("Upcoming")},null,8,["modelValue","label"]),r(t(i),{type:"checkbox",modelValue:l.featured,"onUpdate:modelValue":s[13]||(s[13]=o=>l.featured=o),label:e.__("Featured")},null,8,["modelValue","label"]),r(t(i),{type:"checkbox",modelValue:l.disable_self_learning,"onUpdate:modelValue":s[14]||(s[14]=o=>l.disable_self_learning=o),label:e.__("Disable Self Enrollment")},null,8,["modelValue","label"])])])]),a("div",Ye,[a("div",es,[a("div",ss,[w(n(e.__("Course Description"))+" ",1),s[27]||(s[27]=a("span",{class:"text-ink-red-3"},"*",-1))]),r(t(Ve),{content:l.description,onChange:s[15]||(s[15]=o=>l.description=o),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r(t(i),{modelValue:l.video_link,"onUpdate:modelValue":s[16]||(s[16]=o=>l.video_link=o),label:e.__("Preview Video"),placeholder:e.__("Paste the youtube link of a short video introducing the course")},null,8,["modelValue","label","placeholder"]),r(F,{modelValue:b.value,"onUpdate:modelValue":s[17]||(s[17]=o=>b.value=o),doctype:"LMS Course",label:e.__("Related Courses"),filters:{name:["!=",t(m).data?.name]},onCreate:o=>{t(C).push({name:"CourseForm",params:{courseName:"new"}})}},null,8,["modelValue","label","filters","onCreate"])]),a("div",os,[a("div",ls,n(e.__("Pricing and Certification")),1),a("div",as,[r(t(i),{type:"checkbox",modelValue:l.paid_course,"onUpdate:modelValue":s[18]||(s[18]=o=>l.paid_course=o),label:e.__("Paid Course")},null,8,["modelValue","label"]),r(t(i),{type:"checkbox",modelValue:l.enable_certification,"onUpdate:modelValue":s[19]||(s[19]=o=>l.enable_certification=o),label:e.__("Completion Certificate")},null,8,["modelValue","label"]),r(t(i),{type:"checkbox",modelValue:l.paid_certificate,"onUpdate:modelValue":s[20]||(s[20]=o=>l.paid_certificate=o),label:e.__("Paid Certificate")},null,8,["modelValue","label"])]),a("div",ts,[a("div",rs,[l.paid_course||l.paid_certificate?(d(),g(t(i),{key:0,modelValue:l.course_price,"onUpdate:modelValue":s[21]||(s[21]=o=>l.course_price=o),label:e.__("Amount")},null,8,["modelValue","label"])):v("",!0),l.paid_certificate?(d(),g(E,{key:1,doctype:"Course Evaluator",modelValue:l.evaluator,"onUpdate:modelValue":s[22]||(s[22]=o=>l.evaluator=o),label:e.__("Evaluator"),onCreate:(o,u)=>t(S)("Evaluators",u)},null,8,["modelValue","label","onCreate"])):v("",!0)]),l.paid_course||l.paid_certificate?(d(),g(E,{key:0,doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":s[23]||(s[23]=o=>l.currency=o),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])):v("",!0)])]),a("div",is,[a("div",ns,n(e.__("Meta Tags")),1),a("div",us,[r(t(i),{modelValue:f.description,"onUpdate:modelValue":s[24]||(s[24]=o=>f.description=o),label:e.__("Meta Description"),type:"textarea",rows:7},null,8,["modelValue","label"]),r(t(i),{modelValue:f.keywords,"onUpdate:modelValue":s[25]||(s[25]=o=>f.keywords=o),label:e.__("Meta Keywords"),type:"textarea",rows:7,placeholder:e.__("Comma separated keywords for SEO")},null,8,["modelValue","label","placeholder"])])])])]),a("div",ds,[t(m).data?(d(),g(ke,{key:0,courseName:t(m).data.name,title:e.__("Course Outline"),allowEdit:!0},null,8,["courseName","title"])):v("",!0)])])]))}};export{gs as default};
//# sourceMappingURL=CourseForm-kXed0kdX.js.map
