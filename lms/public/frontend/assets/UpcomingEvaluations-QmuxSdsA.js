import{J as B,i as g,K as Y,L as U,A as E,w as j,j as V,f as r,n as c,g as o,e as d,k as b,h as n,t as i,l as t,v as N,q as A,F as D,x as P,C as T,a7 as S,M as z,H as I,r as L,aB as R,b as q,p as w,_ as $,bb as F,bc as G,bd as H,ax as J,a6 as K,G as O,be as Q,N as W,a as X}from"./index-BIerRe8o.js";import{MenuButton as Z,MenuItems as ee,MenuItem as te,Menu as ae}from"@headlessui/vue";import"@vueuse/core";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";const se={class:"flex flex-col gap-4"},oe={class:"mb-1.5 text-sm text-ink-gray-5"},le={class:"mb-1.5 text-sm text-ink-gray-5"},ne={key:0},ie={class:"mb-1.5 text-sm text-ink-gray-5"},re={class:"grid grid-cols-2 gap-2"},ce=["onClick"],de={key:1,class:"text-sm italic text-ink-red-4"},ue={__name:"EvaluationModal",props:B({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(_){const h=g("$user"),u=g("$dayjs"),v=Y(_,"modelValue"),y=Y(_,"reloadEvals"),f=_,a=U({course:"",date:"",start_time:"",end_time:"",day:"",batch:f.batch,member:h.data.name}),m=E({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Certificate Request",batch_name:e.batch,...e}}}});function k(e){m.submit(a,{validate(){if(!a.course)return"Please select a course.";if(!a.date)return"Please select a date.";if(!a.start_time)return"Please select a slot.";if(u(a.date).isBefore(u(),"day"))return"Please select a future date.";if(u(a.date).isAfter(u(f.endDate),"day"))return`Please select a date before the end date ${u(f.endDate).format("DD MMMM YYYY")}.`},onSuccess(){y.value.reload(),e()},onError(l){I.warning(__(l.messages?.[0]||l))}})}const x=()=>{const e=[];for(const l of f.courses)l.evaluator&&e.push({label:l.title,value:l.course});return e.length===1&&(a.course=e[0].value),e},p=E({url:"lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(e){return{course:e.course,date:e.date,batch:f.batch}}});j(()=>a.date,e=>{a.start_time="",e&&a.course&&p.submit(a)}),j(()=>a.course,e=>{a.date="",a.start_time="",p.reset()});const C=e=>{a.start_time=e.start_time,a.end_time=e.end_time,a.day=e.day};return(e,l)=>(r(),V(t(z),{modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=s=>v.value=s),options:{title:e.__("Schedule Evaluation"),size:"xl",actions:[{label:e.__("Submit"),variant:"solid",onClick:s=>k(s)}]}},{"body-content":c(()=>[o("div",se,[o("div",null,[o("div",oe,i(e.__("Course")),1),n(t(N),{modelValue:a.course,"onUpdate:modelValue":l[0]||(l[0]=s=>a.course=s),options:x()},null,8,["modelValue","options"])]),o("div",null,[o("div",le,i(e.__("Date")),1),n(t(A),{type:"date",modelValue:a.date,"onUpdate:modelValue":l[1]||(l[1]=s=>a.date=s),min:t(u)().add(t(u).duration({days:1})).format("YYYY-MM-DD")},null,8,["modelValue","min"])]),t(p).data?.length?(r(),d("div",ne,[o("div",ie,i(e.__("Select a slot")),1),o("div",re,[(r(!0),d(D,null,P(t(p).data,s=>(r(),d("div",null,[o("div",{class:T(["text-base text-center border rounded-md text-ink-gray-8 bg-surface-gray-3 p-2 cursor-pointer",{"border-outline-gray-4":a.start_time==s.start_time}]),onClick:M=>C(s)},i(t(S)(s.start_time))+" - "+i(t(S)(s.end_time)),11,ce)]))),256))])])):a.course&&a.date?(r(),d("div",de,i(e.__("No slots available for this date.")),1)):b("",!0)])]),_:1},8,["modelValue","options"]))}},me={class:"flex items-center justify-between mb-4"},_e={class:"text-lg text-ink-gray-9 font-semibold"},fe={key:0},ve={class:"grid grid-cols-3 gap-4"},pe={class:"border text-ink-gray-7 rounded-md p-3"},he={class:"flex justify-between mb-3"},be={class:"font-semibold text-ink-gray-9 leading-5"},ge={class:"flex items-center mb-2"},ye={class:"ml-2"},ke={class:"flex items-center mb-2"},xe={class:"ml-2"},Ce={class:"flex items-center"},Me={class:"ml-2"},we={key:0,class:"flex items-center justify-between space-x-2 mt-4"},$e={key:1,class:"text-sm italic text-ink-gray-5"},Re={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null}},setup(_){const h=g("$dayjs"),u=g("$user"),v=L(!1),y=R(),{$dialog:f}=y.appContext.config.globalProperties,a=_,m=E({url:"lms.lms.utils.get_upcoming_evals",params:{student:u.data.name,courses:a.courses.map(e=>e.course),batch:a.batch},auto:!0});function k(){v.value=!0}const x=e=>{window.open(e.google_meet_link,"_blank")},p=q(()=>a.courses.filter(e=>e.evaluator!="")),C=e=>{f({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(l){X("lms.lms.api.cancel_evaluation",{evaluation:e}).then(()=>{m.reload()}),l()}}]})};return(e,l)=>(r(),d(D,null,[o("div",null,[o("div",me,[o("div",_e,i(e.__("Upcoming Evaluations")),1),t(m).data?.length!=p.value.length?(r(),V(t($),{key:0,onClick:k},{default:c(()=>[w(i(e.__("Schedule Evaluation")),1)]),_:1})):b("",!0)]),t(m).data?.length?(r(),d("div",fe,[o("div",ve,[(r(!0),d(D,null,P(t(m).data,s=>(r(),d("div",null,[o("div",pe,[o("div",he,[o("span",be,i(s.course_title),1),s.date>t(h)().format()?(r(),V(t(ae),{key:0,as:"div",class:"relative inline-block text-left"},{default:c(()=>[o("div",null,[n(t(Z),{class:"inline-flex w-full justify-center"},{default:c(()=>[n(t(F),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),n(G,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:c(()=>[n(t(ee),{class:"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5"},{default:c(()=>[n(t(te),null,{default:c(({active:M})=>[n(t($),{variant:"ghost",class:"w-full",onClick:Ee=>C(s)},{prefix:c(()=>[n(t(H),{active:M,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:c(()=>[w(" "+i(e.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):b("",!0)]),o("div",ge,[n(t(J),{class:"w-4 h-4 stroke-1.5"}),o("span",ye,i(t(h)(s.date).format("DD MMMM YYYY")),1)]),o("div",ke,[n(t(K),{class:"w-4 h-4 stroke-1.5"}),o("span",xe,i(t(S)(s.start_time)),1)]),o("div",Ce,[n(t(O),{class:"w-4 h-4 stroke-1.5"}),o("span",Me,i(s.evaluator_name),1)]),s.google_meet_link?(r(),d("div",we,[n(t($),{onClick:M=>x(s),class:"w-full"},{prefix:c(()=>[n(t(Q),{class:"w-4 h-4 stroke-1.5"})]),default:c(()=>[w(" "+i(e.__("Join Call")),1)]),_:2},1032,["onClick"])])):b("",!0)])]))),256))])])):(r(),d("div",$e,i(e.__("Please schedule an evaluation to get certified.")),1))]),n(ue,{batch:_.batch,endDate:_.endDate,courses:_.courses,modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=s=>v.value=s),reloadEvals:t(m),"onUpdate:reloadEvals":l[1]||(l[1]=s=>W(m)?m.value=s:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64))}};export{Re as _};
//# sourceMappingURL=UpcomingEvaluations-QmuxSdsA.js.map
