{"version":3,"file":"MultiSelect-BOBHoIh6.js","sources":["../../../../frontend-monorepo/website/src/components/Controls/MultiSelect.vue"],"sourcesContent":["<template>\n\t<div>\n\t\t<label class=\"block mb-1\" :class=\"labelClasses\" v-if=\"label\">\n\t\t\t{{ label }}\n\t\t\t<span class=\"text-ink-red-3\" v-if=\"required\">*</span>\n\t\t</label>\n\t\t<div class=\"w-full\">\n\t\t\t<Combobox v-model=\"selectedValue\" nullable>\n\t\t\t\t<Popover class=\"w-full\" v-model:show=\"showOptions\">\n\t\t\t\t\t<template #target=\"{ togglePopover }\">\n\t\t\t\t\t\t<ComboboxInput\n\t\t\t\t\t\t\tref=\"search\"\n\t\t\t\t\t\t\tclass=\"search-input form-input w-full focus-visible:!ring-0\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t:value=\"query\"\n\t\t\t\t\t\t\t@change=\"\n\t\t\t\t\t\t\t\t(e) => {\n\t\t\t\t\t\t\t\t\tquery = e.target.value\n\t\t\t\t\t\t\t\t\tshowOptions = true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\t\t\t@focus=\"() => togglePopover()\"\n\t\t\t\t\t\t\t@keydown.delete.capture.stop=\"removeLastValue\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #body=\"{ isOpen, close }\">\n\t\t\t\t\t\t<div v-show=\"isOpen\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"mt-1 rounded-lg bg-surface-white py-1 text-base border-2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ComboboxOptions\n\t\t\t\t\t\t\t\t\tclass=\"my-1 min-h-[6rem] max-h-[12rem] overflow-y-auto px-1.5\"\n\t\t\t\t\t\t\t\t\tstatic\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ComboboxOption\n\t\t\t\t\t\t\t\t\t\tv-for=\"option in options\"\n\t\t\t\t\t\t\t\t\t\t:key=\"option.value\"\n\t\t\t\t\t\t\t\t\t\t:value=\"option\"\n\t\t\t\t\t\t\t\t\t\tv-slot=\"{ active }\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\t\t\t:class=\"[\n\t\t\t\t\t\t\t\t\t\t\t\t'flex cursor-pointer items-center rounded px-2 py-1 text-base',\n\t\t\t\t\t\t\t\t\t\t\t\t{ 'bg-surface-gray-2': active },\n\t\t\t\t\t\t\t\t\t\t\t]\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex flex-col gap-1 p-1\">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-base font-medium text-ink-gray-8\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{ option.description }}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"text-sm text-ink-gray-5\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{{ option.value }}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t</ComboboxOption>\n\t\t\t\t\t\t\t\t\t<div class=\"h-10\"></div>\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tv-if=\"attrs.onCreate\"\n\t\t\t\t\t\t\t\t\t\tclass=\"absolute bottom-2 left-1 w-[99%] pt-2 bg-white border-t\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full !justify-start\"\n\t\t\t\t\t\t\t\t\t\t\t:label=\"__('Create New')\"\n\t\t\t\t\t\t\t\t\t\t\t@click=\"attrs.onCreate(close)\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t\t\t\t\t<Plus class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</ComboboxOptions>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</Popover>\n\t\t\t</Combobox>\n\t\t</div>\n\t\t<div v-if=\"values.length\" class=\"grid grid-cols-2 gap-2 mt-1\">\n\t\t\t<div\n\t\t\t\tv-for=\"value in values\"\n\t\t\t\tclass=\"flex items-center justify-between break-all bg-surface-gray-2 text-ink-gray-7 word-wrap p-2 rounded-md mr-2\"\n\t\t\t>\n\t\t\t\t<span class=\"break-all\">\n\t\t\t\t\t{{ value }}\n\t\t\t\t</span>\n\t\t\t\t<X\n\t\t\t\t\tclass=\"size-4 stroke-1.5 cursor-pointer\"\n\t\t\t\t\t@click=\"removeValue(value)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t\t<!-- <ErrorMessage class=\"mt-2 pl-2\" v-if=\"error\" :message=\"error\" /> -->\n\t</div>\n</template>\n\n<script setup>\nimport {\n\tCombobox,\n\tComboboxInput,\n\tComboboxOptions,\n\tComboboxOption,\n} from '@headlessui/vue'\nimport { createResource, Popover, Button } from '@mono/mono-frappe-ui'\nimport { ref, computed, nextTick, useAttrs } from 'vue'\nimport { watchDebounced } from '@vueuse/core'\nimport { X, Plus } from 'lucide-vue-next'\n\nconst props = defineProps({\n\tlabel: {\n\t\ttype: String,\n\t},\n\tsize: {\n\t\ttype: String,\n\t\tdefault: 'sm',\n\t},\n\tdoctype: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tfilters: {\n\t\ttype: Object,\n\t\tdefault: () => ({}),\n\t},\n\tvalidate: {\n\t\ttype: Function,\n\t\tdefault: null,\n\t},\n\terrorMessage: {\n\t\ttype: Function,\n\t\tdefault: (value) => `${value} is an Invalid value`,\n\t},\n\trequired: {\n\t\ttype: Boolean,\n\t},\n})\n\nconst values = defineModel()\nconst attrs = useAttrs()\nconst emails = ref([])\nconst search = ref(null)\nconst error = ref(null)\nconst query = ref('')\nconst text = ref('')\nconst showOptions = ref(false)\n\nconst selectedValue = computed({\n\tget: () => query.value || '',\n\tset: (val) => {\n\t\tquery.value = ''\n\t\tif (val) {\n\t\t\tshowOptions.value = false\n\t\t}\n\t\tval?.value && addValue(val.value)\n\t},\n})\n\nwatchDebounced(\n\tquery,\n\t(val) => {\n\t\tval = val || ''\n\t\tif (text.value === val) return\n\t\ttext.value = val\n\t\treload(val)\n\t},\n\t{ debounce: 300, immediate: true }\n)\n\nconst filterOptions = createResource({\n\turl: 'frappe.desk.search.search_link',\n\tmethod: 'POST',\n\tcache: [text.value, props.doctype],\n\tauto: true,\n\tparams: {\n\t\ttxt: text.value,\n\t\tdoctype: props.doctype,\n\t},\n})\n\nconst options = computed(() => {\n\treturn filterOptions.data || []\n})\n\nfunction reload(val) {\n\tfilterOptions.update({\n\t\tparams: {\n\t\t\ttxt: val,\n\t\t\tdoctype: props.doctype,\n\t\t},\n\t})\n\tfilterOptions.reload()\n}\n\nconst addValue = (value) => {\n\terror.value = null\n\tif (value) {\n\t\tconst splitValues = value.split(',')\n\t\tsplitValues.forEach((value) => {\n\t\t\tvalue = value.trim()\n\t\t\tif (value) {\n\t\t\t\t// check if value is not already in the values array\n\t\t\t\tif (!values.value?.includes(value)) {\n\t\t\t\t\t// check if value is valid\n\t\t\t\t\tif (value && props.validate && !props.validate(value)) {\n\t\t\t\t\t\terror.value = props.errorMessage(value)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t// add value to values array\n\t\t\t\t\tif (!values.value) {\n\t\t\t\t\t\tvalues.value = [value]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalues.value.push(value)\n\t\t\t\t\t}\n\t\t\t\t\tvalue = value.replace(value, '')\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t!error.value && (value = '')\n\t}\n}\n\nconst removeValue = (value) => {\n\tvalues.value = values.value.filter((v) => v !== value)\n}\n\nconst removeLastValue = () => {\n\tif (query.value) return\n\n\tlet emailRef = emails.value[emails.value.length - 1]?.$el\n\tif (document.activeElement === emailRef) {\n\t\tvalues.value.pop()\n\t\tnextTick(() => {\n\t\t\tif (values.value.length) {\n\t\t\t\temailRef = emails.value[emails.value.length - 1].$el\n\t\t\t\temailRef?.focus()\n\t\t\t} else {\n\t\t\t\tsetFocus()\n\t\t\t}\n\t\t})\n\t} else {\n\t\temailRef?.focus()\n\t}\n}\n\nfunction setFocus() {\n\tsearch.value.$el.focus()\n}\n\ndefineExpose({ setFocus })\n\nconst labelClasses = computed(() => {\n\treturn [\n\t\t{\n\t\t\tsm: 'text-xs',\n\t\t\tmd: 'text-base',\n\t\t}[props.size || 'sm'],\n\t\t'text-ink-gray-5',\n\t]\n})\n</script>\n"],"names":["props","__props","values","_useModel","attrs","useAttrs","emails","ref","search","error","query","text","showOptions","selectedValue","computed","val","addValue","watchDebounced","reload","filterOptions","createResource","options","value","removeValue","v","removeLastValue","emailRef","nextTick","setFocus","__expose","labelClasses","_createElementBlock","_normalizeClass","_createTextVNode","_toDisplayString","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_unref","Combobox","$event","Popover","_withCtx","togglePopover","ComboboxInput","_cache","e","isOpen","close","_hoisted_3","ComboboxOptions","_Fragment","_renderList","option","_createBlock","ComboboxOption","active","_hoisted_4","_hoisted_5","_hoisted_6","_openBlock","_hoisted_7","Button","__","Plus","_hoisted_8","_hoisted_9","_hoisted_10","X"],"mappings":"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"}