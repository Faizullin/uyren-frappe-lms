import{i as de,g as I,T as E,I as $,q as ue,aK as ce,A,c as o,h as c,s as t,o as n,d as l,t as i,b as q,B as _,w as g,D as b,e as J,F as L,f as P,k as me,dd as U,de as F,df as K,br as _e,E as pe,J as X,aL as he,at as fe,N as G,l as ge}from"./index-CgbsATbs.js";import{_ as ye}from"./ProgressBar-DXZfku_t.js";const ve={key:0},ke={class:"bg-surface-blue-2 space-y-1 py-2 px-2 mb-4 rounded-md text-sm text-ink-blue-3 leading-5"},be={key:0},we={class:"leading-5"},qe={key:1,class:"leading-5"},xe={key:2,class:"leading-5"},Se={key:3,class:"leading-relaxed"},ze={key:4,class:"leading-5"},Ce={key:0,class:"flex flex-col space-x-1 my-4"},$e={class:"mb-2"},Te={class:""},Ie={class:"font-semibold"},Me={key:1},Ve={class:"border text-center p-20 rounded-md"},Qe={class:"font-semibold text-lg text-ink-gray-9"},Ne={class:"flex items-center justify-center space-x-2 mt-4"},Ee={key:0,class:"leading-5 text-ink-gray-7"},Ae={key:2},Le={key:0,class:"border rounded-md p-5"},Pe={class:"flex justify-between"},Oe={class:"text-sm text-ink-gray-5"},Be={class:"mr-2"},De={class:"text-ink-gray-9 text-sm font-semibold item-left"},je=["innerHTML"],Ye={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Re=["name","onChange"],He=["name","onChange"],Je={key:0},Ue=["innerHTML"],Fe={key:1},Ke={key:0},Xe={key:2},Ge={class:"flex items-center justify-between mt-4"},We={class:"text-sm text-ink-gray-5"},Ze={key:3,class:"border rounded-md p-20 text-center space-y-2"},et={class:"text-lg font-semibold text-ink-gray-9"},tt={key:0,class:"leading-5 text-ink-gray-7"},st={key:1},at={class:"space-x-2"},nt={key:4,class:"mt-10"},lt={__name:"Quiz",props:{quizName:{type:String,required:!0},inVideo:{type:Boolean,default:!1},backToVideo:{type:Function,default:()=>{}}},setup(x){const W=de("$user"),p=I(0),T=I(""),h=E([0,0,0,0]),m=E([]);let y=E([]);const w=I(null),S=I(0);let M=null;const z=x,s=$({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Quiz",name:z.quizName}},cache:["quiz",z.quizName],auto:!0,transform(e){e.duration=parseInt(e.duration)},onSuccess(e){V(),O()}}),V=()=>{let e=s.data;e.shuffle_questions?(y=se(e.questions),e.limit_questions_to&&(y=y.slice(0,e.limit_questions_to))):y=e.questions},O=()=>{s.data.duration&&(S.value=s.data.duration*60)},Z=()=>{M=setInterval(()=>{S.value--,S.value==0&&(clearInterval(M),Y())},1e3)},ee=e=>{const a=Math.floor(e/3600).toString().padStart(2,"0"),u=Math.floor(e%3600/60).toString().padStart(2,"0"),f=(e%60).toString().padStart(2,"0");return a!="00"?`${a}:${u}:${f}`:`${u}:${f}`},te=ue(()=>S.value/(s.data.duration*60)*100),se=e=>{for(let a=e.length-1;a>0;a--){const u=Math.floor(Math.random()*(a+1));[e[a],e[u]]=[e[u],e[a]]}return e},v=$({url:"frappe.client.get_list",makeParams(e){return{doctype:"LMS Quiz Submission",filters:{member:W.data?.name,quiz:s.data?.name},fields:["name","creation","score","score_out_of","percentage","passing_percentage"],order_by:"creation desc"}},transform(e){e.forEach((a,u)=>{a.creation=ce(a.creation),a.idx=u+1})}});A(()=>s.data,()=>{s.data&&V(),s.data&&s.data.max_attempts&&(v.reload(),H())});const k=$({url:"lms.lms.doctype.lms_quiz.lms_quiz.quiz_summary",makeParams(e){return{quiz:s.data.name,results:localStorage.getItem(s.data.title)}}}),r=$({url:"lms.lms.utils.get_question_details",makeParams(e){return{question:T.value}}});A(p,e=>{e>0&&(T.value=s.data.questions[e-1].question,r.reload())}),A(()=>z.quizName,e=>{e&&s.reload()});const ae=()=>{p.value=1,localStorage.removeItem(s.data.title),s.data.duration&&Z()},B=e=>{r.data.multiple||h.splice(0,h.length,0,0,0,0),h[e-1]=h[e-1]?0:1},D=()=>{let e=[];return r.data.type=="Choices"?h.forEach((u,f)=>{h[f]&&e.push(r.data[`option_${f+1}`])}):e.push(w.value),e},Q=()=>{let e=D();if(!e.length){G.warning(__("Please select an option"));return}$({url:"lms.lms.doctype.lms_quiz.lms_quiz.check_answer",params:{question:T.value,type:r.data.type,answers:JSON.stringify(e)},auto:!0,onSuccess(a){r.data.type=="Choices"?h.forEach((f,d)=>{f?m[d]=f&&a[d]:a[d]==2?m[d]=2:m[d]=void 0}):m.push(a),N(),s.data.show_answers||j()}})},N=()=>{let e=JSON.parse(localStorage.getItem(s.data.title)),a={question_name:T.value,answer:D().join(),is_correct:m.filter(u=>u!=null)};e?e.push(a):e=[a],localStorage.setItem(s.data.title,JSON.stringify(e))},ne=()=>{!s.data.show_answers&&r.data?.type!="Open Ended"?Q():(r.data?.type=="Open Ended"&&N(),j())},j=()=>{p.value!=s.data.questions.length&&(p.value=p.value+1,h.splice(0,h.length,0,0,0,0),m.length=0,w.value=null)},Y=()=>{if(!s.data.show_answers){r.data.type=="Open Ended"?N():Q(),setTimeout(()=>{R()},500);return}R()},R=()=>{k.submit({},{onSuccess(e){ie(),s.data&&s.data.max_attempts&&v.reload(),s.data.duration&&clearInterval(M)},onError(e){if((e?.message||"").includes("MaximumAttemptsExceededError")){const u=e.messages?.[0]||e;G.error(__(u)),setTimeout(()=>{window.location.reload()},3e3)}}})},H=()=>{p.value=0,h.splice(0,h.length,0,0,0,0),m.length=0,k.reset(),V(),O()},oe=e=>e.type=="Choices"?e.multiple?__("Choose all answers that apply"):__("Choose one answer"):__("Type your answer"),ie=()=>{let e=window.location.pathname.split("/");if(e[2]!="courses")return;let a=e.pop().split("-");a.length==2&&ge("lms.lms.api.mark_lesson_progress",{course:e[3],chapter_number:a[0],lesson_number:a[1]})},le=()=>[{label:"No.",key:"idx"},{label:"Date",key:"creation"},{label:"Score",key:"score",align:"center"},{label:"Score out of",key:"score_out_of",align:"center"},{label:"Percentage",key:"percentage",align:"center"}];return(e,a)=>t(s).data?(n(),o("div",ve,[l("div",ke,[x.inVideo?(n(),o("div",be,i(e.__("You will have to complete the quiz to continue the video")),1)):c("",!0),l("div",we,i(e.__("This quiz consists of {0} questions.").format(t(y).length)),1),t(s).data?.duration?(n(),o("div",qe,i(e.__("Please ensure that you complete all the questions in {0} minutes.").format(t(s).data.duration)),1)):c("",!0),t(s).data?.duration?(n(),o("div",xe,i(e.__("If you fail to do so, the quiz will be automatically submitted when the timer ends.")),1)):c("",!0),t(s).data.passing_percentage?(n(),o("div",Se,i(e.__("You will have to get {0}% correct answers in order to pass the quiz.").format(t(s).data.passing_percentage)),1)):c("",!0),t(s).data.max_attempts?(n(),o("div",ze,i(e.__("You can attempt this quiz {0}.").format(t(s).data.max_attempts==1?"1 time":`${t(s).data.max_attempts} times`)),1)):c("",!0)]),t(s).data.duration?(n(),o("div",Ce,[l("div",$e,[l("span",Te,i(e.__("Time"))+": ",1),l("span",Ie,i(ee(S.value)),1)]),q(ye,{progress:te.value},null,8,["progress"])])):c("",!0),p.value==0?(n(),o("div",Me,[l("div",Ve,[l("div",Qe,i(t(s).data.title),1),l("div",Ne,[!t(s).data.max_attempts||t(v).data?.length<t(s).data.max_attempts?(n(),_(t(b),{key:0,variant:"solid",onClick:ae},{default:g(()=>[l("span",null,i(x.inVideo?e.__("Start the Quiz"):e.__("Start")),1)]),_:1})):c("",!0),x.inVideo?(n(),_(t(b),{key:1,onClick:a[0]||(a[0]=u=>z.backToVideo())},{default:g(()=>[J(i(e.__("Resume Video")),1)]),_:1})):c("",!0)]),t(s).data.max_attempts&&t(v).data?.length>=t(s).data.max_attempts?(n(),o("div",Ee,i(e.__("You have already exceeded the maximum number of attempts allowed for this quiz.")),1)):c("",!0)])])):t(k).data?(n(),o("div",Ze,[l("div",et,i(e.__("Quiz Summary")),1),t(k).data.is_open_ended?(n(),o("div",tt,i(e.__("Your submission has been successfully saved. The instructor will review and grade it shortly, and you'll be notified of your final result.")),1)):(n(),o("div",st,i(e.__("You got {0}% correct answers with a score of {1} out of {2}").format(Math.ceil(t(k).data.percentage),t(k).data.score,t(k).data.score_out_of)),1)),l("div",at,[!t(s).data.max_attempts||t(v)?.data.length<t(s).data.max_attempts?(n(),_(t(b),{key:0,onClick:a[6]||(a[6]=u=>H()),class:"mt-2"},{default:g(()=>[l("span",null,i(e.__("Try Again")),1)]),_:1})):c("",!0),x.inVideo?(n(),_(t(b),{key:1,onClick:a[7]||(a[7]=u=>z.backToVideo())},{default:g(()=>[J(i(e.__("Resume Video")),1)]),_:1})):c("",!0)])])):(n(),o("div",Ae,[(n(!0),o(L,null,P(t(y),(u,f)=>(n(),o("div",null,[f==p.value-1&&t(r).data?(n(),o("div",Le,[l("div",Pe,[l("div",Oe,[l("span",Be,i(e.__("Question {0}").format(p.value))+": ",1),l("span",null,i(oe(t(r).data)),1)]),l("div",De,i(u.marks)+" "+i(u.marks==1?e.__("Mark"):e.__("Marks")),1)]),l("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:t(r).data.question},null,8,je),t(r).data.type=="Choices"?(n(),o(L,{key:0},P(4,d=>l("div",null,[t(r).data[`option_${d}`]?(n(),o("label",Ye,[!m.length&&!t(r).data.multiple?(n(),o("input",{key:0,type:"radio",name:encodeURIComponent(t(r).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:C=>B(d)},null,40,Re)):!m.length&&t(r).data.multiple?(n(),o("input",{key:1,type:"checkbox",name:encodeURIComponent(t(r).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:C=>B(d)},null,40,He)):t(s).data.show_answers?(n(!0),o(L,{key:2},P(m,(C,re)=>(n(),o("div",null,[d-1==re?(n(),o("div",Je,[C==1?(n(),_(t(U),{key:0,class:"w-4 h-4 text-ink-green-2"})):C==2?(n(),_(t(F),{key:1,class:"w-4 h-4 text-ink-green-2"})):C==0?(n(),_(t(K),{key:2,class:"w-4 h-4 text-ink-red-3"})):(n(),_(t(F),{key:3,class:"w-4 h-4"}))])):c("",!0)]))),256)):c("",!0),l("span",{class:"ml-2",innerHTML:t(r).data[`option_${d}`]},null,8,Ue)])):c("",!0),t(r).data[`explanation_${d}`]?me((n(),o("div",{key:1,class:"mt-2 text-xs"},i(t(r).data[`explanation_${d}`]),513)),[[_e,m.length]]):c("",!0)])),64)):t(r).data.type=="User Input"?(n(),o("div",Fe,[q(t(pe),{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=d=>w.value=d),type:"textarea",disabled:!!m.length,class:"my-2"},null,8,["modelValue","disabled"]),m.length?(n(),o("div",Ke,[m[0]?(n(),_(t(X),{key:0,label:e.__("Correct"),theme:"green"},{prefix:g(()=>[q(t(U),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1},8,["label"])):(n(),_(t(X),{key:1,theme:"red",label:e.__("Incorrect")},{prefix:g(()=>[q(t(K),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1},8,["label"]))])):c("",!0)])):(n(),o("div",Xe,[q(t(he),{class:"mt-4",content:w.value,onChange:a[2]||(a[2]=d=>w.value=d),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),l("div",Ge,[l("div",We,i(e.__("Question {0} of {1}").format(p.value,t(y).length)),1),t(s).data.show_answers&&!m.length&&t(r).data.type!="Open Ended"?(n(),_(t(b),{key:0,onClick:a[3]||(a[3]=d=>Q())},{default:g(()=>[l("span",null,i(e.__("Check")),1)]),_:1})):p.value!=t(y).length?(n(),_(t(b),{key:1,onClick:a[4]||(a[4]=d=>ne())},{default:g(()=>[l("span",null,i(e.__("Next")),1)]),_:1})):(n(),_(t(b),{key:2,onClick:a[5]||(a[5]=d=>Y())},{default:g(()=>[l("span",null,i(e.__("Submit")),1)]),_:1}))])])):c("",!0)]))),256))])),t(s).data.show_submission_history&&t(v)?.data&&t(v).data.length>0?(n(),o("div",nt,[q(t(fe),{columns:le(),rows:t(v)?.data,"row-key":"name",options:{selectable:!1,showTooltip:!1,emptyState:{title:e.__("No Quiz submissions found")}}},null,8,["columns","rows","options"])])):c("",!0)])):c("",!0)}};export{lt as _};
//# sourceMappingURL=Quiz-Bj0njyf8.js.map
