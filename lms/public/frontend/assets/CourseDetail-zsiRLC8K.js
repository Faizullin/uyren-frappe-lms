import"@headlessui/vue";import{z as G,i as q,b as M,A as x,d as z,e as d,f as r,k as _,g as t,t as n,l as e,j as g,h as i,n as f,_ as k,p as C,B as T,C as L,D as F,U as D,E as H,S as P,G as B,H as R,a as W,I as Y,J,K as V,L as K,q as Q,M as X,w as U,r as Z,F as $,x as N,N as E,s as ee,u as te,O}from"./index-BIerRe8o.js";import{_ as se}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cdx-1Hlv.js";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";import"@vueuse/core";import{_ as ae}from"./CertificationLinks-C-_tkyiZ.js";import{_ as re}from"./CourseOutline-D_ftegVj.js";import{_ as I}from"./UserAvatar-D66_PbG8.js";import{_ as oe}from"./Rating.vue_vue_type_script_setup_true_lang-BUFTgcFs.js";import{_ as ne}from"./CourseInstructors-B6EFgXV2.js";import{_ as ie}from"./CourseCard-Bg4d9c02.js";import"@tiptap/core";import"@tiptap/extension-code-block";import"@tiptap/extension-heading";import"@tiptap/suggestion";import"@tiptap/extension-link";import"./vuedraggable.umd-D2H5jHu-.js";import"./ProgressBar-DT3bUdWT.js";const le={class:"border-2 rounded-md min-w-80"},ue=["src"],ce={class:"p-5"},de={key:0,class:"text-2xl font-semibold mb-3"},me={key:1},_e={key:0,class:"space-y-2"},fe={class:"space-y-4"},pe={class:"flex items-center text-ink-gray-9"},he={class:"ml-2"},ve={class:"flex items-center text-ink-gray-9"},ge={class:"ml-2"},we={key:0,class:"flex items-center text-ink-gray-9"},ye={class:"ml-2"},be={key:1,class:"flex items-center font-semibold text-ink-gray-9"},ke={class:"ml-2"},$e={key:2,class:"flex items-center font-semibold text-ink-gray-9"},xe={class:"ml-2"},j={__name:"CourseCardOverlay",props:{course:{type:Object,default:null}},setup(a){const v=G(),c=q("$user"),s=window.read_only_mode,o=a,p=M(()=>o.course.data.video_link?"https://www.youtube.com/embed/"+o.course.data.video_link:null);function w(){c.data?W("lms.lms.doctype.lms_enrollment.lms_enrollment.create_membership",{course:o.course.data.name}).then(()=>{Y("enrolled_in_course",{course:o.course.data.name}),R.success(__("You have been enrolled in this course")),setTimeout(()=>{v.push({name:"Lesson",params:{courseName:o.course.data.name,chapterNumber:1,lessonNumber:1}})},1e3)}).catch(l=>{R.warning(__(l.messages?.[0]||l)),console.error(l)}):(R.success(__("You need to login first to enroll for this course")),setTimeout(()=>{window.location.href=`/login?redirect-to=${window.location.pathname}`},500))}const y=()=>{let l=!1;return o.course.data.instructors.forEach(b=>{!l&&b.name==c.data?.name&&(l=!0)}),l},m=M(()=>!!(o.course.data?.enable_certification&&o.course.data?.membership?.progress==100)),h=x({url:"lms.lms.doctype.lms_certificate.lms_certificate.create_certificate",makeParams(l){return{course:l.course}},onSuccess(l){window.open(`/api/method/frappe.utils.print_format.download_pdf?doctype=LMS+Certificate&name=${l.name}&format=${encodeURIComponent(l.template)}`,"_blank")}}),u=()=>{h.submit({course:o.course.data?.name,member:c.data?.name})};return(l,b)=>{const S=z("router-link");return r(),d("div",le,[a.course.data.video_link?(r(),d("iframe",{key:0,src:p.value,class:"rounded-t-md min-h-56 w-full"},null,8,ue)):_("",!0),t("div",ce,[a.course.data.paid_course?(r(),d("div",de,n(a.course.data.price),1)):_("",!0),e(s)?_("",!0):(r(),d("div",me,[a.course.data.membership?(r(),d("div",_e,[i(S,{to:{name:"Lesson",params:{courseName:a.course.name,chapterNumber:a.course.data.current_lesson?a.course.data.current_lesson.split("-")[0]:1,lessonNumber:a.course.data.current_lesson?a.course.data.current_lesson.split("-")[1]:1}}},{default:f(()=>[i(e(k),{variant:"solid",size:"md",class:"w-full"},{default:f(()=>[t("span",null,n(l.__("Continue Learning")),1)]),_:1})]),_:1},8,["to"]),i(ae,{courseName:a.course.data.name,class:"w-full"},null,8,["courseName"])])):a.course.data.paid_course?(r(),g(S,{key:1,to:{name:"Billing",params:{type:"course",name:a.course.data.name}}},{default:f(()=>[i(e(k),{variant:"solid",size:"md",class:"w-full"},{default:f(()=>[t("span",null,n(l.__("Buy this course")),1)]),_:1})]),_:1},8,["to"])):a.course.data.disable_self_learning?(r(),g(e(T),{key:2,theme:"blue",size:"lg"},{default:f(()=>[C(n(l.__("Contact the Administrator to enroll for this course.")),1)]),_:1})):(r(),g(e(k),{key:3,onClick:b[0]||(b[0]=A=>w()),variant:"solid",class:"w-full",size:"md"},{default:f(()=>[t("span",null,n(l.__("Start Learning")),1)]),_:1})),m.value?(r(),g(e(k),{key:4,onClick:b[1]||(b[1]=A=>u()),variant:"subtle",class:"w-full mt-2",size:"md"},{default:f(()=>[C(n(l.__("Get Certificate")),1)]),_:1})):_("",!0),e(c)?.data?.is_moderator||y()?(r(),g(S,{key:5,to:{name:"CourseForm",params:{courseName:a.course.data.name}}},{default:f(()=>[i(e(k),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:f(()=>[t("span",null,n(l.__("Edit")),1)]),_:1})]),_:1},8,["to"])):_("",!0)])),t("div",fe,[t("div",{class:L(["font-medium text-ink-gray-9",{"mt-8":!e(s)}])},n(l.__("This course has:")),3),t("div",pe,[i(e(F),{class:"h-4 w-4 stroke-1.5"}),t("span",he,n(a.course.data.lessons)+" "+n(l.__("Lessons")),1)]),t("div",ve,[i(e(D),{class:"h-4 w-4 stroke-1.5"}),t("span",ge,n(e(H)(a.course.data.enrollments))+" "+n(l.__("Enrolled Students")),1)]),parseInt(a.course.data.rating)>0?(r(),d("div",we,[i(e(P),{class:"size-4 stroke-1.5 fill-yellow-500 text-transparent"}),t("span",ye,n(a.course.data.rating)+" "+n(l.__("Rating")),1)])):_("",!0),a.course.data.enable_certification?(r(),d("div",be,[i(e(B),{class:"h-4 w-4 stroke-2"}),t("span",ke,n(l.__("Certificate of Completion")),1)])):_("",!0),a.course.data.paid_certificate?(r(),d("div",$e,[i(e(B),{class:"h-4 w-4 stroke-2"}),t("span",xe,n(l.__("Paid Certificate after Evaluation")),1)])):_("",!0)])])])}}},Ne={class:"flex flex-col gap-4"},Re={__name:"ReviewModal",props:J({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{},reloadReviews:{},reloadReviewsModifiers:{},hasReviewed:{},hasReviewedModifiers:{}}),emits:["update:modelValue","update:reloadReviews","update:hasReviewed"],setup(a){const v=V(a,"modelValue"),c=V(a,"reloadReviews"),s=V(a,"hasReviewed");let o=K({review:"",rating:0});const p=a,w=x({url:"frappe.client.insert",makeParams(m){return{doc:{doctype:"LMS Course Review",course:p.courseName,...m}}}});function y(m){o.rating=o.rating/5,w.submit(o,{validate(){if(!o.rating)return"Please enter a rating."},onSuccess(){c.value.reload(),s.value.reload()},onError(h){R.error(h.messages?.[0]||h)}}),m()}return(m,h)=>(r(),g(e(X),{modelValue:v.value,"onUpdate:modelValue":h[2]||(h[2]=u=>v.value=u),options:{title:m.__("Write a Review"),size:"xl",actions:[{label:"Submit",variant:"solid",onClick:u=>y(u)}]}},{"body-content":f(()=>[t("div",Ne,[i(e(oe),{modelValue:e(o).rating,"onUpdate:modelValue":h[0]||(h[0]=u=>e(o).rating=u),label:m.__("Rating")},null,8,["modelValue","label"]),i(e(Q),{label:m.__("Review"),type:"textarea",modelValue:e(o).review,"onUpdate:modelValue":h[1]||(h[1]=u=>e(o).review=u),rows:5},null,8,["label","modelValue"])])]),_:1},8,["modelValue","options"]))}},Ce={key:0,class:"mt-20 mb-10"},Se={class:"flex items-center font-semibold text-2xl text-ink-gray-9"},Ve={class:"grid gap-8 mt-10"},Me={class:"flex items-center"},ze={class:"mx-4"},Le={class:"text-lg font-medium mr-4 text-ink-gray-7"},Pe={class:"text-ink-gray-7"},Ue={class:"flex mt-2 space-x-1"},Be={key:0,class:"mt-4 leading-5 text-ink-gray-7"},Ee={__name:"CourseReviews",props:{courseName:{type:String,required:!0},avg_rating:{type:String,required:!0},membership:{type:Object,required:!1}},setup(a){const v=q("$user"),c=a,s=x({url:"frappe.client.get_count",cache:["eligible_to_review",c.courseName,c.membership?.member],params:{doctype:"LMS Course Review",filters:{course:c.courseName,owner:c.membership?.member}},auto:!!v.data?.name}),o=x({url:"lms.lms.utils.get_reviews",cache:["course_reviews",c.courseName],makeParams(){return{course:c.courseName}},auto:!0});U(()=>c.courseName,()=>{o.reload()});const p=Z(!1);function w(){p.value=!0}return(y,m)=>{const h=z("router-link");return r(),d($,null,[e(o).data?.length||a.membership?(r(),d("div",Ce,[a.membership&&!e(s).data?(r(),g(e(k),{key:0,onClick:m[0]||(m[0]=u=>w()),class:"float-right"},{default:f(()=>[C(n(y.__("Write a Review")),1)]),_:1})):_("",!0),t("div",Se,n(y.__("Student Reviews")),1),t("div",Ve,[(r(!0),d($,null,N(e(o).data,(u,l)=>(r(),d("div",null,[t("div",Me,[i(h,{to:{name:"Profile",params:{username:u.owner_details.username}}},{default:f(()=>[i(I,{user:u.owner_details,size:"2xl"},null,8,["user"])]),_:2},1032,["to"]),t("div",ze,[i(h,{to:{name:"Profile",params:{username:u.owner_details.username}}},{default:f(()=>[t("span",Le,n(u.owner_details.full_name),1)]),_:2},1032,["to"]),t("span",Pe,n(u.creation),1),t("div",Ue,[(r(),d($,null,N(5,b=>i(e(P),{class:L(["size-4 text-transparent rounded-sm",b<=Math.ceil(u.rating)?"fill-yellow-500":"fill-gray-300"])},null,8,["class"])),64))])])]),u.review?(r(),d("div",Be,n(u.review),1)):_("",!0)]))),256))])])):_("",!0),i(Re,{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=u=>p.value=u),reloadReviews:e(o),"onUpdate:reloadReviews":m[2]||(m[2]=u=>E(o)?o.value=u:null),hasReviewed:e(s),"onUpdate:hasReviewed":m[3]||(m[3]=u=>E(s)?s.value=u:null),courseName:a.courseName},null,8,["modelValue","reloadReviews","hasReviewed","courseName"])],64)}}},Oe={key:0,class:"mt-10"},je={class:"flex items-center justify-between mb-6"},qe={class:"text-2xl font-semibold text-ink-gray-9"},Te={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},De={__name:"RelatedCourses",props:{courseName:{type:String,required:!0}},setup(a){const v=a,c=x({url:"lms.lms.utils.get_related_courses",cache:["related_courses",v.courseName],makeParams(){return{course:v.courseName}},auto:!0});return U(()=>v.courseName,()=>{c.reload()}),(s,o)=>{const p=z("router-link");return e(c).data?.length?(r(),d("div",Oe,[t("div",je,[t("div",qe,n(s.__("Related Courses")),1)]),t("div",Te,[(r(!0),d($,null,N(e(c).data,w=>(r(),g(p,{key:w.name,to:{name:"CourseDetail",params:{courseName:w.name}},class:"cursor-pointer"},{default:f(()=>[i(ie,{course:w},null,8,["course"])]),_:2},1032,["to"]))),128))])])):_("",!0)}}},Ie={key:0},Ae={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ge={class:"m-5"},Fe={class:"flex justify-between w-full"},He={class:"md:w-2/3"},We={class:"text-3xl font-semibold text-ink-gray-9"},Ye={class:"my-3 leading-6 text-ink-gray-7"},Je={class:"flex items-center"},Ke={class:"ml-1 text-ink-gray-7"},Qe={key:1,class:"mx-3"},Xe={class:"ml-1"},Ze={key:3,class:"mx-3"},et={class:"flex items-center"},tt={key:0,class:"flex my-4 w-fit"},st=["innerHTML"],at={class:"mt-10"},rt={class:"hidden md:block"},Pt={__name:"CourseDetail",props:{courseName:{type:String,required:!0}},setup(a){const{brand:v}=ee(),c=a,s=x({url:"lms.lms.utils.get_course_details",cache:["course",c.courseName],makeParams(){return{course:c.courseName}},auto:!0});U(()=>c.courseName,()=>{s.reload()});const o=M(()=>{let p=[{label:"Courses",route:{name:"Courses"}}];return p.push({label:s?.data?.title,route:{name:"CourseDetail",params:{courseName:s?.data?.name}}}),p});return te(()=>({title:s?.data?.title,icon:v.favicon})),(p,w)=>e(s).data?(r(),d("div",Ie,[t("header",Ae,[i(e(se),{class:"h-7",items:o.value},null,8,["items"])]),t("div",Ge,[t("div",Fe,[t("div",He,[t("div",We,n(e(s).data.title),1),t("div",Ye,n(e(s).data.short_introduction),1),t("div",Je,[parseInt(e(s).data.rating)>0?(r(),g(e(O),{key:0,text:p.__("Average Rating"),class:"flex items-center"},{default:f(()=>[i(e(P),{class:"size-4 text-transparent fill-yellow-500"}),t("span",Ke,n(e(s).data.rating),1)]),_:1},8,["text"])):_("",!0),parseInt(e(s).data.rating)>0?(r(),d("span",Qe,"·")):_("",!0),e(s).data.enrollment_count?(r(),g(e(O),{key:2,text:p.__("Enrolled Students"),class:"flex items-center"},{default:f(()=>[i(e(D),{class:"h-4 w-4 text-ink-gray-7"}),t("span",Xe,n(e(s).data.enrollment_count_formatted),1)]),_:1},8,["text"])):_("",!0),e(s).data.enrollment_count?(r(),d("span",Ze,"·")):_("",!0),t("div",et,[t("span",{class:L(["h-6 mr-1",{"avatar-group overlap":e(s).data.instructors.length>1}])},[(r(!0),d($,null,N(e(s).data.instructors,y=>(r(),g(I,{user:y},null,8,["user"]))),256))],2),i(ne,{instructors:e(s).data.instructors},null,8,["instructors"])])]),e(s).data.tags?(r(),d("div",tt,[(r(!0),d($,null,N(e(s).data.tags.split(", "),y=>(r(),g(e(T),{theme:"gray",size:"lg",class:"mr-2 text-ink-gray-9"},{default:f(()=>[C(n(y),1)]),_:2},1024))),256))])):_("",!0),i(j,{course:e(s),class:"md:hidden mb-4"},null,8,["course"]),t("div",{innerHTML:e(s).data.description,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-10"},null,8,st),t("div",at,[i(re,{title:p.__("Course Outline"),courseName:e(s).data.name,showOutline:!0},null,8,["title","courseName"])]),i(Ee,{courseName:e(s).data.name,avg_rating:e(s).data.rating,membership:e(s).data.membership},null,8,["courseName","avg_rating","membership"])]),t("div",rt,[i(j,{course:e(s)},null,8,["course"])])]),i(De,{courseName:e(s).data.name},null,8,["courseName"])])])):_("",!0)}};export{Pt as default};
//# sourceMappingURL=CourseDetail-zsiRLC8K.js.map
