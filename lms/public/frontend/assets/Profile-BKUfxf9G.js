import{i as B,r as M,c as b,o as r,d as a,h as C,e as y,t as n,p as s,b as l,w as m,H as S,V as A,W as q,X as O,L as U,D as I,E as w,bB as N,bC as D,bD as H,a4 as W,I as T,aU as X,Y,R as G,g as F,bE as J,F as z,f as K,bF as Z,bG as Q,bH as ee,bI as se,B as te,a8 as ae,u as oe,n as le,aW as re,bJ as ie,z as ne,a as de,q as ue,bK as R,Z as me}from"./index-RevCnO16.js";import{_ as ce}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-CeasAM64.js";import{T as fe}from"./TabButtons-BcffgYTE.js";import{_ as pe}from"./UserAvatar-6CYw18x4.js";const _e={class:"border rounded-md w-1/3 mx-auto my-32"},be={class:"border-b px-5 py-3 font-medium"},ge={key:0,class:"px-5 py-3"},ve={class:"px-5 py-3"},he={__name:"NoPermission",setup($){const x=B("$user"),f=()=>{window.location.href="/login"};return(t,p)=>{const k=M("router-link");return r(),b("div",_e,[a("div",be,[p[1]||(p[1]=a("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),y(" "+n(t.__("Not Permitted")),1)]),s(x).data?(r(),b("div",ge,[a("div",null,n(t.__("You do not have permission to access this page.")),1),l(k,{to:{name:"Courses"}},{default:m(()=>[l(s(S),{variant:"solid",class:"mt-2"},{default:m(()=>[y(n(t.__("Checkout Courses")),1)]),_:1})]),_:1})])):C("",!0),a("div",ve,[a("div",null,n(t.__("Please login to access this page.")),1),l(s(S),{onClick:p[0]||(p[0]=_=>f()),class:"mt-4"},{default:m(()=>[y(n(t.__("Login")),1)]),_:1})])])}}},ye={class:"mb-4"},xe={key:1,class:"mb-4"},ke={class:"text-xs text-ink-gray-5 mb-1"},we={class:"flex items-center"},$e={class:"border rounded-md p-2 mr-2"},Pe={class:"text-base flex flex-col"},Ce={class:"text-sm text-ink-gray-4 mt-1"},Se={class:"mb-4"},Ue={class:"mb-1.5 text-sm text-ink-gray-5"},Ve={__name:"EditProfile",props:A({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup($){const x=q($,"reloadProfile"),f=$,t=O({first_name:"",last_name:"",headline:"",bio:"",image:""}),p=U({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){t.image=e}}),k=U({url:"frappe.client.set_value",makeParams(e){return{doctype:"User",name:f.profile.data.name,fieldname:{user_image:t.image.file_url,...t}}},onSuccess(e){f.profile.data=e}}),_=e=>{k.submit({},{onSuccess(){e(),x.value.reload()},onError(o){G.error(o.messages?.[0]||o)}})},c=e=>{let o=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(o))return"Only image file is allowed."},g=e=>{t.image=e},d=()=>{t.image=null};return I(()=>f.profile.data,e=>{e&&(t.first_name=e.first_name,t.last_name=e.last_name,t.headline=e.headline,t.bio=e.bio,e.user_image&&p.submit({image:e.user_image}))}),(e,o)=>(r(),w(s(Y),{options:{title:"Edit your profile",size:"xl",actions:[{label:"Save",variant:"solid",onClick:i=>_(i)}]}},{"body-content":m(()=>[a("div",null,[t.image?(r(),b("div",xe,[a("div",ke,n(e.__("Profile Image")),1),a("div",we,[a("div",$e,[l(s(D),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),a("div",Pe,[a("span",null,n(t.image.file_name),1),a("span",Ce,n(s(H)(t.image.file_size)),1)]),l(s(W),{onClick:o[1]||(o[1]=i=>d()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(r(),w(s(N),{key:0,fileTypes:["image/*"],validateFile:c,onSuccess:o[0]||(o[0]=i=>g(i))},{default:m(({file:i,progress:j,uploading:P,openFileSelector:E})=>[a("div",ye,[l(s(S),{onClick:E,loading:P},{default:m(()=>[y(n(P?`Uploading ${j}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),l(s(T),{modelValue:t.first_name,"onUpdate:modelValue":o[2]||(o[2]=i=>t.first_name=i),label:e.__("First Name"),class:"mb-4"},null,8,["modelValue","label"]),l(s(T),{modelValue:t.last_name,"onUpdate:modelValue":o[3]||(o[3]=i=>t.last_name=i),label:e.__("Last Name"),class:"mb-4"},null,8,["modelValue","label"]),l(s(T),{modelValue:t.headline,"onUpdate:modelValue":o[4]||(o[4]=i=>t.headline=i),label:e.__("Headline"),class:"mb-4"},null,8,["modelValue","label"]),a("div",Se,[a("div",Ue,n(e.__("Bio")),1),l(s(X),{fixedMenu:!0,onChange:o[5]||(o[5]=i=>t.bio=i),content:t.bio,editorClass:"prose-sm py-2 px-2 min-h-[200px] border-outline-gray-2 hover:border-outline-gray-3 rounded-md bg-surface-gray-3"},null,8,["content"])])])]),_:1},8,["options"]))}},je={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-surface-white px-4 sm:px-0 lg:max-w-3xl"},Ee={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Te={class:"flex items-center justify-center space-x-2"},Fe={class:""},Ie={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-surface-white lg:grid-cols-2"},Re=["onClick"],Be=["src"],Me={key:0,class:"mt-2 text-center text-sm text-ink-gray-4"},Ne={class:"underline",target:"_blank",href:"https://unsplash.com"},ze={__name:"EditCoverImage",emits:["select"],setup($,{emit:x}){const f=F(null),t=x,p=U({url:"lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:f.value}),auto:!0,debounce:500});I(()=>f.value,()=>{p.reload()});const k=c=>{t("select",c.file_url)},_=c=>{let g=c.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(g))return"Only image file is allowed."};return(c,g)=>(r(),w(s(se),{transition:"default"},{target:m(({isOpen:d,togglePopover:e})=>[Z(c.$slots,"default",Q(ee({isOpen:d,togglePopover:e})))]),body:m(()=>[a("div",je,[a("div",Ee,[a("div",Te,[l(s(J),{type:"text",placeholder:"search by keyword",modelValue:f.value,"onUpdate:modelValue":g[0]||(g[0]=d=>f.value=d),debounce:300,class:"flex-1"},null,8,["modelValue"]),l(s(N),{fileTypes:["image/*"],validateFile:_,onSuccess:g[1]||(g[1]=d=>k(d))},{default:m(({file:d,progress:e,uploading:o,openFileSelector:i})=>[a("div",Fe,[l(s(S),{onClick:i,loading:o},{default:m(()=>[y(n(o?`Uploading ${e}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),a("div",Ie,[(r(!0),b(z,null,K(s(p).data,d=>(r(),b("button",{key:d.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:e=>c.$emit("select",d.urls.raw)},[a("img",{src:d.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Be)],8,Re))),128))]),s(p).data?(r(),b("div",Me,[y(n(c.__("Image search powered by"))+" ",1),a("a",Ne,n(c.__("Unsplash")),1)])):C("",!0)])])]),_:3}))}},Le={key:1},Ae={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},qe={class:"group relative h-[130px] w-full"},Oe=["src"],De={key:2,class:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},He={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},We={class:"flex flex-col md:flex-row items-center"},Xe=["src"],Ye={class:"ml-6"},Ge={class:"mt-2 text-3xl font-semibold text-ink-gray-9"},Je={class:"mt-2 text-base text-ink-gray-7"},Ke={class:"mb-4 mt-6"},as={__name:"Profile",props:{username:{type:String,required:!0}},setup($){const{user:x,brand:f}=te(),t=B("$user"),p=ae(),k=oe(),_=F(""),c=F(!1),g=window.read_only_mode,d=$;le(()=>{t.data&&e.reload(),i()});const e=U({url:"frappe.client.get",makeParams(u){return{doctype:"User",filters:{username:d.username}}}}),o=U({url:"frappe.client.set_value",makeParams(u){return{doctype:"User",name:e.data?.name,fieldname:"cover_image",value:u.url}},onSuccess(){e.reload()}}),i=()=>{let u=p.path.split("/");["certificates","roles","slots","schedule"].forEach(V=>{u.includes(V)&&(_.value=re(V))}),_.value||(_.value="About")};ie(()=>{if(_.value){let u={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Slots:{name:"ProfileEvaluator"},Schedule:{name:"ProfileEvaluationSchedule"}}[_.value];k.push(u)}}),I(()=>d.username,()=>{e.reload()});const j=()=>{c.value=!0},P=()=>t.data?.email===e.data?.email,E=()=>{let u=[{label:"About"},{label:"Certificates"}];return t.data?.is_moderator&&u.push({label:"Roles"}),P()&&(t.data?.is_evaluator||t.data?.is_moderator)&&(u.push({label:"Slots"}),u.push({label:"Schedule"})),u},L=ne(()=>[{label:"People"},{label:e.data?.full_name,route:{name:"Profile",params:{username:x.doc?.username}}}]);return de(()=>({title:e.data?.full_name,icon:f.favicon})),(u,v)=>{const V=M("router-view");return r(),b(z,null,[s(t).data?s(e).data?(r(),b("div",Le,[a("header",Ae,[l(s(ce),{class:"h-7",items:L.value},null,8,["items"])]),a("div",qe,[s(e).data.cover_image?(r(),b("img",{key:0,src:s(e).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,Oe)):(r(),b("div",{key:1,class:ue([{"bg-surface-gray-2":!s(e).data.cover_image},"h-[130px] w-full"])},null,2)),P()?(r(),b("div",De,[l(ze,{onSelect:v[0]||(v[0]=h=>s(o).submit({url:h}))},{default:m(({togglePopover:h})=>[s(g)?C("",!0):(r(),w(s(S),{key:0,variant:"outline",onClick:Ze=>h()},{prefix:m(()=>[l(s(R),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:m(()=>[y(" "+n(u.__("Edit")),1)]),_:2},1032,["onClick"]))]),_:1})])):C("",!0)]),a("div",He,[a("div",We,[a("div",null,[s(e).data.user_image?(r(),b("img",{key:0,src:s(e).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,Xe)):(r(),w(pe,{key:1,user:s(e).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),a("div",Ye,[a("h2",Ge,n(s(e).data.full_name),1),a("div",Je,n(s(e).data.headline),1)]),P()&&!s(g)?(r(),w(s(S),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:v[1]||(v[1]=h=>j())},{prefix:m(()=>[l(s(R),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:m(()=>[y(" "+n(u.__("Edit Profile")),1)]),_:1})):C("",!0)]),a("div",Ke,[l(s(fe),{class:"inline-block",buttons:E(),modelValue:_.value,"onUpdate:modelValue":v[2]||(v[2]=h=>_.value=h)},null,8,["buttons","modelValue"])]),l(V,{profile:s(e)},null,8,["profile"])])])):C("",!0):(r(),w(he,{key:0})),l(Ve,{modelValue:c.value,"onUpdate:modelValue":v[3]||(v[3]=h=>c.value=h),reloadProfile:s(e),"onUpdate:reloadProfile":v[4]||(v[4]=h=>me(e)?e.value=h:null),profile:s(e)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{as as default};
//# sourceMappingURL=Profile-BKUfxf9G.js.map
