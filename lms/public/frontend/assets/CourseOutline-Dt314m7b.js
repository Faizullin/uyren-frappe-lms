import{az as Q,q as z,y as se,bb as le,g as $,bB as pe,c1 as me,c2 as M,c3 as H,c4 as B,bN as oe,c5 as fe,c6 as F,c7 as G,c8 as W,c9 as ge,ca as J,i as U,Q as _e,R as Y,au as ve,T as ke,I as N,A as re,B as v,o as i,w as y,d as k,b as x,c as V,h as b,s as l,E as he,aM as be,bs as ye,D as K,e as R,t as O,bt as ne,bu as Ce,bv as xe,V as we,N as D,O as De,Z as Se,u as Ee,aG as $e,r as Oe,n as I,F as ee,f as Pe,a8 as Ne,X as te,cb as Ve,j as q,as as ae,cc as Me,cd as Be,bF as Ie,W as Le}from"./index-CgbsATbs.js";import{D as Te}from"./vuedraggable.umd-Dkn0uGDc.js";var Re=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Re||{});let ie=Symbol("DisclosureContext");function X(e){let f=U(ie,null);if(f===null){let h=new Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(h,X),h}return f}let ue=Symbol("DisclosurePanelContext");function ze(){return U(ue,null)}let Fe=Q({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(e,{slots:f,attrs:h}){let g=$(e.defaultOpen?0:1),a=$(null),_=$(null),t={buttonId:$(`headlessui-disclosure-button-${W()}`),panelId:$(`headlessui-disclosure-panel-${W()}`),disclosureState:g,panel:a,button:_,toggleDisclosure(){g.value=J(g.value,{0:1,1:0})},closeDisclosure(){g.value!==1&&(g.value=1)},close(n){t.closeDisclosure();let p=n?n instanceof HTMLElement?n:n.value instanceof HTMLElement?M(n):M(t.button):M(t.button);p?.focus()}};return oe(ie,t),ge(z(()=>J(g.value,{0:F.Open,1:F.Closed}))),()=>{let{defaultOpen:n,...p}=e,m={open:g.value===0,close:t.close};return H({theirProps:p,ourProps:{},slot:m,slots:f,attrs:h,name:"Disclosure"})}}}),Ue=Q({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(e,{attrs:f,slots:h,expose:g}){let a=X("DisclosureButton"),_=ze(),t=z(()=>_===null?!1:_.value===a.panelId.value);se(()=>{t.value||e.id!==null&&(a.buttonId.value=e.id)}),le(()=>{t.value||(a.buttonId.value=null)});let n=$(null);g({el:n,$el:n}),t.value||pe(()=>{a.button.value=n.value});let p=me(z(()=>({as:e.as,type:f.type})),n);function m(){var c;e.disabled||(t.value?(a.toggleDisclosure(),(c=M(a.button))==null||c.focus()):a.toggleDisclosure())}function S(c){var E;if(!e.disabled)if(t.value)switch(c.key){case B.Space:case B.Enter:c.preventDefault(),c.stopPropagation(),a.toggleDisclosure(),(E=M(a.button))==null||E.focus();break}else switch(c.key){case B.Space:case B.Enter:c.preventDefault(),c.stopPropagation(),a.toggleDisclosure();break}}function P(c){switch(c.key){case B.Space:c.preventDefault();break}}return()=>{var c;let E={open:a.disclosureState.value===0},{id:o,...r}=e,d=t.value?{ref:n,type:p.value,onClick:m,onKeydown:S}:{id:(c=a.buttonId.value)!=null?c:o,ref:n,type:p.value,"aria-expanded":a.disclosureState.value===0,"aria-controls":a.disclosureState.value===0||M(a.panel)?a.panelId.value:void 0,disabled:e.disabled?!0:void 0,onClick:m,onKeydown:S,onKeyup:P};return H({ourProps:d,theirProps:r,slot:E,attrs:f,slots:h,name:"DisclosureButton"})}}}),Ae=Q({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:f,slots:h,expose:g}){let a=X("DisclosurePanel");se(()=>{e.id!==null&&(a.panelId.value=e.id)}),le(()=>{a.panelId.value=null}),g({el:a.panel,$el:a.panel}),oe(ue,a.panelId);let _=fe(),t=z(()=>_!==null?(_.value&F.Open)===F.Open:a.disclosureState.value===0);return()=>{var n;let p={open:a.disclosureState.value===0,close:a.close},{id:m,...S}=e,P={id:(n=a.panelId.value)!=null?n:m,ref:a.panel};return H({ourProps:P,theirProps:S,slot:p,attrs:f,slots:h,features:G.RenderStrategy|G.Static,visible:t.value,name:"DisclosurePanel"})}}});const je={class:"space-y-4 text-base"},qe={key:0},Ke={class:"mb-4"},Qe={key:1,class:""},He={class:"flex items-center"},Xe={class:"border rounded-md p-2 mr-2"},Ze={class:"flex flex-col"},Ge={class:"text-sm text-ink-gray-4 mt-1"},We={__name:"ChapterModal",props:_e({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(e){const f=Y(e,"modelValue"),h=Y(e,"outline"),g=U("$user"),{updateOnboardingStep:a}=ve("learning"),_=e,t=ke({title:"",is_scorm_package:0,scorm_package:null}),n=N({url:"lms.lms.api.upsert_chapter",makeParams(o){return{title:t.title,course:_.course,is_scorm_package:t.is_scorm_package,scorm_package:t.scorm_package,name:_.chapterDetail?.name}}}),p=N({url:"frappe.client.insert",makeParams(o){return{doc:{doctype:"Chapter Reference",chapter:o.name,parent:_.course,parenttype:"LMS Course",parentfield:"chapters"}}}}),m=async o=>{n.submit({},{validate(){return S()},onSuccess:r=>{g.data?.is_system_manager&&a("create_first_chapter"),De("chapter_created"),p.submit({name:r.name},{onSuccess(d){P(),h.value.reload(),D.success(__("Chapter added successfully"))},onError(d){D.error(d.messages?.[0]||d)}}),o()},onError(r){D.error(r.messages?.[0]||r)}})},S=()=>{if(!t.title)return __("Title is required");if(t.is_scorm_package&&!t.scorm_package)return __("Please upload a SCORM package")},P=()=>{t.title="",t.is_scorm_package=0,t.scorm_package=null},c=o=>{n.submit({},{validate(){if(!t.title)return"Title is required"},onSuccess(){h.value.reload(),D.success(__("Chapter updated successfully")),o()},onError(r){D.error(r.messages?.[0]||r)}})};re(()=>_.chapterDetail,o=>{t.title=o?.title,t.is_scorm_package=o?.is_scorm_package,t.scorm_package=o?.scorm_package});const E=o=>{if(o.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(o,r)=>(i(),v(l(we),{modelValue:f.value,"onUpdate:modelValue":r[4]||(r[4]=d=>f.value=d),options:{title:e.chapterDetail?o.__("Edit Chapter"):o.__("Add Chapter"),size:"lg",actions:[{label:e.chapterDetail?o.__("Edit"):o.__("Create"),variant:"solid",onClick:d=>e.chapterDetail?c(d):m(d)}]}},{"body-content":y(()=>[k("div",je,[x(l(he),{label:"Title",modelValue:t.title,"onUpdate:modelValue":r[0]||(r[0]=d=>t.title=d),required:!0},null,8,["modelValue"]),x(l(be),{size:"sm",label:o.__("SCORM Package"),description:o.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:t.is_scorm_package,"onUpdate:modelValue":r[1]||(r[1]=d=>t.is_scorm_package=d)},null,8,["label","description","modelValue"]),t.is_scorm_package?(i(),V("div",qe,[t.scorm_package?(i(),V("div",Qe,[k("div",He,[k("div",Xe,[x(l(ne),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),k("div",Ze,[k("span",null,O(t.scorm_package.file_name),1),k("span",Ge,O(l(Ce)(t.scorm_package.file_size)),1)]),x(l(xe),{onClick:r[3]||(r[3]=()=>t.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(i(),v(l(ye),{key:0,fileTypes:[".zip"],validateFile:E,onSuccess:r[2]||(r[2]=d=>t.scorm_package=d)},{default:y(({file:d,progress:A,uploading:L,openFileSelector:j})=>[k("div",Ke,[x(l(K),{onClick:j,loading:L},{default:y(()=>[R(O(L?`Uploading ${A}%`:"Upload an ZIP file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):b("",!0)])]),_:1},8,["modelValue","options"]))}},Je={class:""},Ye=["onClick"],et={class:"flex ml-auto space-x-4"},tt={class:"flex items-center text-sm leading-5 group"},at={key:1,class:"flex mt-2 mb-4 pl-8"},rt={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1}},setup(e){const f=Se(),h=Ee(),g=U("$user"),a=$(!1),_=$(null),t=$e(),{$dialog:n}=t.appContext.config.globalProperties,p=e,m=N({url:"lms.lms.utils.get_course_outline",cache:["course_outline",p.courseName],makeParams(){return{course:p.courseName,progress:p.getProgress}},auto:!0});re(()=>p.courseName,()=>{m.reload()});const S=N({url:"lms.lms.api.delete_lesson",makeParams(s){return{lesson:s.lesson,chapter:s.chapter}},onSuccess(){m.reload(),D.success(__("Lesson deleted successfully"))}}),P=N({url:"lms.lms.api.update_lesson_index",makeParams(s){return{lesson:s.lesson,sourceChapter:s.sourceChapter,targetChapter:s.targetChapter,idx:s.idx}},onSuccess(){D.success(__("Lesson moved successfully"))}}),c=(s,w)=>{n({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(T){S.submit({lesson:s,chapter:w}),T()}}]})},E=s=>s==f.params.chapterNumber||s==1,o=(s=null)=>{_.value=s,a.value=!0},r=()=>_.value,d=s=>{P.submit({lesson:s.item.__draggable_context.element.name,sourceChapter:s.from.dataset.chapter,targetChapter:s.to.dataset.chapter,idx:s.newIndex})},A=N({url:"lms.lms.api.delete_chapter",makeParams(s){return{chapter:s.chapter}},onSuccess(){m.reload(),D.success(__("Chapter deleted successfully"))}}),L=s=>{n({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(w){A.submit({chapter:s}),w()}}]})},j=s=>{if(s.is_scorm_package&&(event.preventDefault(),!p.allowEdit)){if(!g.data){D.success(__("Please enroll for this course to view this lesson"));return}h.push({name:"SCORMChapter",params:{courseName:p.courseName,chapterName:s.name}})}},ce=s=>f.params.chapterNumber==s.split(".")[0]&&f.params.lessonNumber==s.split(".")[1];return(s,w)=>{const T=Oe("router-link");return i(),V(ee,null,[k("div",Je,[e.title&&(l(m).data?.length||e.allowEdit)?(i(),V("div",{key:0,class:I(["flex items-center justify-between space-x-2 mb-4 px-2",{"sticky top-0 z-10 bg-surface-white border-b px-3 py-2.5 sm:px-5":e.allowEdit}])},[k("div",{class:I(["font-semibold text-lg leading-5 text-ink-gray-9",{"font-medium text-p-base":e.allowEdit}])},O(s.__(e.title)),3),e.allowEdit?(i(),v(l(K),{key:0,size:"md",class:"text-white",onClick:w[0]||(w[0]=u=>o()),style:{"background-color":"rgb(241, 81, 27)"}},{default:y(()=>[R(O(s.__("Add Chapter")),1)]),_:1})):b("",!0)],2)):b("",!0),k("div",{class:I({"border-2 rounded-md py-2 px-2":e.showOutline&&l(m).data?.length})},[(i(!0),V(ee,null,Pe(l(m).data,(u,de)=>(i(),v(l(Fe),{key:u.name,defaultOpen:E(u.idx)},{default:y(({open:Z})=>[x(l(Ue),{ref_for:!0,ref:"",class:"flex items-center w-full p-2 group"},{default:y(()=>[x(l(Ne),{class:I([{"rotate-90 transform duration-200":Z,"duration-200":!Z,hidden:u.is_scorm_package,open:de==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),k("div",{class:"text-base text-left text-ink-gray-9 font-medium leading-5 ml-2",onClick:C=>j(u)},O(u.title),9,Ye),k("div",et,[x(l(te),{text:s.__("Edit Chapter"),placement:"bottom"},{default:y(()=>[e.allowEdit?(i(),v(l(Ve),{key:0,onClick:q(C=>o(u),["prevent"]),class:"h-6 w-6 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])):b("",!0)]),_:2},1032,["text"]),x(l(te),{text:s.__("Delete Chapter"),placement:"bottom"},{default:y(()=>[e.allowEdit?(i(),v(l(ae),{key:0,onClick:q(C=>L(u.name),["prevent"]),class:"h-6 w-6 text-ink-red-3 invisible group-hover:visible"},null,8,["onClick"])):b("",!0)]),_:2},1032,["text"])])]),_:2},1536),u.is_scorm_package?b("",!0):(i(),v(l(Ae),{key:0},{default:y(()=>[u.is_scorm_package?b("",!0):(i(),v(l(Te),{key:0,list:u.lessons,disabled:!e.allowEdit,"item-key":"name",group:"items",onEnd:d,"data-chapter":u.name},{item:y(({element:C})=>[k("div",{class:I(["outline-lesson pl-8 py-2 pr-4 text-ink-gray-9",ce(C.number)?"bg-surface-gray-3":""])},[x(T,{to:{name:e.allowEdit?"LessonForm":"Lesson",params:{courseName:e.courseName,chapterNumber:C.number.split(".")[0],lessonNumber:C.number.split(".")[1]}}},{default:y(()=>[k("div",tt,[C.icon==="icon-youtube"?(i(),v(l(Me),{key:0,class:"h-5 w-5 text-[#f1511b] stroke-1 mr-2"})):C.icon==="icon-quiz"?(i(),v(l(Be),{key:1,class:"h-5 w-5 text-[#f1511b] stroke-1 mr-2"})):C.icon==="icon-list"?(i(),v(l(ne),{key:2,class:"h-5 w-5 text-[#f1511b] stroke-1 mr-2"})):b("",!0),R(" "+O(C.title)+" ",1),e.allowEdit?(i(),v(l(ae),{key:3,onClick:q(st=>c(C.name,u.name),["prevent"]),class:"h-5 w-5 text-ink-red-3 ml-auto invisible group-hover:visible"},null,8,["onClick"])):b("",!0),C.is_complete?(i(),v(l(Ie),{key:4,class:"h-4 w-4 text-green-700 ml-2"})):b("",!0)])]),_:2},1032,["to"])],2)]),_:2},1032,["list","disabled","data-chapter"])),e.allowEdit?(i(),V("div",at,[u.is_scorm_package?b("",!0):(i(),v(T,{key:0,to:{name:"LessonForm",params:{courseName:e.courseName,chapterNumber:u.idx,lessonNumber:u.lessons.length+1}}},{default:y(()=>[x(l(K),{size:"md",class:"text-white",style:{"background-color":"rgb(241, 81, 27)"}},{default:y(()=>[R(O(s.__("Add Lesson")),1)]),_:1})]),_:2},1032,["to"]))])):b("",!0)]),_:2},1024))]),_:2},1032,["defaultOpen"]))),128))],2)]),l(g).data?(i(),v(We,{key:0,modelValue:a.value,"onUpdate:modelValue":w[1]||(w[1]=u=>a.value=u),outline:l(m),"onUpdate:outline":w[2]||(w[2]=u=>Le(m)?m.value=u:null),course:e.courseName,chapterDetail:r()},null,8,["modelValue","outline","course","chapterDetail"])):b("",!0)],64)}}};export{rt as _};
//# sourceMappingURL=CourseOutline-Dt314m7b.js.map
