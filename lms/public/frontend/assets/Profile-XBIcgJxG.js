import{i as B,r as I,c as b,o as r,d as a,h as C,e as y,t as n,s,b as l,w as m,D as S,Q as L,R as q,T as O,I as U,A as N,B as w,bs as M,bt as D,bu as H,bv as Q,E,aL as W,V as X,N as Y,g as F,bw as Z,F as z,f as G,bx as J,by as K,bz as ee,bA as se,x as te,Z as ae,u as oe,y as le,aN as re,bB as ie,q as ne,a as de,n as ue,bC as R,W as me}from"./index-CgbsATbs.js";import{_ as ce}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-KbxUUXyD.js";import{T as fe}from"./TabButtons-BojyhwjV.js";import{_ as pe}from"./UserAvatar-ChxEkYoI.js";const _e={class:"border rounded-md w-1/3 mx-auto my-32"},be={class:"border-b px-5 py-3 font-medium"},ve={key:0,class:"px-5 py-3"},ge={class:"px-5 py-3"},he={__name:"NoPermission",setup($){const x=B("$user"),f=()=>{window.location.href="/login"};return(t,p)=>{const k=I("router-link");return r(),b("div",_e,[a("div",be,[p[1]||(p[1]=a("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),y(" "+n(t.__("Not Permitted")),1)]),s(x).data?(r(),b("div",ve,[a("div",null,n(t.__("You do not have permission to access this page.")),1),l(k,{to:{name:"Courses"}},{default:m(()=>[l(s(S),{variant:"solid",class:"mt-2"},{default:m(()=>[y(n(t.__("Checkout Courses")),1)]),_:1})]),_:1})])):C("",!0),a("div",ge,[a("div",null,n(t.__("Please login to access this page.")),1),l(s(S),{onClick:p[0]||(p[0]=_=>f()),class:"mt-4"},{default:m(()=>[y(n(t.__("Login")),1)]),_:1})])])}}},ye={class:"mb-4"},xe={key:1,class:"mb-4"},ke={class:"text-xs text-ink-gray-5 mb-1"},we={class:"flex items-center"},$e={class:"border rounded-md p-2 mr-2"},Pe={class:"text-base flex flex-col"},Ce={class:"text-sm text-ink-gray-4 mt-1"},Se={class:"mb-4"},Ue={class:"mb-1.5 text-sm text-ink-gray-5"},Ve={__name:"EditProfile",props:L({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup($){const x=q($,"reloadProfile"),f=$,t=O({first_name:"",last_name:"",headline:"",bio:"",image:""}),p=U({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){t.image=e}}),k=U({url:"frappe.client.set_value",makeParams(e){return{doctype:"User",name:f.profile.data.name,fieldname:{user_image:t.image.file_url,...t}}},onSuccess(e){f.profile.data=e}}),_=e=>{k.submit({},{onSuccess(){e(),x.value.reload()},onError(o){Y.error(o.messages?.[0]||o)}})},c=e=>{let o=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(o))return"Only image file is allowed."},v=e=>{t.image=e},d=()=>{t.image=null};return N(()=>f.profile.data,e=>{e&&(t.first_name=e.first_name,t.last_name=e.last_name,t.headline=e.headline,t.bio=e.bio,e.user_image&&p.submit({image:e.user_image}))}),(e,o)=>(r(),w(s(X),{options:{title:"Edit your profile",size:"xl",actions:[{label:"Save",variant:"solid",onClick:i=>_(i)}]}},{"body-content":m(()=>[a("div",null,[t.image?(r(),b("div",xe,[a("div",ke,n(e.__("Profile Image")),1),a("div",we,[a("div",$e,[l(s(D),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),a("div",Pe,[a("span",null,n(t.image.file_name),1),a("span",Ce,n(s(H)(t.image.file_size)),1)]),l(s(Q),{onClick:o[1]||(o[1]=i=>d()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(r(),w(s(M),{key:0,fileTypes:["image/*"],validateFile:c,onSuccess:o[0]||(o[0]=i=>v(i))},{default:m(({file:i,progress:j,uploading:P,openFileSelector:T})=>[a("div",ye,[l(s(S),{onClick:T,loading:P},{default:m(()=>[y(n(P?`Uploading ${j}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),l(s(E),{modelValue:t.first_name,"onUpdate:modelValue":o[2]||(o[2]=i=>t.first_name=i),label:e.__("First Name"),class:"mb-4"},null,8,["modelValue","label"]),l(s(E),{modelValue:t.last_name,"onUpdate:modelValue":o[3]||(o[3]=i=>t.last_name=i),label:e.__("Last Name"),class:"mb-4"},null,8,["modelValue","label"]),l(s(E),{modelValue:t.headline,"onUpdate:modelValue":o[4]||(o[4]=i=>t.headline=i),label:e.__("Headline"),class:"mb-4"},null,8,["modelValue","label"]),a("div",Se,[a("div",Ue,n(e.__("Bio")),1),l(s(W),{fixedMenu:!0,onChange:o[5]||(o[5]=i=>t.bio=i),content:t.bio,editorClass:"prose-sm py-2 px-2 min-h-[200px] border-outline-gray-2 hover:border-outline-gray-3 rounded-md bg-surface-gray-3"},null,8,["content"])])])]),_:1},8,["options"]))}},je={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-surface-white px-4 sm:px-0 lg:max-w-3xl"},Te={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Ee={class:"flex items-center justify-center space-x-2"},Fe={class:""},Ne={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-surface-white lg:grid-cols-2"},Re=["onClick"],Be=["src"],Ie={key:0,class:"mt-2 text-center text-sm text-ink-gray-4"},Me={class:"underline",target:"_blank",href:"https://unsplash.com"},ze={__name:"EditCoverImage",emits:["select"],setup($,{emit:x}){const f=F(null),t=x,p=U({url:"lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:f.value}),auto:!0,debounce:500});N(()=>f.value,()=>{p.reload()});const k=c=>{t("select",c.file_url)},_=c=>{let v=c.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(v))return"Only image file is allowed."};return(c,v)=>(r(),w(s(se),{transition:"default"},{target:m(({isOpen:d,togglePopover:e})=>[J(c.$slots,"default",K(ee({isOpen:d,togglePopover:e})))]),body:m(()=>[a("div",je,[a("div",Te,[a("div",Ee,[l(s(Z),{type:"text",placeholder:"search by keyword",modelValue:f.value,"onUpdate:modelValue":v[0]||(v[0]=d=>f.value=d),debounce:300,class:"flex-1"},null,8,["modelValue"]),l(s(M),{fileTypes:["image/*"],validateFile:_,onSuccess:v[1]||(v[1]=d=>k(d))},{default:m(({file:d,progress:e,uploading:o,openFileSelector:i})=>[a("div",Fe,[l(s(S),{onClick:i,loading:o},{default:m(()=>[y(n(o?`Uploading ${e}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),a("div",Ne,[(r(!0),b(z,null,G(s(p).data,d=>(r(),b("button",{key:d.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:e=>c.$emit("select",d.urls.raw)},[a("img",{src:d.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Be)],8,Re))),128))]),s(p).data?(r(),b("div",Ie,[y(n(c.__("Image search powered by"))+" ",1),a("a",Me,n(c.__("Unsplash")),1)])):C("",!0)])])]),_:3}))}},Ae={key:1},Le={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},qe={class:"group relative h-[130px] w-full"},Oe=["src"],De={key:2,class:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},He={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},Qe={class:"flex flex-col md:flex-row items-center"},We=["src"],Xe={class:"ml-6"},Ye={class:"mt-2 text-3xl font-semibold text-ink-gray-9"},Ze={class:"mt-2 text-base text-ink-gray-7"},Ge={class:"mb-4 mt-6"},as={__name:"Profile",props:{username:{type:String,required:!0}},setup($){const{user:x,brand:f}=te(),t=B("$user"),p=ae(),k=oe(),_=F(""),c=F(!1),v=window.read_only_mode,d=$;le(()=>{t.data&&e.reload(),i()});const e=U({url:"frappe.client.get",makeParams(u){return{doctype:"User",filters:{username:d.username}}}}),o=U({url:"frappe.client.set_value",makeParams(u){return{doctype:"User",name:e.data?.name,fieldname:"cover_image",value:u.url}},onSuccess(){e.reload()}}),i=()=>{let u=p.path.split("/");["certificates","roles","slots","schedule"].forEach(V=>{u.includes(V)&&(_.value=re(V))}),_.value||(_.value="About")};ie(()=>{if(_.value){let u={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Slots:{name:"ProfileEvaluator"},Schedule:{name:"ProfileEvaluationSchedule"}}[_.value];k.push(u)}}),N(()=>d.username,()=>{e.reload()});const j=()=>{c.value=!0},P=()=>t.data?.email===e.data?.email,T=()=>{let u=[{label:"About"},{label:"Certificates"}];return t.data?.is_moderator&&u.push({label:"Roles"}),P()&&(t.data?.is_evaluator||t.data?.is_moderator)&&(u.push({label:"Slots"}),u.push({label:"Schedule"})),u},A=ne(()=>[{label:"People"},{label:e.data?.full_name,route:{name:"Profile",params:{username:x.doc?.username}}}]);return de(()=>({title:e.data?.full_name,icon:f.favicon})),(u,g)=>{const V=I("router-view");return r(),b(z,null,[s(t).data?s(e).data?(r(),b("div",Ae,[a("header",Le,[l(s(ce),{class:"h-7",items:A.value},null,8,["items"])]),a("div",qe,[s(e).data.cover_image?(r(),b("img",{key:0,src:s(e).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,Oe)):(r(),b("div",{key:1,class:ue([{"bg-surface-gray-2":!s(e).data.cover_image},"h-[130px] w-full"])},null,2)),P()?(r(),b("div",De,[l(ze,{onSelect:g[0]||(g[0]=h=>s(o).submit({url:h}))},{default:m(({togglePopover:h})=>[s(v)?C("",!0):(r(),w(s(S),{key:0,variant:"outline",onClick:Je=>h()},{prefix:m(()=>[l(s(R),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:m(()=>[y(" "+n(u.__("Edit")),1)]),_:2},1032,["onClick"]))]),_:1})])):C("",!0)]),a("div",He,[a("div",Qe,[a("div",null,[s(e).data.user_image?(r(),b("img",{key:0,src:s(e).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,We)):(r(),w(pe,{key:1,user:s(e).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),a("div",Xe,[a("h2",Ye,n(s(e).data.full_name),1),a("div",Ze,n(s(e).data.headline),1)]),P()&&!s(v)?(r(),w(s(S),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:g[1]||(g[1]=h=>j())},{prefix:m(()=>[l(s(R),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:m(()=>[y(" "+n(u.__("Edit Profile")),1)]),_:1})):C("",!0)]),a("div",Ge,[l(s(fe),{class:"inline-block",buttons:T(),modelValue:_.value,"onUpdate:modelValue":g[2]||(g[2]=h=>_.value=h)},null,8,["buttons","modelValue"])]),l(V,{profile:s(e)},null,8,["profile"])])])):C("",!0):(r(),w(he,{key:0})),l(Ve,{modelValue:c.value,"onUpdate:modelValue":g[3]||(g[3]=h=>c.value=h),reloadProfile:s(e),"onUpdate:reloadProfile":g[4]||(g[4]=h=>me(e)?e.value=h:null),profile:s(e)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{as as default};
//# sourceMappingURL=Profile-XBIcgJxG.js.map
