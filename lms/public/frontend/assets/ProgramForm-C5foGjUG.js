import"@headlessui/vue";import{s as K,r as k,z as Q,a5 as W,b as C,u as X,e as _,f as u,g as n,k as P,h as a,l as e,n as t,p as V,t as g,_ as f,q as Y,P as S,ag as E,F as h,x,j as b,ah as D,aj as F,ak as T,am as j,an as U,ao as A,af as B,aq as Z,M as ee,a as re,H as i}from"./index-BIerRe8o.js";import{_ as se}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cdx-1Hlv.js";import"@tiptap/extension-code-block-lowlight";import"@tiptap/extension-placeholder";import"@tiptap/extension-table";import"@tiptap/extension-table-cell";import"@tiptap/extension-table-header";import"@tiptap/extension-table-row";import"@tiptap/extension-text-align";import"@tiptap/extension-text-style";import"@tiptap/extension-typography";import"@tiptap/vue-3";import"@tiptap/extension-mention";import{D as oe}from"./vuedraggable.umd-D2H5jHu-.js";import"@vueuse/core";import"@tiptap/core";import"@tiptap/extension-code-block";import"@tiptap/extension-heading";import"@tiptap/suggestion";import"@tiptap/extension-link";const ae={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},le={key:0,class:"pt-5 px-5 w-3/4 mx-auto space-y-10"},te={class:"flex items-center justify-between mb-2"},me={class:"text-lg text-ink-gray-9 font-semibold"},ue={class:"flex gap-2"},ne={class:"flex items-center justify-between mb-2"},ie={class:"text-lg text-ink-gray-9 font-semibold"},de={class:"flex gap-2"},Fe={__name:"ProgramForm",props:{programName:{type:String,required:!0}},setup(I){const{brand:L}=K(),c=k(!1),p=k(null),v=k(null),w=k(null),q=Q(),y=I,o=W({doctype:"LMS Program",name:y.programName,auto:!0,cache:["program",y.programName]}),z=()=>{o.setValue.submit({program_courses:[...o.doc.program_courses,{course:v.value}]},{onSuccess(r){c.value=!1,v.value=null,i.success(__("Course added to program")),o.reload()},onError(r){i.error(r.messages?.[0]||r)}})},O=()=>{o.setValue.submit({program_members:[...o.doc.program_members,{member:w.value}]},{onSuccess(r){c.value=!1,w.value=null,i.success(__("Member added to program")),o.reload()},onError(r){i.error(r.messages?.[0]||r)}})},N=(r,l,s)=>{r=Array.from(r),o.setValue.submit({[s]:o.doc[s].filter(m=>!r.includes(m.name))},{onSuccess(m){l(),i.success(__("Items removed successfully")),o.reload()},onError(m){i.error(m.messages?.[0]||m)}})},R=r=>{let l=r.from.dataset.idx,s=r.to.dataset.idx,m=o.doc.program_courses;m.splice(s,0,m.splice(l,1)[0]),m.forEach((d,J)=>{d.idx=J+1}),o.setValue.submit({program_courses:m},{onSuccess(d){i.success(__("Course moved successfully")),o.reload()},onError(d){i.error(d.messages?.[0]||d)}})},H=()=>{re("frappe.model.rename_doc.update_document_title",{doctype:"LMS Program",docname:o.doc.name,name:o.doc.title}).then(r=>{q.push({name:"ProgramForm",params:{programName:r}})})},$=C(()=>[{label:"Title",key:"course_title",width:3},{label:"ID",key:"course",width:3}]),M=C(()=>[{label:"Member",key:"member",width:3,align:"left"},{label:"Full Name",key:"full_name",width:3,align:"left"},{label:"Progress (%)",key:"progress",width:3,align:"right"}]),G=C(()=>[{label:"Programs",route:{name:"Programs"}},{label:y.programName==="new"?"New Program":y.programName}]);return X(()=>({title:o.doc?.title,icon:L.favicon})),(r,l)=>(u(),_(h,null,[n("header",ae,[a(e(se),{items:G.value},null,8,["items"]),a(e(f),{variant:"solid",onClick:l[0]||(l[0]=s=>H())},{default:t(()=>[V(g(r.__("Save")),1)]),_:1})]),e(o).doc?(u(),_("div",le,[a(e(Y),{modelValue:e(o).doc.title,"onUpdate:modelValue":l[1]||(l[1]=s=>e(o).doc.title=s),label:r.__("Title")},null,8,["modelValue","label"]),n("div",null,[n("div",te,[n("div",me,g(r.__("Program Courses")),1),a(e(f),{onClick:l[2]||(l[2]=()=>{p.value="course",c.value=!0})},{prefix:t(()=>[a(e(S),{class:"w-4 h-4"})]),default:t(()=>[V(" "+g(r.__("Add")),1)]),_:1})]),a(e(A),{columns:$.value,rows:e(o).doc.program_courses,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[a(e(E),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(u(!0),_(h,null,x($.value,s=>(u(),b(e(D),{item:s},null,8,["item"]))),256))]),_:1}),a(e(F),null,{default:t(()=>[a(e(oe),{list:e(o).doc.program_courses,"item-key":"name",group:"items",onEnd:R,class:"cursor-move"},{item:t(({element:s})=>[a(e(T),{row:s},null,8,["row"])]),_:1},8,["list"])]),_:1}),a(e(j),null,{actions:t(({unselectAll:s,selections:m})=>[n("div",ue,[a(e(f),{variant:"ghost",onClick:d=>N(m,s,"program_courses")},{default:t(()=>[a(e(U),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])]),n("div",null,[n("div",ne,[n("div",ie,g(r.__("Program Members")),1),a(e(f),{onClick:l[3]||(l[3]=()=>{p.value="member",c.value=!0})},{prefix:t(()=>[a(e(S),{class:"w-4 h-4"})]),default:t(()=>[V(" "+g(r.__("Add")),1)]),_:1})]),a(e(A),{columns:M.value,rows:e(o).doc.program_members,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[a(e(E),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(u(!0),_(h,null,x(M.value,s=>(u(),b(e(D),{item:s},null,8,["item"]))),256))]),_:1}),a(e(F),null,{default:t(()=>[(u(!0),_(h,null,x(e(o).doc.program_members,s=>(u(),b(e(T),{row:s},null,8,["row"]))),256))]),_:1}),a(e(j),null,{actions:t(({unselectAll:s,selections:m})=>[n("div",de,[a(e(f),{variant:"ghost",onClick:d=>N(m,s,"program_members")},{default:t(()=>[a(e(U),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):P("",!0),a(e(ee),{modelValue:c.value,"onUpdate:modelValue":l[6]||(l[6]=s=>c.value=s),options:{title:p.value=="course"?r.__("New Program Course"):r.__("New Program Member"),actions:[{label:r.__("Add"),variant:"solid",onClick:()=>p.value=="course"?z(r.close):O(r.close)}]}},{"body-content":t(()=>[p.value=="course"?(u(),b(B,{key:0,modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=s=>v.value=s),doctype:"LMS Course",filters:{disable_self_learning:1},label:r.__("Program Course"),description:r.__("Only courses for which self learning is disabled can be added to program.")},null,8,["modelValue","label","description"])):P("",!0),p.value=="member"?(u(),b(B,{key:1,modelValue:w.value,"onUpdate:modelValue":l[5]||(l[5]=s=>w.value=s),doctype:"User",filters:{ignore_user_type:1},label:r.__("Program Member"),onCreate:(s,m)=>e(Z)("Members",m)},null,8,["modelValue","label","onCreate"])):P("",!0)]),_:1},8,["modelValue","options"])],64))}};export{Fe as default};
//# sourceMappingURL=ProgramForm-C5foGjUG.js.map
