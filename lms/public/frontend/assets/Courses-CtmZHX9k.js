import{i as V,r as u,s as J,o as W,c as X,a as $,w as Z,b as k,u as ee,d as te,e as b,f as d,g as p,h as c,j as h,k as C,l as s,m as ae,n as y,_ as S,p as L,t as w,P as le,q as F,v as se,F as U,x as oe,y as re}from"./index-DiXMRYjh.js";import{_ as ne}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-cdEqS9iC.js";import{T as ue}from"./TabButtons-pKUrWwEt.js";import{_ as ie}from"./CourseCard-Bdoodd20.js";import{_ as de}from"./EmptyState.vue_vue_type_script_setup_true_lang-Ci78_lkp.js";import"./UserAvatar-fQOE9leg.js";import"./CourseInstructors-BB5gJO46.js";import"./ProgressBar-cuif0jh6.js";const ce={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},pe={class:"p-5 pb-10"},ve={class:"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5"},me={class:"text-lg text-ink-gray-9 font-semibold"},fe={class:"flex flex-col space-y-2 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4"},ge={class:"grid grid-cols-2 gap-2"},_e={class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40"},ye={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-5"},be={key:2,class:"flex justify-center mt-5"},Fe={__name:"Courses",setup(he){const r=V("$user"),N=V("$dayjs"),P=u(0),j=u(30),v=u([]),m=u(null),f=u(""),g=u(!1),a=u({}),n=u("Live"),{brand:M}=J(),x=u(0);W(()=>{T(),_(),D(),v.value=[{label:"",value:null}]});const T=()=>{let e=new URLSearchParams(location.search);f.value=e.get("title")||"",m.value=e.get("category")||null,g.value=e.get("certification")||!1},i=X({doctype:"LMS Course",url:"lms.lms.utils.get_courses",cache:["courses",r.data?.name],pageLength:j.value,start:P.value,onSuccess(e){E(e)}}),E=e=>{let t=e.map(o=>o.category);t=t.filter((o,l)=>t.indexOf(o)===l&&o),v.value.length<=t.length&&K(e)},B=async()=>await $("frappe.client.get_single_value",{doctype:"LMS Settings",field:"persona_captured"}),q=async()=>{if(r.data?.is_system_manager&&!r.data?.developer_mode){if(await B())return;x.value||re.push({name:"PersonaForm"})}},D=()=>{r.data&&$("frappe.client.get_count",{doctype:"LMS Course"}).then(e=>{x.value=e,q()})},_=()=>{Y(),i.update({filters:a.value}),i.reload()},Y=()=>{R(),O(),Q(),z(),A(),I()},R=()=>{m.value?a.value.category=m.value:delete a.value.category},O=()=>{f.value?a.value.title=["like",`%${f.value}%`]:delete a.value.title},Q=()=>{g.value?a.value.certification=1:delete a.value.certification},z=()=>{delete a.value.live,delete a.value.created,delete a.value.published_on,delete a.value.upcoming,n.value=="Enrolled"&&r.data?.is_student?(a.value.enrolled=1,delete a.value.published):(delete a.value.published,delete a.value.enrolled,n.value=="Live"?(a.value.published=1,a.value.upcoming=0,a.value.live=1):n.value=="Upcoming"?a.value.upcoming=1:n.value=="New"?(a.value.published=1,a.value.published_on=[">=",N().add(-3,"month").format("YYYY-MM-DD")]):n.value=="Created"?a.value.created=1:n.value=="Unpublished"&&(a.value.published=0))},A=()=>{(!r.data||r.data?.is_student&&n.value!="Enrolled")&&(a.value.published=1)},I=()=>{let e=new URLSearchParams(location.search),t={title:f.value,category:m.value,certification:g.value};Object.keys(t).forEach(l=>{t[l]?e.set(l,t[l]):e.delete(l)});let o="";e.toString()&&(o=`?${e.toString()}`),history.replaceState({},"",`${location.pathname}${o}`)},K=e=>{e.forEach(t=>{t.category&&!v.value.find(o=>o.value===t.category)&&v.value.push({label:t.category,value:t.category})})};Z(n,()=>{_()});const G=k(()=>{let e=[{label:__("Live")},{label:__("New")},{label:__("Upcoming")}];return r.data?.is_moderator||r.data?.is_instructor||r.data?.is_evaluator?(e.push({label:__("Created")}),e.push({label:__("Unpublished")})):r.data&&e.push({label:__("Enrolled")}),e}),H=k(()=>[{label:__("Courses"),route:{name:"Courses"}}]);return ee(()=>({title:__("Courses"),icon:M.favicon})),(e,t)=>{const o=te("router-link");return d(),b(U,null,[p("header",ce,[c(s(ne),{items:H.value},null,8,["items"]),s(ae)()?(d(),h(o,{key:0,to:{name:"CourseForm",params:{courseName:"new"}}},{default:y(()=>[c(s(S),{variant:"solid"},{prefix:y(()=>[c(s(le),{class:"h-4 w-4 stroke-1.5"})]),default:y(()=>[L(" "+w(e.__("New")),1)]),_:1})]),_:1})):C("",!0)]),p("div",pe,[p("div",ve,[p("div",me,w(e.__("All Courses")),1),p("div",fe,[c(s(ue),{buttons:G.value,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=l=>n.value=l)},null,8,["buttons","modelValue"]),c(s(F),{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=l=>g.value=l),label:e.__("Certification"),type:"checkbox",onChange:t[2]||(t[2]=l=>_())},null,8,["modelValue","label"]),p("div",ge,[c(s(F),{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=l=>f.value=l),placeholder:e.__("Search by Title"),type:"text",class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40",onInput:t[4]||(t[4]=l=>_())},null,8,["modelValue","placeholder"]),p("div",_e,[v.value.length?(d(),h(s(se),{key:0,modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=l=>m.value=l),options:v.value,placeholder:e.__("Category"),onChange:t[6]||(t[6]=l=>_())},null,8,["modelValue","options","placeholder"])):C("",!0)])])])]),s(i).data?.length?(d(),b("div",ye,[(d(!0),b(U,null,oe(s(i).data,l=>(d(),h(o,{to:{name:"CourseDetail",params:{courseName:l.name}}},{default:y(()=>[c(ie,{course:l},null,8,["course"])]),_:2},1032,["to"]))),256))])):s(i).list.loading?C("",!0):(d(),h(de,{key:1,type:"Courses"})),!s(i).list.loading&&s(i).hasNextPage?(d(),b("div",be,[c(s(S),{onClick:t[7]||(t[7]=l=>s(i).next())},{default:y(()=>[L(w(e.__("Load More")),1)]),_:1})])):C("",!0)])],64)}}};export{Fe as default};
//# sourceMappingURL=Courses-CtmZHX9k.js.map
